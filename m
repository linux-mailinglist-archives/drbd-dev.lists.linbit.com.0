Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 2BAFC63EEDE
	for <lists+drbd-dev@lfdr.de>; Thu,  1 Dec 2022 12:06:30 +0100 (CET)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id C52734217B3;
	Thu,  1 Dec 2022 12:06:29 +0100 (CET)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ej1-f54.google.com (mail-ej1-f54.google.com
	[209.85.218.54])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 8F87742177D
	for <drbd-dev@lists.linbit.com>; Thu,  1 Dec 2022 12:04:47 +0100 (CET)
Received: by mail-ej1-f54.google.com with SMTP id ud5so3337074ejc.4
	for <drbd-dev@lists.linbit.com>; Thu, 01 Dec 2022 03:04:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:from:to:cc:subject:date
	:message-id:reply-to;
	bh=Bmn8SwUWjK/nwkWTJ4vDBmaAziTFxNsLJCIgj2fSc8E=;
	b=Gf0HHtQJ2drnv8Kn2EzmbSBl4ExUFt6SPp6QGrTYzIC0ZBhP5a6EWuWNmKENJJDtfe
	YXmdznPgomOhN7CDe8CABrymHDwdsl8/bb/GoKCgQRWcXt//DmUv2Dhwuk5LYFqN/EEW
	vcWWnxOWSiP4Wk9Pi9rcfqFjsmEjnvG+U4w9vYDXhiVuMUhDm4aOkKZDIXKPQheeU+Hp
	j/TcfypiwWsSYzAMSe+PalW1PNhQ4SnYIDyeTw5QZmUDvBHF9wE5LpImgUmTvxIu2wrQ
	hrW2XcqWJigEI0/dQYB7ku0xjWNEeORxMI4LHxJfxQNyGpbYj7eNAm2rNVzIl1jivRKI
	7RZQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
	:subject:date:message-id:reply-to;
	bh=Bmn8SwUWjK/nwkWTJ4vDBmaAziTFxNsLJCIgj2fSc8E=;
	b=TUvoKI5y7cGA1bH3Dg+bAb+GaKangvgIVr6wmP38gjQ6fLJuzSlPWSGLsKxYx69Hat
	xqlhAfo0DFbgZlxmWotAJC+ovOfDY9kH6/uOBZLyNNE2cZV8Zn9mhrvVptcxT/p8TE4j
	nZ6FWZp30PuzYnCrkIBkKKzWkmtoXzhfXVoi9aPMNM5xIe/wdN1Vv04NmGcxRfsPaPE2
	2CPwNjv5zDCCfh4jaPp/imEPDk1xl5HodcDROHWyYPHo9NcHstD4ko1oyN31uESMYYSB
	Klp3POs9hcDkEwZxU7LJDk0Z53H60xByzx9rbXuIRKlARUtkQlw777pJT2nMua/Tq5VQ
	AaAw==
X-Gm-Message-State: ANoB5pkgiCmCvZXP0Ye5M7M2BQxWU8C8XGiyUrrVsS9y32PtdKG0mRw4
	JKJuRCZlQNdR0bhwWbBaeIuKFGn0
X-Google-Smtp-Source: AA0mqf6AlAariJ15ySSeIh1H1T+YEu/OdiVoYr/hy+NM72prqCa4Q7ixiHhOc6uyS7ph8uI++7y6nA==
X-Received: by 2002:a17:906:e0d2:b0:7ad:b45c:dbe1 with SMTP id
	gl18-20020a170906e0d200b007adb45cdbe1mr56404780ejb.726.1669892687188;
	Thu, 01 Dec 2022 03:04:47 -0800 (PST)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	f26-20020a056402161a00b00463a83ce063sm1576424edv.96.2022.12.01.03.04.46
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Thu, 01 Dec 2022 03:04:46 -0800 (PST)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Thu,  1 Dec 2022 12:03:49 +0100
Message-Id: <20221201110349.1282687-5-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.38.1
In-Reply-To: <20221201110349.1282687-1-christoph.boehmwalder@linbit.com>
References: <20221201110349.1282687-1-christoph.boehmwalder@linbit.com>
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH 4/5] drbd: introduce drbd_ratelimit()
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

VXNlIGNhbGwgc2l0ZSBzcGVjaWZpYyByYXRlbGltaXQgaW5zdGVhZCBvZiBvbmUgc2luZ2xlIHN0
YXRpYyBnbG9iYWwuCkFsc28gcmF0ZWxpbWl0IEFTU0VSVElPTiBtZXNzYWdlcyBnZW5lcmF0ZWQg
YnkgZXhwZWN0KCkuCgpPcmlnaW5hbGx5LWZyb206IExhcnMgRWxsZW5iZXJnIDxsYXJzLmVsbGVu
YmVyZ0BsaW5iaXQuY29tPgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGggQsO2aG13YWxkZXIgPGNo
cmlzdG9waC5ib2VobXdhbGRlckBsaW5iaXQuY29tPgotLS0KIGRyaXZlcnMvYmxvY2svZHJiZC9k
cmJkX2FjdGxvZy5jICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9i
aXRtYXAuYyAgICAgICAgICAgfCAgNiArKystLS0KIGRyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2lu
dC5oICAgICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9tYWluLmMg
ICAgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcG9seW1vcnBoX3By
aW50ay5oIHwgMTAgKysrKysrKysrLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIu
YyAgICAgICAgIHwgIDQgKystLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVxLmMgICAgICAg
ICAgICAgIHwgIDYgKysrLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYyAgICAg
ICAgICAgfCAxMiArKysrKystLS0tLS0KIDggZmlsZXMgY2hhbmdlZCwgMjYgaW5zZXJ0aW9ucygr
KSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRf
YWN0bG9nLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYwppbmRleCA1ZGIxNDdm
M2MwMmQuLjg3ZDkzMDEyMjg5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRf
YWN0bG9nLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYWN0bG9nLmMKQEAgLTExNDMs
NyArMTE0Myw3IEBAIHZvaWQgZHJiZF9yc19jb21wbGV0ZV9pbyhzdHJ1Y3QgZHJiZF9kZXZpY2Ug
KmRldmljZSwgc2VjdG9yX3Qgc2VjdG9yKQogCWJtX2V4dCA9IGUgPyBsY19lbnRyeShlLCBzdHJ1
Y3QgYm1fZXh0ZW50LCBsY2UpIDogTlVMTDsKIAlpZiAoIWJtX2V4dCkgewogCQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZkZXZpY2UtPmFsX2xvY2ssIGZsYWdzKTsKLQkJaWYgKF9fcmF0ZWxpbWl0
KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCWlmIChkcmJkX3JhdGVsaW1pdCgpKQogCQkJZHJi
ZF9lcnIoZGV2aWNlLCAiZHJiZF9yc19jb21wbGV0ZV9pbygpIGNhbGxlZCwgYnV0IGV4dGVudCBu
b3QgZm91bmRcbiIpOwogCQlyZXR1cm47CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9k
cmJkL2RyYmRfYml0bWFwLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9iaXRtYXAuYwppbmRl
eCBiOTBhNWMxMDAzZmMuLjhlNjUzNGE5MGUxMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9k
cmJkL2RyYmRfYml0bWFwLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYml0bWFwLmMK
QEAgLTExMyw3ICsxMTMsNyBAQCBzdHJ1Y3QgZHJiZF9iaXRtYXAgewogc3RhdGljIHZvaWQgX19i
bV9wcmludF9sb2NrX2luZm8oc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIGNvbnN0IGNoYXIg
KmZ1bmMpCiB7CiAJc3RydWN0IGRyYmRfYml0bWFwICpiID0gZGV2aWNlLT5iaXRtYXA7Ci0JaWYg
KCFfX3JhdGVsaW1pdCgmZHJiZF9yYXRlbGltaXRfc3RhdGUpKQorCWlmICghZHJiZF9yYXRlbGlt
aXQoKSkKIAkJcmV0dXJuOwogCWRyYmRfZXJyKGRldmljZSwgIkZJWE1FICVzWyVkXSBpbiAlcywg
Yml0bWFwIGxvY2tlZCBmb3IgJyVzJyBieSAlc1slZF1cbiIsCiAJCSBjdXJyZW50LT5jb21tLCB0
YXNrX3BpZF9ucihjdXJyZW50KSwKQEAgLTk1Miw3ICs5NTIsNyBAQCBzdGF0aWMgdm9pZCBkcmJk
X2JtX2VuZGlvKHN0cnVjdCBiaW8gKmJpbykKIAkJYm1fc2V0X3BhZ2VfaW9fZXJyKGItPmJtX3Bh
Z2VzW2lkeF0pOwogCQkvKiBOb3QgaWRlbnRpY2FsIHRvIG9uIGRpc2sgdmVyc2lvbiBvZiBpdC4K
IAkJICogSXMgQk1fUEFHRV9JT19FUlJPUiBlbm91Z2g/ICovCi0JCWlmIChfX3JhdGVsaW1pdCgm
ZHJiZF9yYXRlbGltaXRfc3RhdGUpKQorCQlpZiAoZHJiZF9yYXRlbGltaXQoKSkKIAkJCWRyYmRf
ZXJyKGRldmljZSwgIklPIEVSUk9SICVkIG9uIGJpdG1hcCBwYWdlIGlkeCAldVxuIiwKIAkJCQkJ
YmlvLT5iaV9zdGF0dXMsIGlkeCk7CiAJfSBlbHNlIHsKQEAgLTEwMTMsNyArMTAxMyw3IEBAIHN0
YXRpYyB2b2lkIGJtX3BhZ2VfaW9fYXN5bmMoc3RydWN0IGRyYmRfYm1fYWlvX2N0eCAqY3R4LCBp
bnQgcGFnZV9ucikgX19tdXN0X2hvCiAJCWVsc2UKIAkJCWxlbiA9IFBBR0VfU0laRTsKIAl9IGVs
c2UgewotCQlpZiAoX19yYXRlbGltaXQoJmRyYmRfcmF0ZWxpbWl0X3N0YXRlKSkgeworCQlpZiAo
ZHJiZF9yYXRlbGltaXQoKSkgewogCQkJZHJiZF9lcnIoZGV2aWNlLCAiSW52YWxpZCBvZmZzZXQg
ZHVyaW5nIG9uLWRpc2sgYml0bWFwIGFjY2VzczogIgogCQkJCSAicGFnZSBpZHggJXUsIHNlY3Rv
ciAlbGx1XG4iLCBwYWdlX25yLCBvbl9kaXNrX3NlY3Rvcik7CiAJCX0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50
LmgKaW5kZXggMTczNGE3ZjhhMDk2Li5hZTcxMzMzOGFhNDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
YmxvY2svZHJiZC9kcmJkX2ludC5oCisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5o
CkBAIC0xNjU4LDcgKzE2NTgsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgX19kcmJkX2Noa19pb19l
cnJvcl8oc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCiAJc3dpdGNoIChlcCkgewogCWNhc2Ug
RVBfUEFTU19PTjogLyogRklYTUUgd291bGQgdGhpcyBiZSBiZXR0ZXIgbmFtZWQgIklnbm9yZSI/
ICovCiAJCWlmIChkZiA9PSBEUkJEX1JFQURfRVJST1IgfHwgZGYgPT0gRFJCRF9XUklURV9FUlJP
UikgewotCQkJaWYgKF9fcmF0ZWxpbWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCQlpZiAo
ZHJiZF9yYXRlbGltaXQoKSkKIAkJCQlkcmJkX2VycihkZXZpY2UsICJMb2NhbCBJTyBmYWlsZWQg
aW4gJXMuXG4iLCB3aGVyZSk7CiAJCQlpZiAoZGV2aWNlLT5zdGF0ZS5kaXNrID4gRF9JTkNPTlNJ
U1RFTlQpCiAJCQkJX2RyYmRfc2V0X3N0YXRlKF9OUyhkZXZpY2UsIGRpc2ssIERfSU5DT05TSVNU
RU5UKSwgQ1NfSEFSRCwgTlVMTCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJi
ZF9tYWluLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9tYWluLmMKaW5kZXggZTAyZGIxZGNj
YWIxLi5hY2ZiYmEzYzBmMjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX21h
aW4uYworKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9tYWluLmMKQEAgLTM3NjcsNyArMzc2
Nyw3IEBAIF9kcmJkX2luc2VydF9mYXVsdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgdW5z
aWduZWQgaW50IHR5cGUpCiAJaWYgKHJldCkgewogCQlkcmJkX2ZhdWx0X2NvdW50Kys7CiAKLQkJ
aWYgKF9fcmF0ZWxpbWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCWlmIChkcmJkX3JhdGVs
aW1pdCgpKQogCQkJZHJiZF93YXJuKGRldmljZSwgIioqKlNpbXVsYXRpbmcgJXMgZmFpbHVyZVxu
IiwKIAkJCQlfZHJiZF9mYXVsdF9zdHIodHlwZSkpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
YmxvY2svZHJiZC9kcmJkX3BvbHltb3JwaF9wcmludGsuaCBiL2RyaXZlcnMvYmxvY2svZHJiZC9k
cmJkX3BvbHltb3JwaF9wcmludGsuaAppbmRleCA0NmNkYTlkZDlhZjguLjkxNGYyYTNjMGUyZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcG9seW1vcnBoX3ByaW50ay5oCisr
KyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3BvbHltb3JwaF9wcmludGsuaApAQCAtMTEwLDYg
KzExMCwxNCBAQCB2b2lkIGRyYmRfZHluX2RiZ193aXRoX3dyb25nX29iamVjdF90eXBlKHZvaWQp
OwogCWRyYmRfcHJpbnRrKEtFUk5fSU5GTywgZGV2aWNlLCBmbXQsICMjIGFyZ3MpCiAKIAorI2Rl
ZmluZSBkcmJkX3JhdGVsaW1pdCgpIFwKKyh7CQkJCQkJXAorCXN0YXRpYyBERUZJTkVfUkFURUxJ
TUlUX1NUQVRFKF9ycywJXAorCQlERUZBVUxUX1JBVEVMSU1JVF9JTlRFUlZBTCwJXAorCQlERUZB
VUxUX1JBVEVMSU1JVF9CVVJTVCk7CVwKKwlfX3JhdGVsaW1pdCgmX3JzKTsJCQlcCit9KQorCiAj
ZGVmaW5lIERfQVNTRVJUKHgsIGV4cCkJCQkJCQkJXAogCWRvIHsJCQkJCQkJCQlcCiAJCWlmICgh
KGV4cCkpCQkJCQkJCVwKQEAgLTEyNCw3ICsxMzIsNyBAQCB2b2lkIGRyYmRfZHluX2RiZ193aXRo
X3dyb25nX29iamVjdF90eXBlKHZvaWQpOwogICovCiAjZGVmaW5lIGV4cGVjdChleHApICh7CQkJ
CQkJCQlcCiAJCWJvb2wgX2Jvb2wgPSAoZXhwKTsJCQkJCQlcCi0JCWlmICghX2Jvb2wpCQkJCQkJ
CVwKKwkJaWYgKCFfYm9vbCAmJiBkcmJkX3JhdGVsaW1pdCgpKQkJCQkJXAogCQkJZHJiZF9lcnIo
ZGV2aWNlLCAiQVNTRVJUSU9OICVzIEZBSUxFRCBpbiAlc1xuIiwJCVwKIAkJCQkjZXhwLCBfX2Z1
bmNfXyk7CQkJCVwKIAkJX2Jvb2w7CQkJCQkJCQlcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2Nr
L2RyYmQvZHJiZF9yZWNlaXZlci5jIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIu
YwppbmRleCBlMDQ1ZmI1NWYzYmYuLmFmYmUwZGYzZmY3NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9i
bG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIuYworKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9y
ZWNlaXZlci5jCkBAIC0yMTY1LDcgKzIxNjUsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfUlNEYXRh
UmVwbHkoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAog
CQkgKiBvciBpbiBkcmJkX3BlZXJfcmVxdWVzdF9lbmRpby4gKi8KIAkJZXJyID0gcmVjdl9yZXN5
bmNfcmVhZChwZWVyX2RldmljZSwgc2VjdG9yLCBwaSk7CiAJfSBlbHNlIHsKLQkJaWYgKF9fcmF0
ZWxpbWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCWlmIChkcmJkX3JhdGVsaW1pdCgpKQog
CQkJZHJiZF9lcnIoZGV2aWNlLCAiQ2FuIG5vdCB3cml0ZSByZXN5bmMgZGF0YSB0byBsb2NhbCBk
aXNrLlxuIik7CiAKIAkJZXJyID0gZHJiZF9kcmFpbl9ibG9jayhwZWVyX2RldmljZSwgcGktPnNp
emUpOwpAQCAtMjg0Niw3ICsyODQ2LDcgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGFSZXF1ZXN0
KHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXQKIAkJZGVm
YXVsdDoKIAkJCUJVRygpOwogCQl9Ci0JCWlmICh2ZXJiICYmIF9fcmF0ZWxpbWl0KCZkcmJkX3Jh
dGVsaW1pdF9zdGF0ZSkpCisJCWlmICh2ZXJiICYmIGRyYmRfcmF0ZWxpbWl0KCkpCiAJCQlkcmJk
X2VycihkZXZpY2UsICJDYW4gbm90IHNhdGlzZnkgcGVlcidzIHJlYWQgcmVxdWVzdCwgIgogCQkJ
ICAgICJubyBsb2NhbCBkYXRhLlxuIik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJi
ZC9kcmJkX3JlcS5jIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVxLmMKaW5kZXggY2VkMTU1
NTcxOTdhLi5lYjE0ZWM4ZWMwNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJk
X3JlcS5jCisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlcS5jCkBAIC0xNDQsNyArMTQ0
LDcgQEAgdm9pZCBkcmJkX3JlcV9kZXN0cm95KHN0cnVjdCBrcmVmICprcmVmKQogCQkJaWYgKGdl
dF9sZGV2X2lmX3N0YXRlKGRldmljZSwgRF9GQUlMRUQpKSB7CiAJCQkJZHJiZF9hbF9jb21wbGV0
ZV9pbyhkZXZpY2UsICZyZXEtPmkpOwogCQkJCXB1dF9sZGV2KGRldmljZSk7Ci0JCQl9IGVsc2Ug
aWYgKF9fcmF0ZWxpbWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpIHsKKwkJCX0gZWxzZSBpZiAo
ZHJiZF9yYXRlbGltaXQoKSkgewogCQkJCWRyYmRfd2FybihkZXZpY2UsICJTaG91bGQgaGF2ZSBj
YWxsZWQgZHJiZF9hbF9jb21wbGV0ZV9pbygsICVsbHUsICV1KSwgIgogCQkJCQkgImJ1dCBteSBE
aXNrIHNlZW1zIHRvIGhhdmUgZmFpbGVkIDooXG4iLAogCQkJCQkgKHVuc2lnbmVkIGxvbmcgbG9u
ZykgcmVxLT5pLnNlY3RvciwgcmVxLT5pLnNpemUpOwpAQCAtNTE4LDcgKzUxOCw3IEBAIHN0YXRp
YyB2b2lkIG1vZF9ycV9zdGF0ZShzdHJ1Y3QgZHJiZF9yZXF1ZXN0ICpyZXEsIHN0cnVjdCBiaW9f
YW5kX2Vycm9yICptLAogCiBzdGF0aWMgdm9pZCBkcmJkX3JlcG9ydF9pb19lcnJvcihzdHJ1Y3Qg
ZHJiZF9kZXZpY2UgKmRldmljZSwgc3RydWN0IGRyYmRfcmVxdWVzdCAqcmVxKQogewotCWlmICgh
X19yYXRlbGltaXQoJmRyYmRfcmF0ZWxpbWl0X3N0YXRlKSkKKwlpZiAoIWRyYmRfcmF0ZWxpbWl0
KCkpCiAJCXJldHVybjsKIAogCWRyYmRfd2FybihkZXZpY2UsICJsb2NhbCAlcyBJTyBlcnJvciBz
ZWN0b3IgJWxsdSsldSBvbiAlcGdcbiIsCkBAIC0xNDAyLDcgKzE0MDIsNyBAQCBzdGF0aWMgdm9p
ZCBkcmJkX3NlbmRfYW5kX3N1Ym1pdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgc3RydWN0
IGRyYmRfcmVxdWVzdAogCQlzdWJtaXRfcHJpdmF0ZV9iaW8gPSB0cnVlOwogCX0gZWxzZSBpZiAo
bm9fcmVtb3RlKSB7CiBub2RhdGE6Ci0JCWlmIChfX3JhdGVsaW1pdCgmZHJiZF9yYXRlbGltaXRf
c3RhdGUpKQorCQlpZiAoZHJiZF9yYXRlbGltaXQoKSkKIAkJCWRyYmRfZXJyKGRldmljZSwgIklP
IEVSUk9SOiBuZWl0aGVyIGxvY2FsIG5vciByZW1vdGUgZGF0YSwgc2VjdG9yICVsbHUrJXVcbiIs
CiAJCQkJCSh1bnNpZ25lZCBsb25nIGxvbmcpcmVxLT5pLnNlY3RvciwgcmVxLT5pLnNpemUgPj4g
OSk7CiAJCS8qIEEgd3JpdGUgbWF5IGhhdmUgYmVlbiBxdWV1ZWQgZm9yIHNlbmRfb29zLCBob3dl
dmVyLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfd29ya2VyLmMgYi9kcml2
ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYwppbmRleCAzZGYwMzNiZmNjZjguLmY0NjczODA0
MGQ2YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfd29ya2VyLmMKKysrIGIv
ZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfd29ya2VyLmMKQEAgLTE3Niw3ICsxNzYsNyBAQCB2b2lk
IGRyYmRfcGVlcl9yZXF1ZXN0X2VuZGlvKHN0cnVjdCBiaW8gKmJpbykKIAlib29sIGlzX2Rpc2Nh
cmQgPSBiaW9fb3AoYmlvKSA9PSBSRVFfT1BfV1JJVEVfWkVST0VTIHx8CiAJCQkgIGJpb19vcChi
aW8pID09IFJFUV9PUF9ESVNDQVJEOwogCi0JaWYgKGJpby0+Ymlfc3RhdHVzICYmIF9fcmF0ZWxp
bWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJaWYgKGJpby0+Ymlfc3RhdHVzICYmIGRyYmRf
cmF0ZWxpbWl0KCkpCiAJCWRyYmRfd2FybihkZXZpY2UsICIlczogZXJyb3I9JWQgcz0lbGx1c1xu
IiwKIAkJCQlpc193cml0ZSA/IChpc19kaXNjYXJkID8gImRpc2NhcmQiIDogIndyaXRlIikKIAkJ
CQkJOiAicmVhZCIsIGJpby0+Ymlfc3RhdHVzLApAQCAtMjQwLDcgKzI0MCw3IEBAIHZvaWQgZHJi
ZF9yZXF1ZXN0X2VuZGlvKHN0cnVjdCBiaW8gKmJpbykKIAkgKiB0aG91Z2ggd2Ugc3RpbGwgd2ls
bCBjb21wbGFpbiBub2lzaWx5IGFib3V0IGl0LgogCSAqLwogCWlmICh1bmxpa2VseShyZXEtPnJx
X3N0YXRlICYgUlFfTE9DQUxfQUJPUlRFRCkpIHsKLQkJaWYgKF9fcmF0ZWxpbWl0KCZkcmJkX3Jh
dGVsaW1pdF9zdGF0ZSkpCisJCWlmIChkcmJkX3JhdGVsaW1pdCgpKQogCQkJZHJiZF9lbWVyZyhk
ZXZpY2UsICJkZWxheWVkIGNvbXBsZXRpb24gb2YgYWJvcnRlZCBsb2NhbCByZXF1ZXN0OyBkaXNr
LXRpbWVvdXQgbWF5IGJlIHRvbyBhZ2dyZXNzaXZlXG4iKTsKIAogCQlpZiAoIWJpby0+Ymlfc3Rh
dHVzKQpAQCAtMTA2Miw3ICsxMDYyLDcgQEAgaW50IHdfZV9lbmRfZGF0YV9yZXEoc3RydWN0IGRy
YmRfd29yayAqdywgaW50IGNhbmNlbCkKIAlpZiAobGlrZWx5KChwZWVyX3JlcS0+ZmxhZ3MgJiBF
RV9XQVNfRVJST1IpID09IDApKSB7CiAJCWVyciA9IGRyYmRfc2VuZF9ibG9jayhwZWVyX2Rldmlj
ZSwgUF9EQVRBX1JFUExZLCBwZWVyX3JlcSk7CiAJfSBlbHNlIHsKLQkJaWYgKF9fcmF0ZWxpbWl0
KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCWlmIChkcmJkX3JhdGVsaW1pdCgpKQogCQkJZHJi
ZF9lcnIoZGV2aWNlLCAiU2VuZGluZyBOZWdEUmVwbHkuIHNlY3Rvcj0lbGx1cy5cbiIsCiAJCQkg
ICAgKHVuc2lnbmVkIGxvbmcgbG9uZylwZWVyX3JlcS0+aS5zZWN0b3IpOwogCkBAIC0xMTM1LDEz
ICsxMTM1LDEzIEBAIGludCB3X2VfZW5kX3JzZGF0YV9yZXEoc3RydWN0IGRyYmRfd29yayAqdywg
aW50IGNhbmNlbCkKIAkJCWVsc2UKIAkJCQllcnIgPSBkcmJkX3NlbmRfYmxvY2socGVlcl9kZXZp
Y2UsIFBfUlNfREFUQV9SRVBMWSwgcGVlcl9yZXEpOwogCQl9IGVsc2UgewotCQkJaWYgKF9fcmF0
ZWxpbWl0KCZkcmJkX3JhdGVsaW1pdF9zdGF0ZSkpCisJCQlpZiAoZHJiZF9yYXRlbGltaXQoKSkK
IAkJCQlkcmJkX2VycihkZXZpY2UsICJOb3Qgc2VuZGluZyBSU0RhdGFSZXBseSwgIgogCQkJCSAg
ICAicGFydG5lciBESVNLTEVTUyFcbiIpOwogCQkJZXJyID0gMDsKIAkJfQogCX0gZWxzZSB7Ci0J
CWlmIChfX3JhdGVsaW1pdCgmZHJiZF9yYXRlbGltaXRfc3RhdGUpKQorCQlpZiAoZHJiZF9yYXRl
bGltaXQoKSkKIAkJCWRyYmRfZXJyKGRldmljZSwgIlNlbmRpbmcgTmVnUlNEUmVwbHkuIHNlY3Rv
ciAlbGx1cy5cbiIsCiAJCQkgICAgKHVuc2lnbmVkIGxvbmcgbG9uZylwZWVyX3JlcS0+aS5zZWN0
b3IpOwogCkBAIC0xMjEyLDcgKzEyMTIsNyBAQCBpbnQgd19lX2VuZF9jc3VtX3JzX3JlcShzdHJ1
Y3QgZHJiZF93b3JrICp3LCBpbnQgY2FuY2VsKQogCQl9CiAJfSBlbHNlIHsKIAkJZXJyID0gZHJi
ZF9zZW5kX2FjayhwZWVyX2RldmljZSwgUF9ORUdfUlNfRFJFUExZLCBwZWVyX3JlcSk7Ci0JCWlm
IChfX3JhdGVsaW1pdCgmZHJiZF9yYXRlbGltaXRfc3RhdGUpKQorCQlpZiAoZHJiZF9yYXRlbGlt
aXQoKSkKIAkJCWRyYmRfZXJyKGRldmljZSwgIlNlbmRpbmcgTmVnRFJlcGx5LiBJIGd1ZXNzIGl0
IGdldHMgbWVzc3kuXG4iKTsKIAl9CiAKLS0gCjIuMzguMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJiZC1kZXYgbWFpbGluZyBsaXN0CmRyYmQtZGV2
QGxpc3RzLmxpbmJpdC5jb20KaHR0cHM6Ly9saXN0cy5saW5iaXQuY29tL21haWxtYW4vbGlzdGlu
Zm8vZHJiZC1kZXYK
