Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 76AB96009CC
	for <lists+drbd-dev@lfdr.de>; Mon, 17 Oct 2022 11:02:23 +0200 (CEST)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id E928B4205B8;
	Mon, 17 Oct 2022 11:02:22 +0200 (CEST)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ed1-f41.google.com (mail-ed1-f41.google.com
	[209.85.208.41])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 0C2FF4201A5
	for <drbd-dev@lists.linbit.com>; Mon, 17 Oct 2022 11:02:21 +0200 (CEST)
Received: by mail-ed1-f41.google.com with SMTP id l22so15044008edj.5
	for <drbd-dev@lists.linbit.com>; Mon, 17 Oct 2022 02:02:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:from:to:cc:subject:date:message-id:reply-to;
	bh=fyIBpa3bTnnDtimMMPiGhNnHhdO52yLRUstRRKbUhJ8=;
	b=ulhGiN4soXuS5KmM1YMAwKIR2KnB6r9pKDhy82pAiji2oXQUh+U96txIRe9mA3KEoQ
	1Tm937rUAGAJZxZfL6MjnOzmAhNHmHWk5A14B/P9YhZAyOoLVRvpM5nGyTDTBq4KHiww
	AGYYTbqNDsZxtKjK8tR9QUSDl8uvguMlbJi49etNg7TA2cviNq4rnp5O9E7feplg5ks0
	lDJIi9bp7OPLGAHIn2GdkQHpRtwPBAWTATLWBjBBKQw+lr4munHlTBENv4KQtR62HKAL
	JE9A7SsE6XEkqcKcXJrFpcAuc2t5QvgWSEix9CYfv8wD40nWytHfnPfRym8Ma4fEEsbZ
	arew==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:x-gm-message-state:from:to:cc:subject:date:message-id
	:reply-to;
	bh=fyIBpa3bTnnDtimMMPiGhNnHhdO52yLRUstRRKbUhJ8=;
	b=PfAAu0A8uC6/uhpXqtKeMAcGk1r0rSTOfdMGyd/von2MV0405D+XGZJFizT00N5mg4
	4lL0Ld7Isc+KI5Owzfdb9ZOogFzb+ZnIpg3GwvDfkoWWK00CriCLKZEXA2yMeX0L/EsK
	Wiivyp5eZqkTLC9nzf9Pql6hWUthQGqjbA9W6+hCwnxCY/umc0xDLhXJkWOCYQ18Zt5C
	Bkw8Xh3gwsNiyFHrvKDHoVkTw7a3OcPP5+yvdz0Gae7dx0Zhdw2o0aICtHa9Tn6qUKgy
	NtZerKT1lj70+LRpPCT1W+grELmxyTYopGKJb2AEFO3dwGOoHeEHifTTEhjDct1f2jHw
	jv0A==
X-Gm-Message-State: ACrzQf0cmN3uUmVF/nNaRyBlkTquA8cbnRxIBCGKl17Se6qrYpBR7w4E
	K6CM5g1gnLG6cBBmKh/Z2KENB1oh
X-Google-Smtp-Source: AMsMyM6XwaK3rqfreGiuadZXYAW13YPPLgydIyI948aduyZ5oPqDccCE+WwkDCzjwHLXMW5RLQTCog==
X-Received: by 2002:a05:6402:e9d:b0:443:7833:3d7b with SMTP id
	h29-20020a0564020e9d00b0044378333d7bmr9043547eda.151.1665997341270;
	Mon, 17 Oct 2022 02:02:21 -0700 (PDT)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	sd42-20020a1709076e2a00b0076ff600bf2csm5768092ejc.63.2022.10.17.02.02.20
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Mon, 17 Oct 2022 02:02:20 -0700 (PDT)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Mon, 17 Oct 2022 11:01:54 +0200
Message-Id: <20221017090154.15696-1-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.37.3
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH] drbd: Store op in drbd_peer_request
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

KFNvcnQgb2YpIGNoZXJyeS1waWNrZWQgZnJvbSB0aGUgb3V0LW9mLXRyZWUgZHJiZDkgYnJhbmNo
LiBPcmlnaW5hbApjb21taXQgbWVzc2FnZSBieSBKb2VsIENvbGxlZGdlOgoKICAgIFRoaXMgc2lt
cGxpZmllcyBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QgYnkgcmVtb3ZpbmcgbW9zdCBvZiB0aGUK
ICAgIGFyZ3VtZW50cy4gSXQgYWxzbyBtYWtlcyB0aGUgdHJlYXRtZW50IG9mIHRoZSBvcCBiZXR0
ZXIgYWxpZ25lZCB3aXRoCiAgICB0aGF0IGluIHN0cnVjdCBiaW8uCgogICAgRGV0ZXJtaW5lIGZh
dWx0X3R5cGUgZHluYW1pY2FsbHkgdXNpbmcgaW5mb3JtYXRpb24gd2hpY2ggaXMgYWxyZWFkeQog
ICAgYXZhaWxhYmxlIGluc3RlYWQgb2YgcGFzc2luZyBpdCBpbiBhcyBhIHBhcmFtZXRlci4KCk5v
dGU6IFRoZSBvcGYgaW4gcmVjZWl2ZV9yc19kZWFsbG9jYXRlZCB3YXMgY2hhbmdlZCBmcm9tClJF
UV9PUF9XUklURV9aRVJPRVMgdG8gUkVRX09QX0RJU0NBUkQuIFRoaXMgd2FzIHJlcXVpcmVkIGlu
IHRoZQpvdXQtb2YtdHJlZSBtb2R1bGUsIGFuZCBkb2VzIG5vdCBtYXR0ZXIgaW4tdHJlZS4gVGhl
IG9wZiBpcyBpZ25vcmVkCmFueXdheSBpbiBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QsIHNpbmNl
IHRoZSBkaXNjYXJkL3plcm8tb3V0IGlzCmRlY2lkZWQgYnkgdGhlIEVFX1RSSU0gZmxhZy4KClNp
Z25lZC1vZmYtYnk6IEpvZWwgQ29sbGVkZ2UgPGpvZWwuY29sbGVkZ2VAbGluYml0LmNvbT4KU2ln
bmVkLW9mZi1ieTogQ2hyaXN0b3BoIELDtmhtd2FsZGVyIDxjaHJpc3RvcGguYm9laG13YWxkZXJA
bGluYml0LmNvbT4KLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9pbnQuaCAgICAgIHwgIDgg
KystCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jIHwgODEgKysrKysrKysrKysr
KysrKystLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYyAgIHwg
IDQgKy0KIDMgZmlsZXMgY2hhbmdlZCwgNTMgaW5zZXJ0aW9ucygrKSwgNDAgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmggYi9kcml2ZXJzL2Js
b2NrL2RyYmQvZHJiZF9pbnQuaAppbmRleCA0ZDY2MTI4MmZmNDEuLjBmOGUzYjk0YTYzNSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmgKKysrIGIvZHJpdmVycy9ibG9j
ay9kcmJkL2RyYmRfaW50LmgKQEAgLTM5NSw2ICszOTUsNyBAQCBzdHJ1Y3QgZHJiZF9wZWVyX3Jl
cXVlc3QgewogCXN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZTsKIAlzdHJ1Y3Qg
ZHJiZF9lcG9jaCAqZXBvY2g7IC8qIGZvciB3cml0ZXMgKi8KIAlzdHJ1Y3QgcGFnZSAqcGFnZXM7
CisJdW5zaWduZWQgaW50IG9wZjsgLyogdG8gYmUgdXNlZCBhcyBiaV9vcGYgKi8KIAlhdG9taWNf
dCBwZW5kaW5nX2Jpb3M7CiAJc3RydWN0IGRyYmRfaW50ZXJ2YWwgaTsKIAkvKiBzZWUgY29tbWVu
dHMgb24gZWUgZmxhZyBiaXRzIGJlbG93ICovCkBAIC00MDYsNiArNDA3LDEwIEBAIHN0cnVjdCBk
cmJkX3BlZXJfcmVxdWVzdCB7CiAJfTsKIH07CiAKKy8qIEVxdWl2YWxlbnQgdG8gYmlvX29wIGFu
ZCByZXFfb3AuICovCisjZGVmaW5lIHBlZXJfcmVxX29wKHBlZXJfcmVxKSBcCisgICAgICAgKChw
ZWVyX3JlcSktPm9wZiAmIFJFUV9PUF9NQVNLKQorCiAvKiBlZSBmbGFnIGJpdHMuCiAgKiBXaGls
ZSBjb3JyZXNwb25kaW5nIGJpb3MgYXJlIGluIGZsaWdodCwgdGhlIG9ubHkgbW9kaWZpY2F0aW9u
IHdpbGwgYmUKICAqIHNldF9iaXQgV0FTX0VSUk9SLCB3aGljaCBoYXMgdG8gYmUgYXRvbWljLgpA
QCAtMTU0NSw4ICsxNTUwLDcgQEAgZXh0ZXJuIHZvaWQgZHJiZF9zZW5kX2Fja3Nfd2Yoc3RydWN0
IHdvcmtfc3RydWN0ICp3cyk7CiBleHRlcm4gYm9vbCBkcmJkX3JzX2NfbWluX3JhdGVfdGhyb3R0
bGUoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpOwogZXh0ZXJuIGJvb2wgZHJiZF9yc19zaG91
bGRfc2xvd19kb3duKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3Is
CiAJCWJvb2wgdGhyb3R0bGVfaWZfYXBwX2lzX3dhaXRpbmcpOwotZXh0ZXJuIGludCBkcmJkX3N1
Ym1pdF9wZWVyX3JlcXVlc3Qoc3RydWN0IGRyYmRfZGV2aWNlICosCi0JCQkJICAgIHN0cnVjdCBk
cmJkX3BlZXJfcmVxdWVzdCAqLCBibGtfb3BmX3QsIGludCk7CitleHRlcm4gaW50IGRyYmRfc3Vi
bWl0X3BlZXJfcmVxdWVzdChzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKik7CiBleHRlcm4gaW50
IGRyYmRfZnJlZV9wZWVyX3JlcXMoc3RydWN0IGRyYmRfZGV2aWNlICosIHN0cnVjdCBsaXN0X2hl
YWQgKik7CiBleHRlcm4gc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICpkcmJkX2FsbG9jX3BlZXJf
cmVxKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICosIHU2NCwKIAkJCQkJCSAgICAgc2VjdG9yX3Qs
IHVuc2lnbmVkIGludCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2Vp
dmVyLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jCmluZGV4IGM4OTdjNDU3
MjAzNi4uNDFjZjcwNmE1ZTdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9y
ZWNlaXZlci5jCisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMKQEAgLTE2
MDMsOSArMTYwMywxOSBAQCBzdGF0aWMgdm9pZCBkcmJkX2lzc3VlX3BlZXJfZGlzY2FyZF9vcl96
ZXJvX291dChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgc3RydQogCWRyYmRfZW5kaW9fd3Jp
dGVfc2VjX2ZpbmFsKHBlZXJfcmVxKTsKIH0KIAorc3RhdGljIGludCBwZWVyX3JlcXVlc3RfZmF1
bHRfdHlwZShzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxKQoreworCWlmIChwZWVy
X3JlcV9vcChwZWVyX3JlcSkgPT0gUkVRX09QX1JFQUQpIHsKKwkJcmV0dXJuIHBlZXJfcmVxLT5m
bGFncyAmIEVFX0FQUExJQ0FUSU9OID8KKwkJCURSQkRfRkFVTFRfRFRfUkQgOiBEUkJEX0ZBVUxU
X1JTX1JEOworCX0gZWxzZSB7CisJCXJldHVybiBwZWVyX3JlcS0+ZmxhZ3MgJiBFRV9BUFBMSUNB
VElPTiA/CisJCQlEUkJEX0ZBVUxUX0RUX1dSIDogRFJCRF9GQVVMVF9SU19XUjsKKwl9Cit9CisK
IC8qKgogICogZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KCkKLSAqIEBkZXZpY2U6CURSQkQgZGV2
aWNlLgogICogQHBlZXJfcmVxOglwZWVyIHJlcXVlc3QKICAqCiAgKiBNYXkgc3ByZWFkIHRoZSBw
YWdlcyB0byBtdWx0aXBsZSBiaW9zLApAQCAtMTYxOSwxMCArMTYyOSw5IEBAIHN0YXRpYyB2b2lk
IGRyYmRfaXNzdWVfcGVlcl9kaXNjYXJkX29yX3plcm9fb3V0KHN0cnVjdCBkcmJkX2RldmljZSAq
ZGV2aWNlLCBzdHJ1CiAgKiAgb24gY2VydGFpbiBYZW4gZGVwbG95bWVudHMuCiAgKi8KIC8qIFRP
RE8gYWxsb2NhdGUgZnJvbSBvdXIgb3duIGJpb19zZXQuICovCi1pbnQgZHJiZF9zdWJtaXRfcGVl
cl9yZXF1ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAotCQkJICAgICBzdHJ1Y3QgZHJi
ZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxLAotCQkJICAgICBjb25zdCBibGtfb3BmX3Qgb3BmLCBj
b25zdCBpbnQgZmF1bHRfdHlwZSkKK2ludCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qoc3RydWN0
IGRyYmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcSkKIHsKKwlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRl
dmljZSA9IHBlZXJfcmVxLT5wZWVyX2RldmljZS0+ZGV2aWNlOwogCXN0cnVjdCBiaW8gKmJpb3Mg
PSBOVUxMOwogCXN0cnVjdCBiaW8gKmJpbzsKIAlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHBlZXJfcmVx
LT5wYWdlczsKQEAgLTE2NjcsNyArMTY3NiwxOCBAQCBpbnQgZHJiZF9zdWJtaXRfcGVlcl9yZXF1
ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAogCSAqIGdlbmVyYXRlZCBiaW8sIGJ1dCBh
IGJpbyBhbGxvY2F0ZWQgb24gYmVoYWxmIG9mIHRoZSBwZWVyLgogCSAqLwogbmV4dF9iaW86Ci0J
YmlvID0gYmlvX2FsbG9jKGRldmljZS0+bGRldi0+YmFja2luZ19iZGV2LCBucl9wYWdlcywgb3Bm
LCBHRlBfTk9JTyk7CisJLyogX0RJU0NBUkQsIF9XUklURV9aRVJPRVMgaGFuZGxlZCBhYm92ZS4K
KwkgKiBSRVFfT1BfRkxVU0ggKGVtcHR5IGZsdXNoKSBub3QgZXhwZWN0ZWQsCisJICogc2hvdWxk
IGhhdmUgYmVlbiBtYXBwZWQgdG8gYSAiZHJiZCBwcm90b2NvbCBiYXJyaWVyIi4KKwkgKiBSRVFf
T1BfU0VDVVJFX0VSQVNFOiBJIGRvbid0IHNlZSBob3cgd2UgY291bGQgZXZlciBzdXBwb3J0IHRo
YXQuCisJICovCisJaWYgKCEocGVlcl9yZXFfb3AocGVlcl9yZXEpID09IFJFUV9PUF9XUklURSB8
fAorCQkJCXBlZXJfcmVxX29wKHBlZXJfcmVxKSA9PSBSRVFfT1BfUkVBRCkpIHsKKwkJZHJiZF9l
cnIoZGV2aWNlLCAiSW52YWxpZCBiaW8gb3AgcmVjZWl2ZWQ6IDB4JXhcbiIsIHBlZXJfcmVxLT5v
cGYpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwliaW8gPSBiaW9fYWxsb2MoZGV2aWNlLT5s
ZGV2LT5iYWNraW5nX2JkZXYsIG5yX3BhZ2VzLCBwZWVyX3JlcS0+b3BmLCBHRlBfTk9JTyk7CiAJ
LyogPiBwZWVyX3JlcS0+aS5zZWN0b3IsIHVubGVzcyB0aGlzIGlzIHRoZSBmaXJzdCBiaW8gKi8K
IAliaW8tPmJpX2l0ZXIuYmlfc2VjdG9yID0gc2VjdG9yOwogCWJpby0+YmlfcHJpdmF0ZSA9IHBl
ZXJfcmVxOwpAQCAtMTY5Nyw3ICsxNzE3LDcgQEAgaW50IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVz
dChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwKIAkJYmlvcyA9IGJpb3MtPmJpX25leHQ7CiAJ
CWJpby0+YmlfbmV4dCA9IE5VTEw7CiAKLQkJZHJiZF9zdWJtaXRfYmlvX25vYWNjdChkZXZpY2Us
IGZhdWx0X3R5cGUsIGJpbyk7CisJCWRyYmRfc3VibWl0X2Jpb19ub2FjY3QoZGV2aWNlLCBwZWVy
X3JlcXVlc3RfZmF1bHRfdHlwZShwZWVyX3JlcSksIGJpbyk7CiAJfSB3aGlsZSAoYmlvcyk7CiAJ
cmV0dXJuIDA7CiB9CkBAIC0yMDUxLDYgKzIwNzEsNyBAQCBzdGF0aWMgaW50IHJlY3ZfcmVzeW5j
X3JlYWQoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0
bwogCSAqIHJlc3BlY3RpdmUgX2RyYmRfY2xlYXJfZG9uZV9lZSAqLwogCiAJcGVlcl9yZXEtPncu
Y2IgPSBlX2VuZF9yZXN5bmNfYmxvY2s7CisJcGVlcl9yZXEtPm9wZiA9IFJFUV9PUF9XUklURTsK
IAlwZWVyX3JlcS0+c3VibWl0X2ppZiA9IGppZmZpZXM7CiAKIAlzcGluX2xvY2tfaXJxKCZkZXZp
Y2UtPnJlc291cmNlLT5yZXFfbG9jayk7CkBAIC0yMDU4LDggKzIwNzksNyBAQCBzdGF0aWMgaW50
IHJlY3ZfcmVzeW5jX3JlYWQoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBz
ZWN0b3JfdCBzZWN0bwogCXNwaW5fdW5sb2NrX2lycSgmZGV2aWNlLT5yZXNvdXJjZS0+cmVxX2xv
Y2spOwogCiAJYXRvbWljX2FkZChwaS0+c2l6ZSA+PiA5LCAmZGV2aWNlLT5yc19zZWN0X2V2KTsK
LQlpZiAoZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KGRldmljZSwgcGVlcl9yZXEsIFJFUV9PUF9X
UklURSwKLQkJCQkgICAgIERSQkRfRkFVTFRfUlNfV1IpID09IDApCisJaWYgKGRyYmRfc3VibWl0
X3BlZXJfcmVxdWVzdChwZWVyX3JlcSkgPT0gMCkKIAkJcmV0dXJuIDA7CiAKIAkvKiBkb24ndCBj
YXJlIGZvciB0aGUgcmVhc29uIGhlcmUgKi8KQEAgLTIzNzUsMTYgKzIzOTUsNiBAQCBzdGF0aWMg
aW50IHdhaXRfZm9yX2FuZF91cGRhdGVfcGVlcl9zZXEoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2Ug
KnBlZXJfZGV2aWNlLCBjbwogCXJldHVybiByZXQ7CiB9CiAKLS8qIHNlZSBhbHNvIGJpb19mbGFn
c190b193aXJlKCkKLSAqIERSQkRfUkVRXyosIGJlY2F1c2Ugd2UgbmVlZCB0byBzZW1hbnRpY2Fs
bHkgbWFwIHRoZSBmbGFncyB0byBkYXRhIHBhY2tldAotICogZmxhZ3MgYW5kIGJhY2suIFdlIG1h
eSByZXBsaWNhdGUgdG8gb3RoZXIga2VybmVsIHZlcnNpb25zLiAqLwotc3RhdGljIGJsa19vcGZf
dCB3aXJlX2ZsYWdzX3RvX2Jpb19mbGFncyh1MzIgZHBmKQotewotCXJldHVybiAgKGRwZiAmIERQ
X1JXX1NZTkMgPyBSRVFfU1lOQyA6IDApIHwKLQkJKGRwZiAmIERQX0ZVQSA/IFJFUV9GVUEgOiAw
KSB8Ci0JCShkcGYgJiBEUF9GTFVTSCA/IFJFUV9QUkVGTFVTSCA6IDApOwotfQotCiBzdGF0aWMg
ZW51bSByZXFfb3Agd2lyZV9mbGFnc190b19iaW9fb3AodTMyIGRwZikKIHsKIAlpZiAoZHBmICYg
RFBfWkVST0VTKQpAQCAtMjM5NSw2ICsyNDA1LDE1IEBAIHN0YXRpYyBlbnVtIHJlcV9vcCB3aXJl
X2ZsYWdzX3RvX2Jpb19vcCh1MzIgZHBmKQogCQlyZXR1cm4gUkVRX09QX1dSSVRFOwogfQogCisv
KiBzZWUgYWxzbyBiaW9fZmxhZ3NfdG9fd2lyZSgpICovCitzdGF0aWMgdW5zaWduZWQgbG9uZyB3
aXJlX2ZsYWdzX3RvX2JpbyhzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCB1MzIg
ZHBmKQoreworCXVuc2lnbmVkIGxvbmcgb3BmID0gd2lyZV9mbGFnc190b19iaW9fb3AoZHBmKSB8
CisJCShkcGYgJiBEUF9SV19TWU5DID8gUkVRX1NZTkMgOiAwKSB8CisJCShkcGYgJiBEUF9GVUEg
PyBSRVFfRlVBIDogMCkgfAorCQkoZHBmICYgRFBfRkxVU0ggPyBSRVFfUFJFRkxVU0ggOiAwKTsK
K30KKwogc3RhdGljIHZvaWQgZmFpbF9wb3N0cG9uZWRfcmVxdWVzdHMoc3RydWN0IGRyYmRfZGV2
aWNlICpkZXZpY2UsIHNlY3Rvcl90IHNlY3RvciwKIAkJCQkgICAgdW5zaWduZWQgaW50IHNpemUp
CiB7CkBAIC0yNTM4LDggKzI1NTcsNiBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YShzdHJ1Y3Qg
ZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFja2V0X2luZm8gKgogCXN0cnVj
dCBkcmJkX3BlZXJfcmVxdWVzdCAqcGVlcl9yZXE7CiAJc3RydWN0IHBfZGF0YSAqcCA9IHBpLT5k
YXRhOwogCXUzMiBwZWVyX3NlcSA9IGJlMzJfdG9fY3B1KHAtPnNlcV9udW0pOwotCWVudW0gcmVx
X29wIG9wOwotCWJsa19vcGZfdCBvcF9mbGFnczsKIAl1MzIgZHBfZmxhZ3M7CiAJaW50IGVyciwg
dHA7CiAKQEAgLTI1NzgsMTEgKzI1OTUsMTAgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGEoc3Ry
dWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAlw
ZWVyX3JlcS0+ZmxhZ3MgfD0gRUVfQVBQTElDQVRJT047CiAKIAlkcF9mbGFncyA9IGJlMzJfdG9f
Y3B1KHAtPmRwX2ZsYWdzKTsKLQlvcCA9IHdpcmVfZmxhZ3NfdG9fYmlvX29wKGRwX2ZsYWdzKTsK
LQlvcF9mbGFncyA9IHdpcmVfZmxhZ3NfdG9fYmlvX2ZsYWdzKGRwX2ZsYWdzKTsKKwlwZWVyX3Jl
cS0+b3BmID0gd2lyZV9mbGFnc190b19iaW8oY29ubmVjdGlvbiwgZHBfZmxhZ3MpOwogCWlmIChw
aS0+Y21kID09IFBfVFJJTSkgewogCQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9yZXEtPmku
c2l6ZSA+IDApOwotCQlEX0FTU0VSVChwZWVyX2RldmljZSwgb3AgPT0gUkVRX09QX0RJU0NBUkQp
OworCQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9yZXFfb3AocGVlcl9yZXEpID09IFJFUV9P
UF9ESVNDQVJEKTsKIAkJRF9BU1NFUlQocGVlcl9kZXZpY2UsIHBlZXJfcmVxLT5wYWdlcyA9PSBO
VUxMKTsKIAkJLyogbmVlZCB0byBwbGF5IHNhZmU6IGFuIG9sZGVyIERSQkQgc2VuZGVyCiAJCSAq
IG1heSBtZWFuIHplcm8tb3V0IHdoaWxlIHNlbmRpbmcgUF9UUklNLiAqLwpAQCAtMjU5MCw3ICsy
NjA2LDcgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGEoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAq
Y29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAkJCXBlZXJfcmVxLT5mbGFncyB8PSBF
RV9aRVJPT1VUOwogCX0gZWxzZSBpZiAocGktPmNtZCA9PSBQX1pFUk9FUykgewogCQlEX0FTU0VS
VChwZWVyX2RldmljZSwgcGVlcl9yZXEtPmkuc2l6ZSA+IDApOwotCQlEX0FTU0VSVChwZWVyX2Rl
dmljZSwgb3AgPT0gUkVRX09QX1dSSVRFX1pFUk9FUyk7CisJCURfQVNTRVJUKHBlZXJfZGV2aWNl
LCBwZWVyX3JlcV9vcChwZWVyX3JlcSkgPT0gUkVRX09QX1dSSVRFX1pFUk9FUyk7CiAJCURfQVNT
RVJUKHBlZXJfZGV2aWNlLCBwZWVyX3JlcS0+cGFnZXMgPT0gTlVMTCk7CiAJCS8qIERvIChub3Qp
IHBhc3MgZG93biBCTEtERVZfWkVST19OT1VOTUFQPyAqLwogCQlpZiAoZHBfZmxhZ3MgJiBEUF9E
SVNDQVJEKQpAQCAtMjY3Nyw4ICsyNjkzLDcgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGEoc3Ry
dWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAkJ
cGVlcl9yZXEtPmZsYWdzIHw9IEVFX0NBTExfQUxfQ09NUExFVEVfSU87CiAJfQogCi0JZXJyID0g
ZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KGRldmljZSwgcGVlcl9yZXEsIG9wIHwgb3BfZmxhZ3Ms
Ci0JCQkJICAgICAgIERSQkRfRkFVTFRfRFRfV1IpOworCWVyciA9IGRyYmRfc3VibWl0X3BlZXJf
cmVxdWVzdChwZWVyX3JlcSk7CiAJaWYgKCFlcnIpCiAJCXJldHVybiAwOwogCkBAIC0yNzg5LDcg
KzI4MDQsNiBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YVJlcXVlc3Qoc3RydWN0IGRyYmRfY29u
bmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAogCXN0cnVjdCBkcmJkX3BlZXJfcmVx
dWVzdCAqcGVlcl9yZXE7CiAJc3RydWN0IGRpZ2VzdF9pbmZvICpkaSA9IE5VTEw7CiAJaW50IHNp
emUsIHZlcmI7Ci0JdW5zaWduZWQgaW50IGZhdWx0X3R5cGU7CiAJc3RydWN0IHBfYmxvY2tfcmVx
ICpwID0JcGktPmRhdGE7CiAKIAlwZWVyX2RldmljZSA9IGNvbm5fcGVlcl9kZXZpY2UoY29ubmVj
dGlvbiwgcGktPnZucik7CkBAIC0yODQ5LDExICsyODYzLDExIEBAIHN0YXRpYyBpbnQgcmVjZWl2
ZV9EYXRhUmVxdWVzdChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3Qg
cGFja2V0CiAJCXB1dF9sZGV2KGRldmljZSk7CiAJCXJldHVybiAtRU5PTUVNOwogCX0KKwlwZWVy
X3JlcS0+b3BmID0gUkVRX09QX1JFQUQ7CiAKIAlzd2l0Y2ggKHBpLT5jbWQpIHsKIAljYXNlIFBf
REFUQV9SRVFVRVNUOgogCQlwZWVyX3JlcS0+dy5jYiA9IHdfZV9lbmRfZGF0YV9yZXE7Ci0JCWZh
dWx0X3R5cGUgPSBEUkJEX0ZBVUxUX0RUX1JEOwogCQkvKiBhcHBsaWNhdGlvbiBJTywgZG9uJ3Qg
ZHJiZF9yc19iZWdpbl9pbyAqLwogCQlwZWVyX3JlcS0+ZmxhZ3MgfD0gRUVfQVBQTElDQVRJT047
CiAJCWdvdG8gc3VibWl0OwpAQCAtMjg2NywxNCArMjg4MSwxMiBAQCBzdGF0aWMgaW50IHJlY2Vp
dmVfRGF0YVJlcXVlc3Qoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0
IHBhY2tldAogCQlmYWxsdGhyb3VnaDsKIAljYXNlIFBfUlNfREFUQV9SRVFVRVNUOgogCQlwZWVy
X3JlcS0+dy5jYiA9IHdfZV9lbmRfcnNkYXRhX3JlcTsKLQkJZmF1bHRfdHlwZSA9IERSQkRfRkFV
TFRfUlNfUkQ7CiAJCS8qIHVzZWQgaW4gdGhlIHNlY3RvciBvZmZzZXQgcHJvZ3Jlc3MgZGlzcGxh
eSAqLwogCQlkZXZpY2UtPmJtX3Jlc3luY19mbyA9IEJNX1NFQ1RfVE9fQklUKHNlY3Rvcik7CiAJ
CWJyZWFrOwogCiAJY2FzZSBQX09WX1JFUExZOgogCWNhc2UgUF9DU1VNX1JTX1JFUVVFU1Q6Ci0J
CWZhdWx0X3R5cGUgPSBEUkJEX0ZBVUxUX1JTX1JEOwogCQlkaSA9IGttYWxsb2Moc2l6ZW9mKCpk
aSkgKyBwaS0+c2l6ZSwgR0ZQX05PSU8pOwogCQlpZiAoIWRpKQogCQkJZ290byBvdXRfZnJlZV9l
OwpAQCAtMjkyMyw3ICsyOTM1LDYgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGFSZXF1ZXN0KHN0
cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXQKIAkJCQkJKHVu
c2lnbmVkIGxvbmcgbG9uZylzZWN0b3IpOwogCQl9CiAJCXBlZXJfcmVxLT53LmNiID0gd19lX2Vu
ZF9vdl9yZXE7Ci0JCWZhdWx0X3R5cGUgPSBEUkJEX0ZBVUxUX1JTX1JEOwogCQlicmVhazsKIAog
CWRlZmF1bHQ6CkBAIC0yOTc1LDggKzI5ODYsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YVJl
cXVlc3Qoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAog
c3VibWl0OgogCXVwZGF0ZV9yZWNlaXZlcl90aW1pbmdfZGV0YWlscyhjb25uZWN0aW9uLCBkcmJk
X3N1Ym1pdF9wZWVyX3JlcXVlc3QpOwogCWluY191bmFja2VkKGRldmljZSk7Ci0JaWYgKGRyYmRf
c3VibWl0X3BlZXJfcmVxdWVzdChkZXZpY2UsIHBlZXJfcmVxLCBSRVFfT1BfUkVBRCwKLQkJCQkg
ICAgIGZhdWx0X3R5cGUpID09IDApCisJaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChwZWVy
X3JlcSkgPT0gMCkKIAkJcmV0dXJuIDA7CiAKIAkvKiBkb24ndCBjYXJlIGZvciB0aGUgcmVhc29u
IGhlcmUgKi8KQEAgLTQ5NDcsNyArNDk1Nyw2IEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9yc19kZWFs
bG9jYXRlZChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFjCiAK
IAlpZiAoZ2V0X2xkZXYoZGV2aWNlKSkgewogCQlzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBl
ZXJfcmVxOwotCQljb25zdCBlbnVtIHJlcV9vcCBvcCA9IFJFUV9PUF9XUklURV9aRVJPRVM7CiAK
IAkJcGVlcl9yZXEgPSBkcmJkX2FsbG9jX3BlZXJfcmVxKHBlZXJfZGV2aWNlLCBJRF9TWU5DRVIs
IHNlY3RvciwKIAkJCQkJICAgICAgIHNpemUsIDAsIEdGUF9OT0lPKTsKQEAgLTQ5NTcsNiArNDk2
Niw3IEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9yc19kZWFsbG9jYXRlZChzdHJ1Y3QgZHJiZF9jb25u
ZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFjCiAJCX0KIAogCQlwZWVyX3JlcS0+dy5jYiA9
IGVfZW5kX3Jlc3luY19ibG9jazsKKwkJcGVlcl9yZXEtPm9wZiA9IFJFUV9PUF9ESVNDQVJEOwog
CQlwZWVyX3JlcS0+c3VibWl0X2ppZiA9IGppZmZpZXM7CiAJCXBlZXJfcmVxLT5mbGFncyB8PSBF
RV9UUklNOwogCkBAIC00OTY1LDggKzQ5NzUsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfcnNfZGVh
bGxvY2F0ZWQoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhYwog
CQlzcGluX3VubG9ja19pcnEoJmRldmljZS0+cmVzb3VyY2UtPnJlcV9sb2NrKTsKIAogCQlhdG9t
aWNfYWRkKHBpLT5zaXplID4+IDksICZkZXZpY2UtPnJzX3NlY3RfZXYpOwotCQllcnIgPSBkcmJk
X3N1Ym1pdF9wZWVyX3JlcXVlc3QoZGV2aWNlLCBwZWVyX3JlcSwgb3AsCi0JCQkJCSAgICAgICBE
UkJEX0ZBVUxUX1JTX1dSKTsKKwkJZXJyID0gZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHBlZXJf
cmVxKTsKIAogCQlpZiAoZXJyKSB7CiAJCQlzcGluX2xvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNl
LT5yZXFfbG9jayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIu
YyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3dvcmtlci5jCmluZGV4IDBiYjFhOTAwYzJkNS4u
YzY5YmVlZmM5ZDVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIu
YworKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYwpAQCAtNDAwLDEzICs0MDAs
MTMgQEAgc3RhdGljIGludCByZWFkX2Zvcl9jc3VtKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpw
ZWVyX2RldmljZSwgc2VjdG9yX3Qgc2VjdG9yLAogCQlnb3RvIGRlZmVyOwogCiAJcGVlcl9yZXEt
PncuY2IgPSB3X2Vfc2VuZF9jc3VtOworCXBlZXJfcmVxLT5vcGYgPSBSRVFfT1BfUkVBRDsKIAlz
cGluX2xvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNlLT5yZXFfbG9jayk7CiAJbGlzdF9hZGRfdGFp
bCgmcGVlcl9yZXEtPncubGlzdCwgJmRldmljZS0+cmVhZF9lZSk7CiAJc3Bpbl91bmxvY2tfaXJx
KCZkZXZpY2UtPnJlc291cmNlLT5yZXFfbG9jayk7CiAKIAlhdG9taWNfYWRkKHNpemUgPj4gOSwg
JmRldmljZS0+cnNfc2VjdF9ldik7Ci0JaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChkZXZp
Y2UsIHBlZXJfcmVxLCBSRVFfT1BfUkVBRCwKLQkJCQkgICAgIERSQkRfRkFVTFRfUlNfUkQpID09
IDApCisJaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChwZWVyX3JlcSkgPT0gMCkKIAkJcmV0
dXJuIDA7CiAKIAkvKiBJZiBpdCBmYWlsZWQgYmVjYXVzZSBvZiBFTk9NRU0sIHJldHJ5IHNob3Vs
ZCBoZWxwLiAgSWYgaXQgZmFpbGVkCi0tIAoyLjM3LjMKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCmRyYmQtZGV2IG1haWxpbmcgbGlzdApkcmJkLWRldkBs
aXN0cy5saW5iaXQuY29tCmh0dHBzOi8vbGlzdHMubGluYml0LmNvbS9tYWlsbWFuL2xpc3RpbmZv
L2RyYmQtZGV2Cg==
