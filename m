Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id E71744F59D5
	for <lists+drbd-dev@lfdr.de>; Wed,  6 Apr 2022 11:28:42 +0200 (CEST)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id BD834420FC1;
	Wed,  6 Apr 2022 11:28:41 +0200 (CEST)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ed1-f51.google.com (mail-ed1-f51.google.com
	[209.85.208.51])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id A0453420FB4
	for <drbd-dev@lists.linbit.com>; Wed,  6 Apr 2022 11:28:39 +0200 (CEST)
Received: by mail-ed1-f51.google.com with SMTP id d10so1934531edj.0
	for <drbd-dev@lists.linbit.com>; Wed, 06 Apr 2022 02:28:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=message-id:date:mime-version:user-agent:subject:content-language:to
	:references:cc:from:in-reply-to:content-transfer-encoding;
	bh=m1koXNA33sdipTnmVFkmxpoeuENHnq+R7+Gd6wT13Zo=;
	b=NWouHQeNt4hQw32T8acQKzks+zM2N79/IkpDLXvK48lcAMKi+8Uy4PSYq+LYlKjD5Z
	NsIl4d+J1s05iIQwFnJp+eiWDEwHMvkNCpjs3BavtawrSq2abR72PTzoQLMVc9M4xVc4
	4Qi5I0l03lv3oirP+TCgrt8qkq6A0mjxzjVnxN0oX/4i/88C1igbJLTAlUHSxzbBMGI4
	Ie3hOyipeeenDoKUKdVsNrQ1UgXQeLtf87cLImm/Q7jZSEU+Sx5jPcLWH39I2QvORLXZ
	l7lVeq0tWqFpA6gDf45ln60rWi+tEHF4MFzkGmRVBGPyC/vwCw/GYxpJozuQ07I0xmJl
	eRrA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=x-gm-message-state:message-id:date:mime-version:user-agent:subject
	:content-language:to:references:cc:from:in-reply-to
	:content-transfer-encoding;
	bh=m1koXNA33sdipTnmVFkmxpoeuENHnq+R7+Gd6wT13Zo=;
	b=R6KAS2DxTdXDTKi/9WrjxN2hTSk2vQJLqfjOA5CVIX76FvBFzjwfVgdMaP3o4XZzAL
	q18Nw5LWteClWzEZGPWuLFaf4nvsZbbQMuXDEq1LM+25irr4zys99p8aY5k67V/qmrIr
	WxoRBefwjqExz3Q9C67/fUMrVhIbJAYuhyFuh7Uyd4Hdn0AEzeYdipfuGfjZU5Usl6F1
	NEI7cnN6FRxOQBUZtZPgeFGSAoUjECxObJNpk18iUE7cIaRnBxUXiDgBh3T/lCgHdfVp
	OCcjN5mpF+Fo+2r/TlUw26gD4hhpZouwxNRYftLOJwrP+G1qKlHyXClkNjkhdijgUPAk
	tPZg==
X-Gm-Message-State: AOAM533YugfA0cFCPpc4uCAcHTNxMnAd0eHjcFTaRwcrfIOX71KXaiyx
	bgzPHWjnBYCCUeuG6ethlhfRfK3J
X-Google-Smtp-Source: ABdhPJycY6Pftsk/QIJx8bKRTDQgJDs5fHB5Msx8yJlO/fWgITQKdsCJxZdv6ZCASK+pR5TLjzx96A==
X-Received: by 2002:aa7:cb93:0:b0:415:d57a:4603 with SMTP id
	r19-20020aa7cb93000000b00415d57a4603mr7743711edt.62.1649237318739;
	Wed, 06 Apr 2022 02:28:38 -0700 (PDT)
Received: from [192.168.178.55] (85-127-190-169.dsl.dynamic.surfer.at.
	[85.127.190.169]) by smtp.gmail.com with ESMTPSA id
	v20-20020a056402349400b00419651e513asm7822259edc.45.2022.04.06.02.28.37
	(version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
	Wed, 06 Apr 2022 02:28:38 -0700 (PDT)
Message-ID: <57862355-5c67-804d-0e4f-7c10ad5d411d@linbit.com>
Date: Wed, 6 Apr 2022 11:28:36 +0200
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101
	Thunderbird/91.7.0
Content-Language: en-US
To: Christoph Hellwig <hch@lst.de>
References: <20220406060516.409838-1-hch@lst.de>
	<20220406060516.409838-7-hch@lst.de>
From: =?UTF-8?Q?Christoph_B=c3=b6hmwalder?= <christoph.boehmwalder@linbit.com>
In-Reply-To: <20220406060516.409838-7-hch@lst.de>
Cc: linux-block@vger.kernel.org, Jens Axboe <axboe@kernel.dk>,
	drbd-dev@lists.linbit.com
Subject: Re: [Drbd-dev] [PATCH 06/27] drbd: cleanup decide_on_discard_support
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

QW0gMDYuMDQuMjIgdW0gMDg6MDQgc2NocmllYiBDaHJpc3RvcGggSGVsbHdpZzoKPiBTYW5pdGl6
ZSB0aGUgY2FsbGluZyBjb252ZW50aW9ucyBhbmQgdXNlIGEgZ290byBsYWJlbCB0byBjbGVhbnVw
IHRoZQo+IGNvZGUgZmxvdy4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGggSGVsbHdpZyA8
aGNoQGxzdC5kZT4KPiAtLS0KPiAgZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYyB8IDY4ICsr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQo+ICAxIGZpbGUgY2hhbmdlZCwgMzUg
aW5zZXJ0aW9ucygrKSwgMzMgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
YmxvY2svZHJiZC9kcmJkX25sLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9ubC5jCj4gaW5k
ZXggMDIwMzBjOWM0ZDNiMS4uNDBiYjBiMzU2YTZkNiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2Js
b2NrL2RyYmQvZHJiZF9ubC5jCj4gKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYwo+
IEBAIC0xMjA0LDM4ICsxMjA0LDQyIEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgZHJiZF9tYXhfZGlz
Y2FyZF9zZWN0b3JzKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24pCj4gIH0KPiAg
Cj4gIHN0YXRpYyB2b2lkIGRlY2lkZV9vbl9kaXNjYXJkX3N1cHBvcnQoc3RydWN0IGRyYmRfZGV2
aWNlICpkZXZpY2UsCj4gLQkJCXN0cnVjdCByZXF1ZXN0X3F1ZXVlICpxLAo+IC0JCQlzdHJ1Y3Qg
cmVxdWVzdF9xdWV1ZSAqYiwKPiAtCQkJYm9vbCBkaXNjYXJkX3plcm9lc19pZl9hbGlnbmVkKQo+
ICsJCXN0cnVjdCBkcmJkX2JhY2tpbmdfZGV2ICpiZGV2KQo+ICB7Cj4gLQkvKiBxID0gZHJiZCBk
ZXZpY2UgcXVldWUgKGRldmljZS0+cnFfcXVldWUpCj4gLQkgKiBiID0gYmFja2luZyBkZXZpY2Ug
cXVldWUgKGRldmljZS0+bGRldi0+YmFja2luZ19iZGV2LT5iZF9kaXNrLT5xdWV1ZSksCj4gLQkg
KiAgICAgb3IgTlVMTCBpZiBkaXNrbGVzcwo+IC0JICovCj4gLQlzdHJ1Y3QgZHJiZF9jb25uZWN0
aW9uICpjb25uZWN0aW9uID0gZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+Y29ubmVjdGlvbjsK
PiAtCWJvb2wgY2FuX2RvID0gYiA/IGJsa19xdWV1ZV9kaXNjYXJkKGIpIDogdHJ1ZTsKPiAtCj4g
LQlpZiAoY2FuX2RvICYmIGNvbm5lY3Rpb24tPmNzdGF0ZSA+PSBDX0NPTk5FQ1RFRCAmJiAhKGNv
bm5lY3Rpb24tPmFncmVlZF9mZWF0dXJlcyAmIERSQkRfRkZfVFJJTSkpIHsKPiAtCQljYW5fZG8g
PSBmYWxzZTsKPiAtCQlkcmJkX2luZm8oY29ubmVjdGlvbiwgInBlZXIgRFJCRCB0b28gb2xkLCBk
b2VzIG5vdCBzdXBwb3J0IFRSSU06IGRpc2FibGluZyBkaXNjYXJkc1xuIik7Cj4gLQl9Cj4gLQlp
ZiAoY2FuX2RvKSB7Cj4gLQkJLyogV2UgZG9uJ3QgY2FyZSBmb3IgdGhlIGdyYW51bGFyaXR5LCBy
ZWFsbHkuCj4gLQkJICogU3RhY2tpbmcgbGltaXRzIGJlbG93IHNob3VsZCBmaXggaXQgZm9yIHRo
ZSBsb2NhbAo+IC0JCSAqIGRldmljZS4gIFdoZXRoZXIgb3Igbm90IGl0IGlzIGEgc3VpdGFibGUg
Z3JhbnVsYXJpdHkKPiAtCQkgKiBvbiB0aGUgcmVtb3RlIGRldmljZSBpcyBub3Qgb3VyIHByb2Js
ZW0sIHJlYWxseS4gSWYKPiAtCQkgKiB5b3UgY2FyZSwgeW91IG5lZWQgdG8gdXNlIGRldmljZXMg
d2l0aCBzaW1pbGFyCj4gLQkJICogdG9wb2xvZ3kgb24gYWxsIHBlZXJzLiAqLwo+IC0JCWJsa19x
dWV1ZV9kaXNjYXJkX2dyYW51bGFyaXR5KHEsIDUxMik7Cj4gLQkJcS0+bGltaXRzLm1heF9kaXNj
YXJkX3NlY3RvcnMgPSBkcmJkX21heF9kaXNjYXJkX3NlY3RvcnMoY29ubmVjdGlvbik7Cj4gLQkJ
YmxrX3F1ZXVlX2ZsYWdfc2V0KFFVRVVFX0ZMQUdfRElTQ0FSRCwgcSk7Cj4gLQkJcS0+bGltaXRz
Lm1heF93cml0ZV96ZXJvZXNfc2VjdG9ycyA9IGRyYmRfbWF4X2Rpc2NhcmRfc2VjdG9ycyhjb25u
ZWN0aW9uKTsKPiAtCX0gZWxzZSB7Cj4gLQkJYmxrX3F1ZXVlX2ZsYWdfY2xlYXIoUVVFVUVfRkxB
R19ESVNDQVJELCBxKTsKPiAtCQlibGtfcXVldWVfZGlzY2FyZF9ncmFudWxhcml0eShxLCAwKTsK
PiAtCQlxLT5saW1pdHMubWF4X2Rpc2NhcmRfc2VjdG9ycyA9IDA7Cj4gLQkJcS0+bGltaXRzLm1h
eF93cml0ZV96ZXJvZXNfc2VjdG9ycyA9IDA7Cj4gKwlzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpj
b25uZWN0aW9uID0KPiArCQlmaXJzdF9wZWVyX2RldmljZShkZXZpY2UpLT5jb25uZWN0aW9uOwo+
ICsJc3RydWN0IHJlcXVlc3RfcXVldWUgKnEgPSBkZXZpY2UtPnJxX3F1ZXVlOwo+ICsKPiArCWlm
IChiZGV2ICYmICFibGtfcXVldWVfZGlzY2FyZChiZGV2LT5iYWNraW5nX2JkZXYtPmJkX2Rpc2st
PnF1ZXVlKSkKPiArCQlnb3RvIG5vdF9zdXBwb3J0ZWQ7Cj4gKwo+ICsJaWYgKGNvbm5lY3Rpb24t
PmNzdGF0ZSA+PSBDX0NPTk5FQ1RFRCAmJgo+ICsJICAgICEoY29ubmVjdGlvbi0+YWdyZWVkX2Zl
YXR1cmVzICYgRFJCRF9GRl9UUklNKSkgewo+ICsJCWRyYmRfaW5mbyhjb25uZWN0aW9uLAo+ICsJ
CQkicGVlciBEUkJEIHRvbyBvbGQsIGRvZXMgbm90IHN1cHBvcnQgVFJJTTogZGlzYWJsaW5nIGRp
c2NhcmRzXG4iKTsKPiArCQlnb3RvIG5vdF9zdXBwb3J0ZWQ7Cj4gIAl9Cj4gKwo+ICsJLyoKPiAr
CSAqIFdlIGRvbid0IGNhcmUgZm9yIHRoZSBncmFudWxhcml0eSwgcmVhbGx5Lgo+ICsJICoKPiAr
CSAqIFN0YWNraW5nIGxpbWl0cyBiZWxvdyBzaG91bGQgZml4IGl0IGZvciB0aGUgbG9jYWwgZGV2
aWNlLiAgV2hldGhlciBvcgo+ICsJICogbm90IGl0IGlzIGEgc3VpdGFibGUgZ3JhbnVsYXJpdHkg
b24gdGhlIHJlbW90ZSBkZXZpY2UgaXMgbm90IG91cgo+ICsJICogcHJvYmxlbSwgcmVhbGx5LiBJ
ZiB5b3UgY2FyZSwgeW91IG5lZWQgdG8gdXNlIGRldmljZXMgd2l0aCBzaW1pbGFyCj4gKwkgKiB0
b3BvbG9neSBvbiBhbGwgcGVlcnMuCj4gKwkgKi8KPiArCWJsa19xdWV1ZV9kaXNjYXJkX2dyYW51
bGFyaXR5KHEsIDUxMik7Cj4gKwlxLT5saW1pdHMubWF4X2Rpc2NhcmRfc2VjdG9ycyA9IGRyYmRf
bWF4X2Rpc2NhcmRfc2VjdG9ycyhjb25uZWN0aW9uKTsKPiArCWJsa19xdWV1ZV9mbGFnX3NldChR
VUVVRV9GTEFHX0RJU0NBUkQsIHEpOwo+ICsJcS0+bGltaXRzLm1heF93cml0ZV96ZXJvZXNfc2Vj
dG9ycyA9Cj4gKwkJZHJiZF9tYXhfZGlzY2FyZF9zZWN0b3JzKGNvbm5lY3Rpb24pOwo+ICsJcmV0
dXJuOwo+ICsKPiArbm90X3N1cHBvcnRlZDoKPiArCWJsa19xdWV1ZV9mbGFnX2NsZWFyKFFVRVVF
X0ZMQUdfRElTQ0FSRCwgcSk7Cj4gKwlibGtfcXVldWVfZGlzY2FyZF9ncmFudWxhcml0eShxLCAw
KTsKPiArCXEtPmxpbWl0cy5tYXhfZGlzY2FyZF9zZWN0b3JzID0gMDsKPiArCXEtPmxpbWl0cy5t
YXhfd3JpdGVfemVyb2VzX3NlY3RvcnMgPSAwOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCBmaXh1
cF9kaXNjYXJkX2lmX25vdF9zdXBwb3J0ZWQoc3RydWN0IHJlcXVlc3RfcXVldWUgKnEpCj4gQEAg
LTEyNzMsNyArMTI3Nyw2IEBAIHN0YXRpYyB2b2lkIGRyYmRfc2V0dXBfcXVldWVfcGFyYW0oc3Ry
dWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHN0cnVjdCBkcmJkX2JhY2tpCj4gIAl1bnNpZ25lZCBp
bnQgbWF4X3NlZ21lbnRzID0gMDsKPiAgCXN0cnVjdCByZXF1ZXN0X3F1ZXVlICpiID0gTlVMTDsK
PiAgCXN0cnVjdCBkaXNrX2NvbmYgKmRjOwo+IC0JYm9vbCBkaXNjYXJkX3plcm9lc19pZl9hbGln
bmVkID0gdHJ1ZTsKPiAgCj4gIAlpZiAoYmRldikgewo+ICAJCWIgPSBiZGV2LT5iYWNraW5nX2Jk
ZXYtPmJkX2Rpc2stPnF1ZXVlOwo+IEBAIC0xMjgyLDcgKzEyODUsNiBAQCBzdGF0aWMgdm9pZCBk
cmJkX3NldHVwX3F1ZXVlX3BhcmFtKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzdHJ1Y3Qg
ZHJiZF9iYWNraQo+ICAJCXJjdV9yZWFkX2xvY2soKTsKPiAgCQlkYyA9IHJjdV9kZXJlZmVyZW5j
ZShkZXZpY2UtPmxkZXYtPmRpc2tfY29uZik7Cj4gIAkJbWF4X3NlZ21lbnRzID0gZGMtPm1heF9i
aW9fYnZlY3M7Cj4gLQkJZGlzY2FyZF96ZXJvZXNfaWZfYWxpZ25lZCA9IGRjLT5kaXNjYXJkX3pl
cm9lc19pZl9hbGlnbmVkOwo+ICAJCXJjdV9yZWFkX3VubG9jaygpOwo+ICAKPiAgCQlibGtfc2V0
X3N0YWNraW5nX2xpbWl0cygmcS0+bGltaXRzKTsKPiBAQCAtMTI5Miw3ICsxMjk0LDcgQEAgc3Rh
dGljIHZvaWQgZHJiZF9zZXR1cF9xdWV1ZV9wYXJhbShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSwgc3RydWN0IGRyYmRfYmFja2kKPiAgCS8qIFRoaXMgaXMgdGhlIHdvcmthcm91bmQgZm9yICJi
aW8gd291bGQgbmVlZCB0bywgYnV0IGNhbm5vdCwgYmUgc3BsaXQiICovCj4gIAlibGtfcXVldWVf
bWF4X3NlZ21lbnRzKHEsIG1heF9zZWdtZW50cyA/IG1heF9zZWdtZW50cyA6IEJMS19NQVhfU0VH
TUVOVFMpOwo+ICAJYmxrX3F1ZXVlX3NlZ21lbnRfYm91bmRhcnkocSwgUEFHRV9TSVpFLTEpOwo+
IC0JZGVjaWRlX29uX2Rpc2NhcmRfc3VwcG9ydChkZXZpY2UsIHEsIGIsIGRpc2NhcmRfemVyb2Vz
X2lmX2FsaWduZWQpOwo+ICsJZGVjaWRlX29uX2Rpc2NhcmRfc3VwcG9ydChkZXZpY2UsIGJkZXYp
Owo+ICAKPiAgCWlmIChiKSB7Cj4gIAkJYmxrX3N0YWNrX2xpbWl0cygmcS0+bGltaXRzLCAmYi0+
bGltaXRzLCAwKTsKCkFja2VkLWJ5OiBDaHJpc3RvcGggQsO2aG13YWxkZXIgPGNocmlzdG9waC5i
b2VobXdhbGRlckBsaW5iaXQuY29tPgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmJkLWRldiBtYWlsaW5nIGxpc3QKZHJiZC1kZXZAbGlzdHMubGluYml0
LmNvbQpodHRwczovL2xpc3RzLmxpbmJpdC5jb20vbWFpbG1hbi9saXN0aW5mby9kcmJkLWRldgo=
