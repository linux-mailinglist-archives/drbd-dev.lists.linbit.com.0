Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id E7AC360AD72
	for <lists+drbd-dev@lfdr.de>; Mon, 24 Oct 2022 16:24:49 +0200 (CEST)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 59B294204B5;
	Mon, 24 Oct 2022 16:24:49 +0200 (CEST)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ed1-f44.google.com (mail-ed1-f44.google.com
	[209.85.208.44])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 700F7420372
	for <drbd-dev@lists.linbit.com>; Mon, 24 Oct 2022 16:24:47 +0200 (CEST)
Received: by mail-ed1-f44.google.com with SMTP id y12so11621409edc.9
	for <drbd-dev@lists.linbit.com>; Mon, 24 Oct 2022 07:24:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:from:to:cc:subject:date:message-id:reply-to;
	bh=W7ZqEfVxWwm8B+8/aOBYzYrBXeUJ6L3DiwQietacAiI=;
	b=6KWdizJSHaLPR8UviWNrSt7fM12rCUyFHuV0SticKZKUj7pJDJcS3pSy6v36sIBqTZ
	UzXX4rP2TljCoNUYQhHQXhQ54a7hDTVwox7xQI+Vge9CDIUMArvEMcIBd8VnK7uSMr3h
	AYrHp1S6akU5h7WBG3FxZL+jpasngiT/iAiz9e3SwzFKV1eVkwKkUDW1Lc0m0GHU5/AG
	rmwg6E1cbC3h1ndXKYj4goD5oL1fvDhWIHhtWxguFBh7+q+cK79e+wk0LcveyNI0oWC8
	bRnU/i9al4xq5mgHhK2u9rcEOZvrFZF+LOiEix+1Dc98zBSRc+yguZCvVty9aSZBfOl3
	g+sA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:x-gm-message-state:from:to:cc:subject:date:message-id
	:reply-to;
	bh=W7ZqEfVxWwm8B+8/aOBYzYrBXeUJ6L3DiwQietacAiI=;
	b=MsY3eBJCosLDup9c5Czx1SJpsKZq3MPVhrG90jHpgP9fkyFElrTZXpZ6o1H8fXQUkw
	FM/L2Z4mpcRav1+ob5mlvuQmkqYK8lY3Uynu+emtKIxaQuYTl/AvGrAjgxefsN0zi5LH
	LzMlIweySTUC+OZWdRHWU6DwsuBSoZd8KhazgngiSk0vIgiYi8hWiS7y9xm+dcCgnPvx
	vXwg2G7xpNQARf5oDGdN+YCZ+tfuwVL1PlBixFuGEAqNQV3f1zsOl08rPr3Xm8RwiTas
	rep0j4vQe2uqu/CAsu61JgeGgjSuGe3DFJpJHfz6YgvPPLM1298laC71Z2XSWuBLQCVA
	c+UQ==
X-Gm-Message-State: ACrzQf0WVOlIv9Ssgs0ooX0YZvjYj76q9olSMjsfG+cuVi6CbVNqdve7
	bLcFRtpMsntV903ti62htv2gE1B1
X-Google-Smtp-Source: AMsMyM7JjQDRW8I9nwJHb3ikwTTs5hHG1M7rlynUTOVX0AyzBQmgszvjGarX1NZa5k6myLPzHkdZ5w==
X-Received: by 2002:a17:906:cc0f:b0:7a0:b91c:855f with SMTP id
	ml15-20020a170906cc0f00b007a0b91c855fmr11184702ejb.26.1666621486697;
	Mon, 24 Oct 2022 07:24:46 -0700 (PDT)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	o14-20020a170906768e00b0077a8fa8ba55sm15540808ejm.210.2022.10.24.07.24.46
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Mon, 24 Oct 2022 07:24:46 -0700 (PDT)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Mon, 24 Oct 2022 16:24:24 +0200
Message-Id: <20221024142424.25877-1-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.37.3
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH v3] drbd: Store op in drbd_peer_request
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

KFNvcnQgb2YpIGNoZXJyeS1waWNrZWQgZnJvbSB0aGUgb3V0LW9mLXRyZWUgZHJiZDkgYnJhbmNo
LiBPcmlnaW5hbApjb21taXQgbWVzc2FnZSBieSBKb2VsIENvbGxlZGdlOgoKICAgIFRoaXMgc2lt
cGxpZmllcyBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QgYnkgcmVtb3ZpbmcgbW9zdCBvZiB0aGUK
ICAgIGFyZ3VtZW50cy4gSXQgYWxzbyBtYWtlcyB0aGUgdHJlYXRtZW50IG9mIHRoZSBvcCBiZXR0
ZXIgYWxpZ25lZCB3aXRoCiAgICB0aGF0IGluIHN0cnVjdCBiaW8uCgogICAgRGV0ZXJtaW5lIGZh
dWx0X3R5cGUgZHluYW1pY2FsbHkgdXNpbmcgaW5mb3JtYXRpb24gd2hpY2ggaXMgYWxyZWFkeQog
ICAgYXZhaWxhYmxlIGluc3RlYWQgb2YgcGFzc2luZyBpdCBpbiBhcyBhIHBhcmFtZXRlci4KCk5v
dGU6IFRoZSBvcGYgaW4gcmVjZWl2ZV9yc19kZWFsbG9jYXRlZCB3YXMgY2hhbmdlZCBmcm9tClJF
UV9PUF9XUklURV9aRVJPRVMgdG8gUkVRX09QX0RJU0NBUkQuIFRoaXMgd2FzIHJlcXVpcmVkIGlu
IHRoZQpvdXQtb2YtdHJlZSBtb2R1bGUsIGFuZCBkb2VzIG5vdCBtYXR0ZXIgaW4tdHJlZS4gVGhl
IG9wZiBpcyBpZ25vcmVkCmFueXdheSBpbiBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QsIHNpbmNl
IHRoZSBkaXNjYXJkL3plcm8tb3V0IGlzCmRlY2lkZWQgYnkgdGhlIEVFX1RSSU0gZmxhZy4KClNp
Z25lZC1vZmYtYnk6IEpvZWwgQ29sbGVkZ2UgPGpvZWwuY29sbGVkZ2VAbGluYml0LmNvbT4KU2ln
bmVkLW9mZi1ieTogQ2hyaXN0b3BoIELDtmhtd2FsZGVyIDxjaHJpc3RvcGguYm9laG13YWxkZXJA
bGluYml0LmNvbT4KLS0tCkNoYW5nZXMgZnJvbSB2MjoKKiBGaXggdHlwZSBtaXNtYXRjaAoqIEZp
eCBjaGVja3BhdGNoIHdhcm5pbmdzCi0tLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50Lmgg
ICAgICB8ICA4ICsrLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIuYyB8IDgxICsr
KysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfd29y
a2VyLmMgICB8ICA0ICstCiAzIGZpbGVzIGNoYW5nZWQsIDUzIGluc2VydGlvbnMoKyksIDQwIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oIGIv
ZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmgKaW5kZXggNGQ2NjEyODJmZjQxLi45MTNjZjRj
NTVjYmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oCisrKyBiL2Ry
aXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oCkBAIC0zOTUsNiArMzk1LDcgQEAgc3RydWN0IGRy
YmRfcGVlcl9yZXF1ZXN0IHsKIAlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2U7
CiAJc3RydWN0IGRyYmRfZXBvY2ggKmVwb2NoOyAvKiBmb3Igd3JpdGVzICovCiAJc3RydWN0IHBh
Z2UgKnBhZ2VzOworCWJsa19vcGZfdCBvcGY7CiAJYXRvbWljX3QgcGVuZGluZ19iaW9zOwogCXN0
cnVjdCBkcmJkX2ludGVydmFsIGk7CiAJLyogc2VlIGNvbW1lbnRzIG9uIGVlIGZsYWcgYml0cyBi
ZWxvdyAqLwpAQCAtNDA2LDYgKzQwNywxMCBAQCBzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3Qgewog
CX07CiB9OwogCisvKiBFcXVpdmFsZW50IHRvIGJpb19vcCBhbmQgcmVxX29wLiAqLworI2RlZmlu
ZSBwZWVyX3JlcV9vcChwZWVyX3JlcSkgXAorCSgocGVlcl9yZXEpLT5vcGYgJiBSRVFfT1BfTUFT
SykKKwogLyogZWUgZmxhZyBiaXRzLgogICogV2hpbGUgY29ycmVzcG9uZGluZyBiaW9zIGFyZSBp
biBmbGlnaHQsIHRoZSBvbmx5IG1vZGlmaWNhdGlvbiB3aWxsIGJlCiAgKiBzZXRfYml0IFdBU19F
UlJPUiwgd2hpY2ggaGFzIHRvIGJlIGF0b21pYy4KQEAgLTE1NDUsOCArMTU1MCw3IEBAIGV4dGVy
biB2b2lkIGRyYmRfc2VuZF9hY2tzX3dmKHN0cnVjdCB3b3JrX3N0cnVjdCAqd3MpOwogZXh0ZXJu
IGJvb2wgZHJiZF9yc19jX21pbl9yYXRlX3Rocm90dGxlKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2
aWNlKTsKIGV4dGVybiBib29sIGRyYmRfcnNfc2hvdWxkX3Nsb3dfZG93bihzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKmRldmljZSwgc2VjdG9yX3Qgc2VjdG9yLAogCQlib29sIHRocm90dGxlX2lmX2FwcF9p
c193YWl0aW5nKTsKLWV4dGVybiBpbnQgZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHN0cnVjdCBk
cmJkX2RldmljZSAqLAotCQkJCSAgICBzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKiwgYmxrX29w
Zl90LCBpbnQpOworZXh0ZXJuIGludCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qoc3RydWN0IGRy
YmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcSk7CiBleHRlcm4gaW50IGRyYmRfZnJlZV9wZWVyX3Jl
cXMoc3RydWN0IGRyYmRfZGV2aWNlICosIHN0cnVjdCBsaXN0X2hlYWQgKik7CiBleHRlcm4gc3Ry
dWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICpkcmJkX2FsbG9jX3BlZXJfcmVxKHN0cnVjdCBkcmJkX3Bl
ZXJfZGV2aWNlICosIHU2NCwKIAkJCQkJCSAgICAgc2VjdG9yX3QsIHVuc2lnbmVkIGludCwKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMgYi9kcml2ZXJzL2Js
b2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jCmluZGV4IGM4OTdjNDU3MjAzNi4uOTVlZGU1ZGEzNTQw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jCisrKyBiL2Ry
aXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMKQEAgLTE2MDMsOSArMTYwMywxOSBAQCBz
dGF0aWMgdm9pZCBkcmJkX2lzc3VlX3BlZXJfZGlzY2FyZF9vcl96ZXJvX291dChzdHJ1Y3QgZHJi
ZF9kZXZpY2UgKmRldmljZSwgc3RydQogCWRyYmRfZW5kaW9fd3JpdGVfc2VjX2ZpbmFsKHBlZXJf
cmVxKTsKIH0KIAorc3RhdGljIGludCBwZWVyX3JlcXVlc3RfZmF1bHRfdHlwZShzdHJ1Y3QgZHJi
ZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxKQoreworCWlmIChwZWVyX3JlcV9vcChwZWVyX3JlcSkg
PT0gUkVRX09QX1JFQUQpIHsKKwkJcmV0dXJuIHBlZXJfcmVxLT5mbGFncyAmIEVFX0FQUExJQ0FU
SU9OID8KKwkJCURSQkRfRkFVTFRfRFRfUkQgOiBEUkJEX0ZBVUxUX1JTX1JEOworCX0gZWxzZSB7
CisJCXJldHVybiBwZWVyX3JlcS0+ZmxhZ3MgJiBFRV9BUFBMSUNBVElPTiA/CisJCQlEUkJEX0ZB
VUxUX0RUX1dSIDogRFJCRF9GQVVMVF9SU19XUjsKKwl9Cit9CisKIC8qKgogICogZHJiZF9zdWJt
aXRfcGVlcl9yZXF1ZXN0KCkKLSAqIEBkZXZpY2U6CURSQkQgZGV2aWNlLgogICogQHBlZXJfcmVx
OglwZWVyIHJlcXVlc3QKICAqCiAgKiBNYXkgc3ByZWFkIHRoZSBwYWdlcyB0byBtdWx0aXBsZSBi
aW9zLApAQCAtMTYxOSwxMCArMTYyOSw5IEBAIHN0YXRpYyB2b2lkIGRyYmRfaXNzdWVfcGVlcl9k
aXNjYXJkX29yX3plcm9fb3V0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzdHJ1CiAgKiAg
b24gY2VydGFpbiBYZW4gZGVwbG95bWVudHMuCiAgKi8KIC8qIFRPRE8gYWxsb2NhdGUgZnJvbSBv
dXIgb3duIGJpb19zZXQuICovCi1pbnQgZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHN0cnVjdCBk
cmJkX2RldmljZSAqZGV2aWNlLAotCQkJICAgICBzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBl
ZXJfcmVxLAotCQkJICAgICBjb25zdCBibGtfb3BmX3Qgb3BmLCBjb25zdCBpbnQgZmF1bHRfdHlw
ZSkKK2ludCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qoc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0
ICpwZWVyX3JlcSkKIHsKKwlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9IHBlZXJfcmVxLT5w
ZWVyX2RldmljZS0+ZGV2aWNlOwogCXN0cnVjdCBiaW8gKmJpb3MgPSBOVUxMOwogCXN0cnVjdCBi
aW8gKmJpbzsKIAlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHBlZXJfcmVxLT5wYWdlczsKQEAgLTE2Njcs
NyArMTY3NiwxOCBAQCBpbnQgZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHN0cnVjdCBkcmJkX2Rl
dmljZSAqZGV2aWNlLAogCSAqIGdlbmVyYXRlZCBiaW8sIGJ1dCBhIGJpbyBhbGxvY2F0ZWQgb24g
YmVoYWxmIG9mIHRoZSBwZWVyLgogCSAqLwogbmV4dF9iaW86Ci0JYmlvID0gYmlvX2FsbG9jKGRl
dmljZS0+bGRldi0+YmFja2luZ19iZGV2LCBucl9wYWdlcywgb3BmLCBHRlBfTk9JTyk7CisJLyog
X0RJU0NBUkQsIF9XUklURV9aRVJPRVMgaGFuZGxlZCBhYm92ZS4KKwkgKiBSRVFfT1BfRkxVU0gg
KGVtcHR5IGZsdXNoKSBub3QgZXhwZWN0ZWQsCisJICogc2hvdWxkIGhhdmUgYmVlbiBtYXBwZWQg
dG8gYSAiZHJiZCBwcm90b2NvbCBiYXJyaWVyIi4KKwkgKiBSRVFfT1BfU0VDVVJFX0VSQVNFOiBJ
IGRvbid0IHNlZSBob3cgd2UgY291bGQgZXZlciBzdXBwb3J0IHRoYXQuCisJICovCisJaWYgKCEo
cGVlcl9yZXFfb3AocGVlcl9yZXEpID09IFJFUV9PUF9XUklURSB8fAorCQkJCXBlZXJfcmVxX29w
KHBlZXJfcmVxKSA9PSBSRVFfT1BfUkVBRCkpIHsKKwkJZHJiZF9lcnIoZGV2aWNlLCAiSW52YWxp
ZCBiaW8gb3AgcmVjZWl2ZWQ6IDB4JXhcbiIsIHBlZXJfcmVxLT5vcGYpOworCQlyZXR1cm4gLUVJ
TlZBTDsKKwl9CisKKwliaW8gPSBiaW9fYWxsb2MoZGV2aWNlLT5sZGV2LT5iYWNraW5nX2JkZXYs
IG5yX3BhZ2VzLCBwZWVyX3JlcS0+b3BmLCBHRlBfTk9JTyk7CiAJLyogPiBwZWVyX3JlcS0+aS5z
ZWN0b3IsIHVubGVzcyB0aGlzIGlzIHRoZSBmaXJzdCBiaW8gKi8KIAliaW8tPmJpX2l0ZXIuYmlf
c2VjdG9yID0gc2VjdG9yOwogCWJpby0+YmlfcHJpdmF0ZSA9IHBlZXJfcmVxOwpAQCAtMTY5Nyw3
ICsxNzE3LDcgQEAgaW50IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKmRldmljZSwKIAkJYmlvcyA9IGJpb3MtPmJpX25leHQ7CiAJCWJpby0+YmlfbmV4dCA9IE5V
TEw7CiAKLQkJZHJiZF9zdWJtaXRfYmlvX25vYWNjdChkZXZpY2UsIGZhdWx0X3R5cGUsIGJpbyk7
CisJCWRyYmRfc3VibWl0X2Jpb19ub2FjY3QoZGV2aWNlLCBwZWVyX3JlcXVlc3RfZmF1bHRfdHlw
ZShwZWVyX3JlcSksIGJpbyk7CiAJfSB3aGlsZSAoYmlvcyk7CiAJcmV0dXJuIDA7CiB9CkBAIC0y
MDUxLDYgKzIwNzEsNyBAQCBzdGF0aWMgaW50IHJlY3ZfcmVzeW5jX3JlYWQoc3RydWN0IGRyYmRf
cGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0bwogCSAqIHJlc3BlY3RpdmUg
X2RyYmRfY2xlYXJfZG9uZV9lZSAqLwogCiAJcGVlcl9yZXEtPncuY2IgPSBlX2VuZF9yZXN5bmNf
YmxvY2s7CisJcGVlcl9yZXEtPm9wZiA9IFJFUV9PUF9XUklURTsKIAlwZWVyX3JlcS0+c3VibWl0
X2ppZiA9IGppZmZpZXM7CiAKIAlzcGluX2xvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNlLT5yZXFf
bG9jayk7CkBAIC0yMDU4LDggKzIwNzksNyBAQCBzdGF0aWMgaW50IHJlY3ZfcmVzeW5jX3JlYWQo
c3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0bwogCXNw
aW5fdW5sb2NrX2lycSgmZGV2aWNlLT5yZXNvdXJjZS0+cmVxX2xvY2spOwogCiAJYXRvbWljX2Fk
ZChwaS0+c2l6ZSA+PiA5LCAmZGV2aWNlLT5yc19zZWN0X2V2KTsKLQlpZiAoZHJiZF9zdWJtaXRf
cGVlcl9yZXF1ZXN0KGRldmljZSwgcGVlcl9yZXEsIFJFUV9PUF9XUklURSwKLQkJCQkgICAgIERS
QkRfRkFVTFRfUlNfV1IpID09IDApCisJaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChwZWVy
X3JlcSkgPT0gMCkKIAkJcmV0dXJuIDA7CiAKIAkvKiBkb24ndCBjYXJlIGZvciB0aGUgcmVhc29u
IGhlcmUgKi8KQEAgLTIzNzUsMTYgKzIzOTUsNiBAQCBzdGF0aWMgaW50IHdhaXRfZm9yX2FuZF91
cGRhdGVfcGVlcl9zZXEoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBjbwog
CXJldHVybiByZXQ7CiB9CiAKLS8qIHNlZSBhbHNvIGJpb19mbGFnc190b193aXJlKCkKLSAqIERS
QkRfUkVRXyosIGJlY2F1c2Ugd2UgbmVlZCB0byBzZW1hbnRpY2FsbHkgbWFwIHRoZSBmbGFncyB0
byBkYXRhIHBhY2tldAotICogZmxhZ3MgYW5kIGJhY2suIFdlIG1heSByZXBsaWNhdGUgdG8gb3Ro
ZXIga2VybmVsIHZlcnNpb25zLiAqLwotc3RhdGljIGJsa19vcGZfdCB3aXJlX2ZsYWdzX3RvX2Jp
b19mbGFncyh1MzIgZHBmKQotewotCXJldHVybiAgKGRwZiAmIERQX1JXX1NZTkMgPyBSRVFfU1lO
QyA6IDApIHwKLQkJKGRwZiAmIERQX0ZVQSA/IFJFUV9GVUEgOiAwKSB8Ci0JCShkcGYgJiBEUF9G
TFVTSCA/IFJFUV9QUkVGTFVTSCA6IDApOwotfQotCiBzdGF0aWMgZW51bSByZXFfb3Agd2lyZV9m
bGFnc190b19iaW9fb3AodTMyIGRwZikKIHsKIAlpZiAoZHBmICYgRFBfWkVST0VTKQpAQCAtMjM5
NSw2ICsyNDA1LDE1IEBAIHN0YXRpYyBlbnVtIHJlcV9vcCB3aXJlX2ZsYWdzX3RvX2Jpb19vcCh1
MzIgZHBmKQogCQlyZXR1cm4gUkVRX09QX1dSSVRFOwogfQogCisvKiBzZWUgYWxzbyBiaW9fZmxh
Z3NfdG9fd2lyZSgpICovCitzdGF0aWMgYmxrX29wZl90IHdpcmVfZmxhZ3NfdG9fYmlvKHN0cnVj
dCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHUzMiBkcGYpCit7CisJcmV0dXJuIHdpcmVf
ZmxhZ3NfdG9fYmlvX29wKGRwZikgfAorCQkoZHBmICYgRFBfUldfU1lOQyA/IFJFUV9TWU5DIDog
MCkgfAorCQkoZHBmICYgRFBfRlVBID8gUkVRX0ZVQSA6IDApIHwKKwkJKGRwZiAmIERQX0ZMVVNI
ID8gUkVRX1BSRUZMVVNIIDogMCk7Cit9CisKIHN0YXRpYyB2b2lkIGZhaWxfcG9zdHBvbmVkX3Jl
cXVlc3RzKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IsCiAJCQkJ
ICAgIHVuc2lnbmVkIGludCBzaXplKQogewpAQCAtMjUzOCw4ICsyNTU3LDYgQEAgc3RhdGljIGlu
dCByZWNlaXZlX0RhdGEoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0
IHBhY2tldF9pbmZvICoKIAlzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxOwogCXN0
cnVjdCBwX2RhdGEgKnAgPSBwaS0+ZGF0YTsKIAl1MzIgcGVlcl9zZXEgPSBiZTMyX3RvX2NwdShw
LT5zZXFfbnVtKTsKLQllbnVtIHJlcV9vcCBvcDsKLQlibGtfb3BmX3Qgb3BfZmxhZ3M7CiAJdTMy
IGRwX2ZsYWdzOwogCWludCBlcnIsIHRwOwogCkBAIC0yNTc4LDExICsyNTk1LDEwIEBAIHN0YXRp
YyBpbnQgcmVjZWl2ZV9EYXRhKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0
cnVjdCBwYWNrZXRfaW5mbyAqCiAJcGVlcl9yZXEtPmZsYWdzIHw9IEVFX0FQUExJQ0FUSU9OOwog
CiAJZHBfZmxhZ3MgPSBiZTMyX3RvX2NwdShwLT5kcF9mbGFncyk7Ci0Jb3AgPSB3aXJlX2ZsYWdz
X3RvX2Jpb19vcChkcF9mbGFncyk7Ci0Jb3BfZmxhZ3MgPSB3aXJlX2ZsYWdzX3RvX2Jpb19mbGFn
cyhkcF9mbGFncyk7CisJcGVlcl9yZXEtPm9wZiA9IHdpcmVfZmxhZ3NfdG9fYmlvKGNvbm5lY3Rp
b24sIGRwX2ZsYWdzKTsKIAlpZiAocGktPmNtZCA9PSBQX1RSSU0pIHsKIAkJRF9BU1NFUlQocGVl
cl9kZXZpY2UsIHBlZXJfcmVxLT5pLnNpemUgPiAwKTsKLQkJRF9BU1NFUlQocGVlcl9kZXZpY2Us
IG9wID09IFJFUV9PUF9ESVNDQVJEKTsKKwkJRF9BU1NFUlQocGVlcl9kZXZpY2UsIHBlZXJfcmVx
X29wKHBlZXJfcmVxKSA9PSBSRVFfT1BfRElTQ0FSRCk7CiAJCURfQVNTRVJUKHBlZXJfZGV2aWNl
LCBwZWVyX3JlcS0+cGFnZXMgPT0gTlVMTCk7CiAJCS8qIG5lZWQgdG8gcGxheSBzYWZlOiBhbiBv
bGRlciBEUkJEIHNlbmRlcgogCQkgKiBtYXkgbWVhbiB6ZXJvLW91dCB3aGlsZSBzZW5kaW5nIFBf
VFJJTS4gKi8KQEAgLTI1OTAsNyArMjYwNiw3IEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9EYXRhKHN0
cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXRfaW5mbyAqCiAJ
CQlwZWVyX3JlcS0+ZmxhZ3MgfD0gRUVfWkVST09VVDsKIAl9IGVsc2UgaWYgKHBpLT5jbWQgPT0g
UF9aRVJPRVMpIHsKIAkJRF9BU1NFUlQocGVlcl9kZXZpY2UsIHBlZXJfcmVxLT5pLnNpemUgPiAw
KTsKLQkJRF9BU1NFUlQocGVlcl9kZXZpY2UsIG9wID09IFJFUV9PUF9XUklURV9aRVJPRVMpOwor
CQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9yZXFfb3AocGVlcl9yZXEpID09IFJFUV9PUF9X
UklURV9aRVJPRVMpOwogCQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9yZXEtPnBhZ2VzID09
IE5VTEwpOwogCQkvKiBEbyAobm90KSBwYXNzIGRvd24gQkxLREVWX1pFUk9fTk9VTk1BUD8gKi8K
IAkJaWYgKGRwX2ZsYWdzICYgRFBfRElTQ0FSRCkKQEAgLTI2NzcsOCArMjY5Myw3IEBAIHN0YXRp
YyBpbnQgcmVjZWl2ZV9EYXRhKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0
cnVjdCBwYWNrZXRfaW5mbyAqCiAJCXBlZXJfcmVxLT5mbGFncyB8PSBFRV9DQUxMX0FMX0NPTVBM
RVRFX0lPOwogCX0KIAotCWVyciA9IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChkZXZpY2UsIHBl
ZXJfcmVxLCBvcCB8IG9wX2ZsYWdzLAotCQkJCSAgICAgICBEUkJEX0ZBVUxUX0RUX1dSKTsKKwll
cnIgPSBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QocGVlcl9yZXEpOwogCWlmICghZXJyKQogCQly
ZXR1cm4gMDsKIApAQCAtMjc4OSw3ICsyODA0LDYgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGFS
ZXF1ZXN0KHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXQK
IAlzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxOwogCXN0cnVjdCBkaWdlc3RfaW5m
byAqZGkgPSBOVUxMOwogCWludCBzaXplLCB2ZXJiOwotCXVuc2lnbmVkIGludCBmYXVsdF90eXBl
OwogCXN0cnVjdCBwX2Jsb2NrX3JlcSAqcCA9CXBpLT5kYXRhOwogCiAJcGVlcl9kZXZpY2UgPSBj
b25uX3BlZXJfZGV2aWNlKGNvbm5lY3Rpb24sIHBpLT52bnIpOwpAQCAtMjg0OSwxMSArMjg2Mywx
MSBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YVJlcXVlc3Qoc3RydWN0IGRyYmRfY29ubmVjdGlv
biAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAogCQlwdXRfbGRldihkZXZpY2UpOwogCQlyZXR1
cm4gLUVOT01FTTsKIAl9CisJcGVlcl9yZXEtPm9wZiA9IFJFUV9PUF9SRUFEOwogCiAJc3dpdGNo
IChwaS0+Y21kKSB7CiAJY2FzZSBQX0RBVEFfUkVRVUVTVDoKIAkJcGVlcl9yZXEtPncuY2IgPSB3
X2VfZW5kX2RhdGFfcmVxOwotCQlmYXVsdF90eXBlID0gRFJCRF9GQVVMVF9EVF9SRDsKIAkJLyog
YXBwbGljYXRpb24gSU8sIGRvbid0IGRyYmRfcnNfYmVnaW5faW8gKi8KIAkJcGVlcl9yZXEtPmZs
YWdzIHw9IEVFX0FQUExJQ0FUSU9OOwogCQlnb3RvIHN1Ym1pdDsKQEAgLTI4NjcsMTQgKzI4ODEs
MTIgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGFSZXF1ZXN0KHN0cnVjdCBkcmJkX2Nvbm5lY3Rp
b24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXQKIAkJZmFsbHRocm91Z2g7CiAJY2FzZSBQX1JT
X0RBVEFfUkVRVUVTVDoKIAkJcGVlcl9yZXEtPncuY2IgPSB3X2VfZW5kX3JzZGF0YV9yZXE7Ci0J
CWZhdWx0X3R5cGUgPSBEUkJEX0ZBVUxUX1JTX1JEOwogCQkvKiB1c2VkIGluIHRoZSBzZWN0b3Ig
b2Zmc2V0IHByb2dyZXNzIGRpc3BsYXkgKi8KIAkJZGV2aWNlLT5ibV9yZXN5bmNfZm8gPSBCTV9T
RUNUX1RPX0JJVChzZWN0b3IpOwogCQlicmVhazsKIAogCWNhc2UgUF9PVl9SRVBMWToKIAljYXNl
IFBfQ1NVTV9SU19SRVFVRVNUOgotCQlmYXVsdF90eXBlID0gRFJCRF9GQVVMVF9SU19SRDsKIAkJ
ZGkgPSBrbWFsbG9jKHNpemVvZigqZGkpICsgcGktPnNpemUsIEdGUF9OT0lPKTsKIAkJaWYgKCFk
aSkKIAkJCWdvdG8gb3V0X2ZyZWVfZTsKQEAgLTI5MjMsNyArMjkzNSw2IEBAIHN0YXRpYyBpbnQg
cmVjZWl2ZV9EYXRhUmVxdWVzdChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBz
dHJ1Y3QgcGFja2V0CiAJCQkJCSh1bnNpZ25lZCBsb25nIGxvbmcpc2VjdG9yKTsKIAkJfQogCQlw
ZWVyX3JlcS0+dy5jYiA9IHdfZV9lbmRfb3ZfcmVxOwotCQlmYXVsdF90eXBlID0gRFJCRF9GQVVM
VF9SU19SRDsKIAkJYnJlYWs7CiAKIAlkZWZhdWx0OgpAQCAtMjk3NSw4ICsyOTg2LDcgQEAgc3Rh
dGljIGludCByZWNlaXZlX0RhdGFSZXF1ZXN0KHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5l
Y3Rpb24sIHN0cnVjdCBwYWNrZXQKIHN1Ym1pdDoKIAl1cGRhdGVfcmVjZWl2ZXJfdGltaW5nX2Rl
dGFpbHMoY29ubmVjdGlvbiwgZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KTsKIAlpbmNfdW5hY2tl
ZChkZXZpY2UpOwotCWlmIChkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QoZGV2aWNlLCBwZWVyX3Jl
cSwgUkVRX09QX1JFQUQsCi0JCQkJICAgICBmYXVsdF90eXBlKSA9PSAwKQorCWlmIChkcmJkX3N1
Ym1pdF9wZWVyX3JlcXVlc3QocGVlcl9yZXEpID09IDApCiAJCXJldHVybiAwOwogCiAJLyogZG9u
J3QgY2FyZSBmb3IgdGhlIHJlYXNvbiBoZXJlICovCkBAIC00OTQ3LDcgKzQ5NTcsNiBAQCBzdGF0
aWMgaW50IHJlY2VpdmVfcnNfZGVhbGxvY2F0ZWQoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29u
bmVjdGlvbiwgc3RydWN0IHBhYwogCiAJaWYgKGdldF9sZGV2KGRldmljZSkpIHsKIAkJc3RydWN0
IGRyYmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcTsKLQkJY29uc3QgZW51bSByZXFfb3Agb3AgPSBS
RVFfT1BfV1JJVEVfWkVST0VTOwogCiAJCXBlZXJfcmVxID0gZHJiZF9hbGxvY19wZWVyX3JlcShw
ZWVyX2RldmljZSwgSURfU1lOQ0VSLCBzZWN0b3IsCiAJCQkJCSAgICAgICBzaXplLCAwLCBHRlBf
Tk9JTyk7CkBAIC00OTU3LDYgKzQ5NjYsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfcnNfZGVhbGxv
Y2F0ZWQoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhYwogCQl9
CiAKIAkJcGVlcl9yZXEtPncuY2IgPSBlX2VuZF9yZXN5bmNfYmxvY2s7CisJCXBlZXJfcmVxLT5v
cGYgPSBSRVFfT1BfRElTQ0FSRDsKIAkJcGVlcl9yZXEtPnN1Ym1pdF9qaWYgPSBqaWZmaWVzOwog
CQlwZWVyX3JlcS0+ZmxhZ3MgfD0gRUVfVFJJTTsKIApAQCAtNDk2NSw4ICs0OTc1LDcgQEAgc3Rh
dGljIGludCByZWNlaXZlX3JzX2RlYWxsb2NhdGVkKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNv
bm5lY3Rpb24sIHN0cnVjdCBwYWMKIAkJc3Bpbl91bmxvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNl
LT5yZXFfbG9jayk7CiAKIAkJYXRvbWljX2FkZChwaS0+c2l6ZSA+PiA5LCAmZGV2aWNlLT5yc19z
ZWN0X2V2KTsKLQkJZXJyID0gZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KGRldmljZSwgcGVlcl9y
ZXEsIG9wLAotCQkJCQkgICAgICAgRFJCRF9GQVVMVF9SU19XUik7CisJCWVyciA9IGRyYmRfc3Vi
bWl0X3BlZXJfcmVxdWVzdChwZWVyX3JlcSk7CiAKIAkJaWYgKGVycikgewogCQkJc3Bpbl9sb2Nr
X2lycSgmZGV2aWNlLT5yZXNvdXJjZS0+cmVxX2xvY2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9i
bG9jay9kcmJkL2RyYmRfd29ya2VyLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIu
YwppbmRleCAwYmIxYTkwMGMyZDUuLmM2OWJlZWZjOWQ1YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9i
bG9jay9kcmJkL2RyYmRfd29ya2VyLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfd29y
a2VyLmMKQEAgLTQwMCwxMyArNDAwLDEzIEBAIHN0YXRpYyBpbnQgcmVhZF9mb3JfY3N1bShzdHJ1
Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UsIHNlY3Rvcl90IHNlY3RvciwKIAkJZ290
byBkZWZlcjsKIAogCXBlZXJfcmVxLT53LmNiID0gd19lX3NlbmRfY3N1bTsKKwlwZWVyX3JlcS0+
b3BmID0gUkVRX09QX1JFQUQ7CiAJc3Bpbl9sb2NrX2lycSgmZGV2aWNlLT5yZXNvdXJjZS0+cmVx
X2xvY2spOwogCWxpc3RfYWRkX3RhaWwoJnBlZXJfcmVxLT53Lmxpc3QsICZkZXZpY2UtPnJlYWRf
ZWUpOwogCXNwaW5fdW5sb2NrX2lycSgmZGV2aWNlLT5yZXNvdXJjZS0+cmVxX2xvY2spOwogCiAJ
YXRvbWljX2FkZChzaXplID4+IDksICZkZXZpY2UtPnJzX3NlY3RfZXYpOwotCWlmIChkcmJkX3N1
Ym1pdF9wZWVyX3JlcXVlc3QoZGV2aWNlLCBwZWVyX3JlcSwgUkVRX09QX1JFQUQsCi0JCQkJICAg
ICBEUkJEX0ZBVUxUX1JTX1JEKSA9PSAwKQorCWlmIChkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qo
cGVlcl9yZXEpID09IDApCiAJCXJldHVybiAwOwogCiAJLyogSWYgaXQgZmFpbGVkIGJlY2F1c2Ug
b2YgRU5PTUVNLCByZXRyeSBzaG91bGQgaGVscC4gIElmIGl0IGZhaWxlZAotLSAKMi4zNy4zCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmJkLWRldiBt
YWlsaW5nIGxpc3QKZHJiZC1kZXZAbGlzdHMubGluYml0LmNvbQpodHRwczovL2xpc3RzLmxpbmJp
dC5jb20vbWFpbG1hbi9saXN0aW5mby9kcmJkLWRldgo=
