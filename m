Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 1D499605A62
	for <lists+drbd-dev@lfdr.de>; Thu, 20 Oct 2022 11:00:09 +0200 (CEST)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id A5E84420968;
	Thu, 20 Oct 2022 11:00:08 +0200 (CEST)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-wr1-f42.google.com (mail-wr1-f42.google.com
	[209.85.221.42])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 319284206CF
	for <drbd-dev@lists.linbit.com>; Thu, 20 Oct 2022 11:00:07 +0200 (CEST)
Received: by mail-wr1-f42.google.com with SMTP id a3so33214839wrt.0
	for <drbd-dev@lists.linbit.com>; Thu, 20 Oct 2022 02:00:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:from:to:cc:subject:date:message-id:reply-to;
	bh=uvsxN2WySJivbNHoEE51fvnJ5Q5oZj2weYzcINAu1z0=;
	b=DhuqPt3cRwChFJ5Ve+rjMcLsahYDqJYw6W7Nbhsr7UtMPLT3oub/LXt39auQyMJMhg
	FkIkJ50Io0bYV+H0wE7W9/mrX7MVv0f4KLZNasuFRBAvQeZg9CFU0U1to5Pm4+6LdoT5
	GKc8430Q0ZVqVD22r3sCXRTFnCy+BNtE9Ej+3OpeA0CCNc9w+1TFlyOLDyeY7xkMBgpv
	O7eqQU+uBzQaCT4qLwjYKrCRT9UU5BIXGhsnBiJ7ouBeDc1flYIuoEUaeBgt01FMjTEw
	pNCYyZ1PhWMmJijnHTxfZhiVoiREUD3pSeMV8M86o5EtK9uj/QTtjv6L27xwmmOM1aOt
	lKIw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:message-id:date:subject:cc
	:to:from:x-gm-message-state:from:to:cc:subject:date:message-id
	:reply-to;
	bh=uvsxN2WySJivbNHoEE51fvnJ5Q5oZj2weYzcINAu1z0=;
	b=AFpdZuEj/pLUcJx5WReW4sALNbJ3t/6Tw+A0jAm2VXf6mVWwGb27SEGJrhtBNsw1MI
	KBzwlARC4oxfzWh454I6aPfaj66koWoQttmdjEy4n0r/V/HRTXI65cCnYvvPDXE9rGnM
	YOv6prQOvOj9rVEFpB+0lFF8KSlfm17dN4phX6cNvh9igbYVZt9DNemLTNubkzLHkMOQ
	YbOexYdngFGbgCezz7dPwfXkqiAl4lOAN+8r93gJZKI1/e+LDdP7IVZVx04kuWmHArw3
	YOWG26cN0lT9QH3rqLjlOPoJCEN77bo9004BIqiw9qblhyciSKa8VAWlQ1H9QuL1wCjf
	dIdA==
X-Gm-Message-State: ACrzQf26Z01uGiLvh1f4MfRJs3r+2MGoMA6maV3qRgwq1RPwpI/d5E7j
	lhYq49pb0TtILyUvzAtgZBeg/2kTDYV/8HHbgFc=
X-Google-Smtp-Source: AMsMyM50fSGMQZK7fcAe8rIkhXhs5hX+mE8Wk3BblMYNlRV98MQ9LIZkXlbBLAa57YfJowSuxJDsvw==
X-Received: by 2002:a5d:5a18:0:b0:22f:4f72:213a with SMTP id
	bq24-20020a5d5a18000000b0022f4f72213amr7936934wrb.57.1666256407423;
	Thu, 20 Oct 2022 02:00:07 -0700 (PDT)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	h36-20020a05600c49a400b003a4efb794d7sm2037441wmp.36.2022.10.20.02.00.06
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Thu, 20 Oct 2022 02:00:06 -0700 (PDT)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Thu, 20 Oct 2022 10:59:46 +0200
Message-Id: <20221020085946.132253-1-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.37.3
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH v2] drbd: Store op in drbd_peer_request
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

KFNvcnQgb2YpIGNoZXJyeS1waWNrZWQgZnJvbSB0aGUgb3V0LW9mLXRyZWUgZHJiZDkgYnJhbmNo
LiBPcmlnaW5hbApjb21taXQgbWVzc2FnZSBieSBKb2VsIENvbGxlZGdlOgoKICAgIFRoaXMgc2lt
cGxpZmllcyBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QgYnkgcmVtb3ZpbmcgbW9zdCBvZiB0aGUK
ICAgIGFyZ3VtZW50cy4gSXQgYWxzbyBtYWtlcyB0aGUgdHJlYXRtZW50IG9mIHRoZSBvcCBiZXR0
ZXIgYWxpZ25lZCB3aXRoCiAgICB0aGF0IGluIHN0cnVjdCBiaW8uCgogICAgRGV0ZXJtaW5lIGZh
dWx0X3R5cGUgZHluYW1pY2FsbHkgdXNpbmcgaW5mb3JtYXRpb24gd2hpY2ggaXMgYWxyZWFkeQog
ICAgYXZhaWxhYmxlIGluc3RlYWQgb2YgcGFzc2luZyBpdCBpbiBhcyBhIHBhcmFtZXRlci4KCk5v
dGU6IFRoZSBvcGYgaW4gcmVjZWl2ZV9yc19kZWFsbG9jYXRlZCB3YXMgY2hhbmdlZCBmcm9tClJF
UV9PUF9XUklURV9aRVJPRVMgdG8gUkVRX09QX0RJU0NBUkQuIFRoaXMgd2FzIHJlcXVpcmVkIGlu
IHRoZQpvdXQtb2YtdHJlZSBtb2R1bGUsIGFuZCBkb2VzIG5vdCBtYXR0ZXIgaW4tdHJlZS4gVGhl
IG9wZiBpcyBpZ25vcmVkCmFueXdheSBpbiBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3QsIHNpbmNl
IHRoZSBkaXNjYXJkL3plcm8tb3V0IGlzCmRlY2lkZWQgYnkgdGhlIEVFX1RSSU0gZmxhZy4KClNp
Z25lZC1vZmYtYnk6IEpvZWwgQ29sbGVkZ2UgPGpvZWwuY29sbGVkZ2VAbGluYml0LmNvbT4KU2ln
bmVkLW9mZi1ieTogQ2hyaXN0b3BoIELDtmhtd2FsZGVyIDxjaHJpc3RvcGguYm9laG13YWxkZXJA
bGluYml0LmNvbT4KLS0tCkNoYW5nZXMgaW4gdjI6CiAgICAtIE1ha2Ugb3BmIHRoZSBjb3JyZWN0
IHR5cGUKICAgIC0gRml4IGNvbXBpbGVyIHdhcm5pbmdzCi0tLQogZHJpdmVycy9ibG9jay9kcmJk
L2RyYmRfaW50LmggICAgICB8ICA4ICsrLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2
ZXIuYyB8IDgxICsrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ibG9jay9k
cmJkL2RyYmRfd29ya2VyLmMgICB8ICA0ICstCiAzIGZpbGVzIGNoYW5nZWQsIDUzIGluc2VydGlv
bnMoKyksIDQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9k
cmJkX2ludC5oIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmgKaW5kZXggNGQ2NjEyODJm
ZjQxLi42YWI5NmZiMjk4M2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2lu
dC5oCisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oCkBAIC0zOTUsNiArMzk1LDcg
QEAgc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0IHsKIAlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAq
cGVlcl9kZXZpY2U7CiAJc3RydWN0IGRyYmRfZXBvY2ggKmVwb2NoOyAvKiBmb3Igd3JpdGVzICov
CiAJc3RydWN0IHBhZ2UgKnBhZ2VzOworCWJsa19vcGZfdCBvcGY7CiAJYXRvbWljX3QgcGVuZGlu
Z19iaW9zOwogCXN0cnVjdCBkcmJkX2ludGVydmFsIGk7CiAJLyogc2VlIGNvbW1lbnRzIG9uIGVl
IGZsYWcgYml0cyBiZWxvdyAqLwpAQCAtNDA2LDYgKzQwNywxMCBAQCBzdHJ1Y3QgZHJiZF9wZWVy
X3JlcXVlc3QgewogCX07CiB9OwogCisvKiBFcXVpdmFsZW50IHRvIGJpb19vcCBhbmQgcmVxX29w
LiAqLworI2RlZmluZSBwZWVyX3JlcV9vcChwZWVyX3JlcSkgXAorICAgICAgICgocGVlcl9yZXEp
LT5vcGYgJiBSRVFfT1BfTUFTSykKKwogLyogZWUgZmxhZyBiaXRzLgogICogV2hpbGUgY29ycmVz
cG9uZGluZyBiaW9zIGFyZSBpbiBmbGlnaHQsIHRoZSBvbmx5IG1vZGlmaWNhdGlvbiB3aWxsIGJl
CiAgKiBzZXRfYml0IFdBU19FUlJPUiwgd2hpY2ggaGFzIHRvIGJlIGF0b21pYy4KQEAgLTE1NDUs
OCArMTU1MCw3IEBAIGV4dGVybiB2b2lkIGRyYmRfc2VuZF9hY2tzX3dmKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd3MpOwogZXh0ZXJuIGJvb2wgZHJiZF9yc19jX21pbl9yYXRlX3Rocm90dGxlKHN0cnVj
dCBkcmJkX2RldmljZSAqZGV2aWNlKTsKIGV4dGVybiBib29sIGRyYmRfcnNfc2hvdWxkX3Nsb3df
ZG93bihzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgc2VjdG9yX3Qgc2VjdG9yLAogCQlib29s
IHRocm90dGxlX2lmX2FwcF9pc193YWl0aW5nKTsKLWV4dGVybiBpbnQgZHJiZF9zdWJtaXRfcGVl
cl9yZXF1ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqLAotCQkJCSAgICBzdHJ1Y3QgZHJiZF9wZWVy
X3JlcXVlc3QgKiwgYmxrX29wZl90LCBpbnQpOworZXh0ZXJuIGludCBkcmJkX3N1Ym1pdF9wZWVy
X3JlcXVlc3Qoc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICopOwogZXh0ZXJuIGludCBkcmJkX2Zy
ZWVfcGVlcl9yZXFzKHN0cnVjdCBkcmJkX2RldmljZSAqLCBzdHJ1Y3QgbGlzdF9oZWFkICopOwog
ZXh0ZXJuIHN0cnVjdCBkcmJkX3BlZXJfcmVxdWVzdCAqZHJiZF9hbGxvY19wZWVyX3JlcShzdHJ1
Y3QgZHJiZF9wZWVyX2RldmljZSAqLCB1NjQsCiAJCQkJCQkgICAgIHNlY3Rvcl90LCB1bnNpZ25l
ZCBpbnQsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jIGIv
ZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIuYwppbmRleCBjODk3YzQ1NzIwMzYuLmFm
NTJhM2FlMzdjMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIu
YworKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jCkBAIC0xNjAzLDkgKzE2
MDMsMTkgQEAgc3RhdGljIHZvaWQgZHJiZF9pc3N1ZV9wZWVyX2Rpc2NhcmRfb3JfemVyb19vdXQo
c3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHN0cnUKIAlkcmJkX2VuZGlvX3dyaXRlX3NlY19m
aW5hbChwZWVyX3JlcSk7CiB9CiAKK3N0YXRpYyBpbnQgcGVlcl9yZXF1ZXN0X2ZhdWx0X3R5cGUo
c3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcSkKK3sKKwlpZiAocGVlcl9yZXFfb3Ao
cGVlcl9yZXEpID09IFJFUV9PUF9SRUFEKSB7CisJCXJldHVybiBwZWVyX3JlcS0+ZmxhZ3MgJiBF
RV9BUFBMSUNBVElPTiA/CisJCQlEUkJEX0ZBVUxUX0RUX1JEIDogRFJCRF9GQVVMVF9SU19SRDsK
Kwl9IGVsc2UgeworCQlyZXR1cm4gcGVlcl9yZXEtPmZsYWdzICYgRUVfQVBQTElDQVRJT04gPwor
CQkJRFJCRF9GQVVMVF9EVF9XUiA6IERSQkRfRkFVTFRfUlNfV1I7CisJfQorfQorCiAvKioKICAq
IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdCgpCi0gKiBAZGV2aWNlOglEUkJEIGRldmljZS4KICAq
IEBwZWVyX3JlcToJcGVlciByZXF1ZXN0CiAgKgogICogTWF5IHNwcmVhZCB0aGUgcGFnZXMgdG8g
bXVsdGlwbGUgYmlvcywKQEAgLTE2MTksMTAgKzE2MjksOSBAQCBzdGF0aWMgdm9pZCBkcmJkX2lz
c3VlX3BlZXJfZGlzY2FyZF9vcl96ZXJvX291dChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwg
c3RydQogICogIG9uIGNlcnRhaW4gWGVuIGRlcGxveW1lbnRzLgogICovCiAvKiBUT0RPIGFsbG9j
YXRlIGZyb20gb3VyIG93biBiaW9fc2V0LiAqLwotaW50IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVz
dChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwKLQkJCSAgICAgc3RydWN0IGRyYmRfcGVlcl9y
ZXF1ZXN0ICpwZWVyX3JlcSwKLQkJCSAgICAgY29uc3QgYmxrX29wZl90IG9wZiwgY29uc3QgaW50
IGZhdWx0X3R5cGUpCitpbnQgZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHN0cnVjdCBkcmJkX3Bl
ZXJfcmVxdWVzdCAqcGVlcl9yZXEpCiB7CisJc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBw
ZWVyX3JlcS0+cGVlcl9kZXZpY2UtPmRldmljZTsKIAlzdHJ1Y3QgYmlvICpiaW9zID0gTlVMTDsK
IAlzdHJ1Y3QgYmlvICpiaW87CiAJc3RydWN0IHBhZ2UgKnBhZ2UgPSBwZWVyX3JlcS0+cGFnZXM7
CkBAIC0xNjY3LDcgKzE2NzYsMTggQEAgaW50IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChzdHJ1
Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwKIAkgKiBnZW5lcmF0ZWQgYmlvLCBidXQgYSBiaW8gYWxs
b2NhdGVkIG9uIGJlaGFsZiBvZiB0aGUgcGVlci4KIAkgKi8KIG5leHRfYmlvOgotCWJpbyA9IGJp
b19hbGxvYyhkZXZpY2UtPmxkZXYtPmJhY2tpbmdfYmRldiwgbnJfcGFnZXMsIG9wZiwgR0ZQX05P
SU8pOworCS8qIF9ESVNDQVJELCBfV1JJVEVfWkVST0VTIGhhbmRsZWQgYWJvdmUuCisJICogUkVR
X09QX0ZMVVNIIChlbXB0eSBmbHVzaCkgbm90IGV4cGVjdGVkLAorCSAqIHNob3VsZCBoYXZlIGJl
ZW4gbWFwcGVkIHRvIGEgImRyYmQgcHJvdG9jb2wgYmFycmllciIuCisJICogUkVRX09QX1NFQ1VS
RV9FUkFTRTogSSBkb24ndCBzZWUgaG93IHdlIGNvdWxkIGV2ZXIgc3VwcG9ydCB0aGF0LgorCSAq
LworCWlmICghKHBlZXJfcmVxX29wKHBlZXJfcmVxKSA9PSBSRVFfT1BfV1JJVEUgfHwKKwkJCQlw
ZWVyX3JlcV9vcChwZWVyX3JlcSkgPT0gUkVRX09QX1JFQUQpKSB7CisJCWRyYmRfZXJyKGRldmlj
ZSwgIkludmFsaWQgYmlvIG9wIHJlY2VpdmVkOiAweCV4XG4iLCBwZWVyX3JlcS0+b3BmKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCisJYmlvID0gYmlvX2FsbG9jKGRldmljZS0+bGRldi0+YmFj
a2luZ19iZGV2LCBucl9wYWdlcywgcGVlcl9yZXEtPm9wZiwgR0ZQX05PSU8pOwogCS8qID4gcGVl
cl9yZXEtPmkuc2VjdG9yLCB1bmxlc3MgdGhpcyBpcyB0aGUgZmlyc3QgYmlvICovCiAJYmlvLT5i
aV9pdGVyLmJpX3NlY3RvciA9IHNlY3RvcjsKIAliaW8tPmJpX3ByaXZhdGUgPSBwZWVyX3JlcTsK
QEAgLTE2OTcsNyArMTcxNyw3IEBAIGludCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qoc3RydWN0
IGRyYmRfZGV2aWNlICpkZXZpY2UsCiAJCWJpb3MgPSBiaW9zLT5iaV9uZXh0OwogCQliaW8tPmJp
X25leHQgPSBOVUxMOwogCi0JCWRyYmRfc3VibWl0X2Jpb19ub2FjY3QoZGV2aWNlLCBmYXVsdF90
eXBlLCBiaW8pOworCQlkcmJkX3N1Ym1pdF9iaW9fbm9hY2N0KGRldmljZSwgcGVlcl9yZXF1ZXN0
X2ZhdWx0X3R5cGUocGVlcl9yZXEpLCBiaW8pOwogCX0gd2hpbGUgKGJpb3MpOwogCXJldHVybiAw
OwogfQpAQCAtMjA1MSw2ICsyMDcxLDcgQEAgc3RhdGljIGludCByZWN2X3Jlc3luY19yZWFkKHN0
cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwgc2VjdG9yX3Qgc2VjdG8KIAkgKiBy
ZXNwZWN0aXZlIF9kcmJkX2NsZWFyX2RvbmVfZWUgKi8KIAogCXBlZXJfcmVxLT53LmNiID0gZV9l
bmRfcmVzeW5jX2Jsb2NrOworCXBlZXJfcmVxLT5vcGYgPSBSRVFfT1BfV1JJVEU7CiAJcGVlcl9y
ZXEtPnN1Ym1pdF9qaWYgPSBqaWZmaWVzOwogCiAJc3Bpbl9sb2NrX2lycSgmZGV2aWNlLT5yZXNv
dXJjZS0+cmVxX2xvY2spOwpAQCAtMjA1OCw4ICsyMDc5LDcgQEAgc3RhdGljIGludCByZWN2X3Jl
c3luY19yZWFkKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwgc2VjdG9yX3Qg
c2VjdG8KIAlzcGluX3VubG9ja19pcnEoJmRldmljZS0+cmVzb3VyY2UtPnJlcV9sb2NrKTsKIAog
CWF0b21pY19hZGQocGktPnNpemUgPj4gOSwgJmRldmljZS0+cnNfc2VjdF9ldik7Ci0JaWYgKGRy
YmRfc3VibWl0X3BlZXJfcmVxdWVzdChkZXZpY2UsIHBlZXJfcmVxLCBSRVFfT1BfV1JJVEUsCi0J
CQkJICAgICBEUkJEX0ZBVUxUX1JTX1dSKSA9PSAwKQorCWlmIChkcmJkX3N1Ym1pdF9wZWVyX3Jl
cXVlc3QocGVlcl9yZXEpID09IDApCiAJCXJldHVybiAwOwogCiAJLyogZG9uJ3QgY2FyZSBmb3Ig
dGhlIHJlYXNvbiBoZXJlICovCkBAIC0yMzc1LDE2ICsyMzk1LDYgQEAgc3RhdGljIGludCB3YWl0
X2Zvcl9hbmRfdXBkYXRlX3BlZXJfc2VxKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2Rl
dmljZSwgY28KIAlyZXR1cm4gcmV0OwogfQogCi0vKiBzZWUgYWxzbyBiaW9fZmxhZ3NfdG9fd2ly
ZSgpCi0gKiBEUkJEX1JFUV8qLCBiZWNhdXNlIHdlIG5lZWQgdG8gc2VtYW50aWNhbGx5IG1hcCB0
aGUgZmxhZ3MgdG8gZGF0YSBwYWNrZXQKLSAqIGZsYWdzIGFuZCBiYWNrLiBXZSBtYXkgcmVwbGlj
YXRlIHRvIG90aGVyIGtlcm5lbCB2ZXJzaW9ucy4gKi8KLXN0YXRpYyBibGtfb3BmX3Qgd2lyZV9m
bGFnc190b19iaW9fZmxhZ3ModTMyIGRwZikKLXsKLQlyZXR1cm4gIChkcGYgJiBEUF9SV19TWU5D
ID8gUkVRX1NZTkMgOiAwKSB8Ci0JCShkcGYgJiBEUF9GVUEgPyBSRVFfRlVBIDogMCkgfAotCQko
ZHBmICYgRFBfRkxVU0ggPyBSRVFfUFJFRkxVU0ggOiAwKTsKLX0KLQogc3RhdGljIGVudW0gcmVx
X29wIHdpcmVfZmxhZ3NfdG9fYmlvX29wKHUzMiBkcGYpCiB7CiAJaWYgKGRwZiAmIERQX1pFUk9F
UykKQEAgLTIzOTUsNiArMjQwNSwxNSBAQCBzdGF0aWMgZW51bSByZXFfb3Agd2lyZV9mbGFnc190
b19iaW9fb3AodTMyIGRwZikKIAkJcmV0dXJuIFJFUV9PUF9XUklURTsKIH0KIAorLyogc2VlIGFs
c28gYmlvX2ZsYWdzX3RvX3dpcmUoKSAqLworc3RhdGljIHVuc2lnbmVkIGxvbmcgd2lyZV9mbGFn
c190b19iaW8oc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgdTMyIGRwZikKK3sK
KwlyZXR1cm4gd2lyZV9mbGFnc190b19iaW9fb3AoZHBmKSB8CisJCShkcGYgJiBEUF9SV19TWU5D
ID8gUkVRX1NZTkMgOiAwKSB8CisJCShkcGYgJiBEUF9GVUEgPyBSRVFfRlVBIDogMCkgfAorCQko
ZHBmICYgRFBfRkxVU0ggPyBSRVFfUFJFRkxVU0ggOiAwKTsKK30KKwogc3RhdGljIHZvaWQgZmFp
bF9wb3N0cG9uZWRfcmVxdWVzdHMoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHNlY3Rvcl90
IHNlY3RvciwKIAkJCQkgICAgdW5zaWduZWQgaW50IHNpemUpCiB7CkBAIC0yNTM4LDggKzI1NTcs
NiBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YShzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25u
ZWN0aW9uLCBzdHJ1Y3QgcGFja2V0X2luZm8gKgogCXN0cnVjdCBkcmJkX3BlZXJfcmVxdWVzdCAq
cGVlcl9yZXE7CiAJc3RydWN0IHBfZGF0YSAqcCA9IHBpLT5kYXRhOwogCXUzMiBwZWVyX3NlcSA9
IGJlMzJfdG9fY3B1KHAtPnNlcV9udW0pOwotCWVudW0gcmVxX29wIG9wOwotCWJsa19vcGZfdCBv
cF9mbGFnczsKIAl1MzIgZHBfZmxhZ3M7CiAJaW50IGVyciwgdHA7CiAKQEAgLTI1NzgsMTEgKzI1
OTUsMTAgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGEoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAq
Y29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAlwZWVyX3JlcS0+ZmxhZ3MgfD0gRUVf
QVBQTElDQVRJT047CiAKIAlkcF9mbGFncyA9IGJlMzJfdG9fY3B1KHAtPmRwX2ZsYWdzKTsKLQlv
cCA9IHdpcmVfZmxhZ3NfdG9fYmlvX29wKGRwX2ZsYWdzKTsKLQlvcF9mbGFncyA9IHdpcmVfZmxh
Z3NfdG9fYmlvX2ZsYWdzKGRwX2ZsYWdzKTsKKwlwZWVyX3JlcS0+b3BmID0gd2lyZV9mbGFnc190
b19iaW8oY29ubmVjdGlvbiwgZHBfZmxhZ3MpOwogCWlmIChwaS0+Y21kID09IFBfVFJJTSkgewog
CQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9yZXEtPmkuc2l6ZSA+IDApOwotCQlEX0FTU0VS
VChwZWVyX2RldmljZSwgb3AgPT0gUkVRX09QX0RJU0NBUkQpOworCQlEX0FTU0VSVChwZWVyX2Rl
dmljZSwgcGVlcl9yZXFfb3AocGVlcl9yZXEpID09IFJFUV9PUF9ESVNDQVJEKTsKIAkJRF9BU1NF
UlQocGVlcl9kZXZpY2UsIHBlZXJfcmVxLT5wYWdlcyA9PSBOVUxMKTsKIAkJLyogbmVlZCB0byBw
bGF5IHNhZmU6IGFuIG9sZGVyIERSQkQgc2VuZGVyCiAJCSAqIG1heSBtZWFuIHplcm8tb3V0IHdo
aWxlIHNlbmRpbmcgUF9UUklNLiAqLwpAQCAtMjU5MCw3ICsyNjA2LDcgQEAgc3RhdGljIGludCBy
ZWNlaXZlX0RhdGEoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBh
Y2tldF9pbmZvICoKIAkJCXBlZXJfcmVxLT5mbGFncyB8PSBFRV9aRVJPT1VUOwogCX0gZWxzZSBp
ZiAocGktPmNtZCA9PSBQX1pFUk9FUykgewogCQlEX0FTU0VSVChwZWVyX2RldmljZSwgcGVlcl9y
ZXEtPmkuc2l6ZSA+IDApOwotCQlEX0FTU0VSVChwZWVyX2RldmljZSwgb3AgPT0gUkVRX09QX1dS
SVRFX1pFUk9FUyk7CisJCURfQVNTRVJUKHBlZXJfZGV2aWNlLCBwZWVyX3JlcV9vcChwZWVyX3Jl
cSkgPT0gUkVRX09QX1dSSVRFX1pFUk9FUyk7CiAJCURfQVNTRVJUKHBlZXJfZGV2aWNlLCBwZWVy
X3JlcS0+cGFnZXMgPT0gTlVMTCk7CiAJCS8qIERvIChub3QpIHBhc3MgZG93biBCTEtERVZfWkVS
T19OT1VOTUFQPyAqLwogCQlpZiAoZHBfZmxhZ3MgJiBEUF9ESVNDQVJEKQpAQCAtMjY3Nyw4ICsy
NjkzLDcgQEAgc3RhdGljIGludCByZWNlaXZlX0RhdGEoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAq
Y29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAkJcGVlcl9yZXEtPmZsYWdzIHw9IEVF
X0NBTExfQUxfQ09NUExFVEVfSU87CiAJfQogCi0JZXJyID0gZHJiZF9zdWJtaXRfcGVlcl9yZXF1
ZXN0KGRldmljZSwgcGVlcl9yZXEsIG9wIHwgb3BfZmxhZ3MsCi0JCQkJICAgICAgIERSQkRfRkFV
TFRfRFRfV1IpOworCWVyciA9IGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChwZWVyX3JlcSk7CiAJ
aWYgKCFlcnIpCiAJCXJldHVybiAwOwogCkBAIC0yNzg5LDcgKzI4MDQsNiBAQCBzdGF0aWMgaW50
IHJlY2VpdmVfRGF0YVJlcXVlc3Qoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwg
c3RydWN0IHBhY2tldAogCXN0cnVjdCBkcmJkX3BlZXJfcmVxdWVzdCAqcGVlcl9yZXE7CiAJc3Ry
dWN0IGRpZ2VzdF9pbmZvICpkaSA9IE5VTEw7CiAJaW50IHNpemUsIHZlcmI7Ci0JdW5zaWduZWQg
aW50IGZhdWx0X3R5cGU7CiAJc3RydWN0IHBfYmxvY2tfcmVxICpwID0JcGktPmRhdGE7CiAKIAlw
ZWVyX2RldmljZSA9IGNvbm5fcGVlcl9kZXZpY2UoY29ubmVjdGlvbiwgcGktPnZucik7CkBAIC0y
ODQ5LDExICsyODYzLDExIEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9EYXRhUmVxdWVzdChzdHJ1Y3Qg
ZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFja2V0CiAJCXB1dF9sZGV2KGRl
dmljZSk7CiAJCXJldHVybiAtRU5PTUVNOwogCX0KKwlwZWVyX3JlcS0+b3BmID0gUkVRX09QX1JF
QUQ7CiAKIAlzd2l0Y2ggKHBpLT5jbWQpIHsKIAljYXNlIFBfREFUQV9SRVFVRVNUOgogCQlwZWVy
X3JlcS0+dy5jYiA9IHdfZV9lbmRfZGF0YV9yZXE7Ci0JCWZhdWx0X3R5cGUgPSBEUkJEX0ZBVUxU
X0RUX1JEOwogCQkvKiBhcHBsaWNhdGlvbiBJTywgZG9uJ3QgZHJiZF9yc19iZWdpbl9pbyAqLwog
CQlwZWVyX3JlcS0+ZmxhZ3MgfD0gRUVfQVBQTElDQVRJT047CiAJCWdvdG8gc3VibWl0OwpAQCAt
Mjg2NywxNCArMjg4MSwxMiBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YVJlcXVlc3Qoc3RydWN0
IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAogCQlmYWxsdGhyb3Vn
aDsKIAljYXNlIFBfUlNfREFUQV9SRVFVRVNUOgogCQlwZWVyX3JlcS0+dy5jYiA9IHdfZV9lbmRf
cnNkYXRhX3JlcTsKLQkJZmF1bHRfdHlwZSA9IERSQkRfRkFVTFRfUlNfUkQ7CiAJCS8qIHVzZWQg
aW4gdGhlIHNlY3RvciBvZmZzZXQgcHJvZ3Jlc3MgZGlzcGxheSAqLwogCQlkZXZpY2UtPmJtX3Jl
c3luY19mbyA9IEJNX1NFQ1RfVE9fQklUKHNlY3Rvcik7CiAJCWJyZWFrOwogCiAJY2FzZSBQX09W
X1JFUExZOgogCWNhc2UgUF9DU1VNX1JTX1JFUVVFU1Q6Ci0JCWZhdWx0X3R5cGUgPSBEUkJEX0ZB
VUxUX1JTX1JEOwogCQlkaSA9IGttYWxsb2Moc2l6ZW9mKCpkaSkgKyBwaS0+c2l6ZSwgR0ZQX05P
SU8pOwogCQlpZiAoIWRpKQogCQkJZ290byBvdXRfZnJlZV9lOwpAQCAtMjkyMyw3ICsyOTM1LDYg
QEAgc3RhdGljIGludCByZWNlaXZlX0RhdGFSZXF1ZXN0KHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24g
KmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXQKIAkJCQkJKHVuc2lnbmVkIGxvbmcgbG9uZylzZWN0
b3IpOwogCQl9CiAJCXBlZXJfcmVxLT53LmNiID0gd19lX2VuZF9vdl9yZXE7Ci0JCWZhdWx0X3R5
cGUgPSBEUkJEX0ZBVUxUX1JTX1JEOwogCQlicmVhazsKIAogCWRlZmF1bHQ6CkBAIC0yOTc1LDgg
KzI5ODYsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YVJlcXVlc3Qoc3RydWN0IGRyYmRfY29u
bmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAogc3VibWl0OgogCXVwZGF0ZV9yZWNl
aXZlcl90aW1pbmdfZGV0YWlscyhjb25uZWN0aW9uLCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qp
OwogCWluY191bmFja2VkKGRldmljZSk7Ci0JaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChk
ZXZpY2UsIHBlZXJfcmVxLCBSRVFfT1BfUkVBRCwKLQkJCQkgICAgIGZhdWx0X3R5cGUpID09IDAp
CisJaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChwZWVyX3JlcSkgPT0gMCkKIAkJcmV0dXJu
IDA7CiAKIAkvKiBkb24ndCBjYXJlIGZvciB0aGUgcmVhc29uIGhlcmUgKi8KQEAgLTQ5NDcsNyAr
NDk1Nyw2IEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9yc19kZWFsbG9jYXRlZChzdHJ1Y3QgZHJiZF9j
b25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFjCiAKIAlpZiAoZ2V0X2xkZXYoZGV2aWNl
KSkgewogCQlzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKnBlZXJfcmVxOwotCQljb25zdCBlbnVt
IHJlcV9vcCBvcCA9IFJFUV9PUF9XUklURV9aRVJPRVM7CiAKIAkJcGVlcl9yZXEgPSBkcmJkX2Fs
bG9jX3BlZXJfcmVxKHBlZXJfZGV2aWNlLCBJRF9TWU5DRVIsIHNlY3RvciwKIAkJCQkJICAgICAg
IHNpemUsIDAsIEdGUF9OT0lPKTsKQEAgLTQ5NTcsNiArNDk2Niw3IEBAIHN0YXRpYyBpbnQgcmVj
ZWl2ZV9yc19kZWFsbG9jYXRlZChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBz
dHJ1Y3QgcGFjCiAJCX0KIAogCQlwZWVyX3JlcS0+dy5jYiA9IGVfZW5kX3Jlc3luY19ibG9jazsK
KwkJcGVlcl9yZXEtPm9wZiA9IFJFUV9PUF9ESVNDQVJEOwogCQlwZWVyX3JlcS0+c3VibWl0X2pp
ZiA9IGppZmZpZXM7CiAJCXBlZXJfcmVxLT5mbGFncyB8PSBFRV9UUklNOwogCkBAIC00OTY1LDgg
KzQ5NzUsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfcnNfZGVhbGxvY2F0ZWQoc3RydWN0IGRyYmRf
Y29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhYwogCQlzcGluX3VubG9ja19pcnEoJmRl
dmljZS0+cmVzb3VyY2UtPnJlcV9sb2NrKTsKIAogCQlhdG9taWNfYWRkKHBpLT5zaXplID4+IDks
ICZkZXZpY2UtPnJzX3NlY3RfZXYpOwotCQllcnIgPSBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qo
ZGV2aWNlLCBwZWVyX3JlcSwgb3AsCi0JCQkJCSAgICAgICBEUkJEX0ZBVUxUX1JTX1dSKTsKKwkJ
ZXJyID0gZHJiZF9zdWJtaXRfcGVlcl9yZXF1ZXN0KHBlZXJfcmVxKTsKIAogCQlpZiAoZXJyKSB7
CiAJCQlzcGluX2xvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNlLT5yZXFfbG9jayk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYyBiL2RyaXZlcnMvYmxvY2svZHJi
ZC9kcmJkX3dvcmtlci5jCmluZGV4IDBiYjFhOTAwYzJkNS4uYzY5YmVlZmM5ZDVjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYworKysgYi9kcml2ZXJzL2Jsb2Nr
L2RyYmQvZHJiZF93b3JrZXIuYwpAQCAtNDAwLDEzICs0MDAsMTMgQEAgc3RhdGljIGludCByZWFk
X2Zvcl9jc3VtKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwgc2VjdG9yX3Qg
c2VjdG9yLAogCQlnb3RvIGRlZmVyOwogCiAJcGVlcl9yZXEtPncuY2IgPSB3X2Vfc2VuZF9jc3Vt
OworCXBlZXJfcmVxLT5vcGYgPSBSRVFfT1BfUkVBRDsKIAlzcGluX2xvY2tfaXJxKCZkZXZpY2Ut
PnJlc291cmNlLT5yZXFfbG9jayk7CiAJbGlzdF9hZGRfdGFpbCgmcGVlcl9yZXEtPncubGlzdCwg
JmRldmljZS0+cmVhZF9lZSk7CiAJc3Bpbl91bmxvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNlLT5y
ZXFfbG9jayk7CiAKIAlhdG9taWNfYWRkKHNpemUgPj4gOSwgJmRldmljZS0+cnNfc2VjdF9ldik7
Ci0JaWYgKGRyYmRfc3VibWl0X3BlZXJfcmVxdWVzdChkZXZpY2UsIHBlZXJfcmVxLCBSRVFfT1Bf
UkVBRCwKLQkJCQkgICAgIERSQkRfRkFVTFRfUlNfUkQpID09IDApCisJaWYgKGRyYmRfc3VibWl0
X3BlZXJfcmVxdWVzdChwZWVyX3JlcSkgPT0gMCkKIAkJcmV0dXJuIDA7CiAKIAkvKiBJZiBpdCBm
YWlsZWQgYmVjYXVzZSBvZiBFTk9NRU0sIHJldHJ5IHNob3VsZCBoZWxwLiAgSWYgaXQgZmFpbGVk
Ci0tIAoyLjM3LjMKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyYmQtZGV2IG1haWxpbmcgbGlzdApkcmJkLWRldkBsaXN0cy5saW5iaXQuY29tCmh0dHBz
Oi8vbGlzdHMubGluYml0LmNvbS9tYWlsbWFuL2xpc3RpbmZvL2RyYmQtZGV2Cg==
