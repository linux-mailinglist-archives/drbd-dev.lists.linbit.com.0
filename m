Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 923DC6980F5
	for <lists+drbd-dev@lfdr.de>; Wed, 15 Feb 2023 17:33:41 +0100 (CET)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 5ADCE422137;
	Wed, 15 Feb 2023 17:33:41 +0100 (CET)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-wr1-f46.google.com (mail-wr1-f46.google.com
	[209.85.221.46])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 85377421788
	for <drbd-dev@lists.linbit.com>; Wed, 15 Feb 2023 17:32:09 +0100 (CET)
Received: by mail-wr1-f46.google.com with SMTP id by3so18446272wrb.10
	for <drbd-dev@lists.linbit.com>; Wed, 15 Feb 2023 08:32:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:from:to:cc:subject:date
	:message-id:reply-to;
	bh=eJdWsIdQgJHO6HdUyEE19gIWuWTne8BQ3dqwrIDRKE0=;
	b=ci17wbX9A/gtzwgo0Q53lieyCiwFja1KZI6b6s8DhtoGmWLR3GBtRJg94XL94+bWVV
	XL6bCmWOsccmojD1Byu3b6/axp2abaIzCDltiCqzxEwB4Qtsiegb5pyqk00omW/b7OSr
	EnyHVGynyCzJAwzMZUiQ+B8e4qOcxjbIQmdqY4FcgBTVv/U82tcFXD+I1PmoiMPngHzg
	edleicWocHZsfuACzVQHIleCy8W4AwKwCq4kNQ6U94vVaurE/KU6yoOR03ZFM/1RrCSb
	yxLcmu4hFuaDXutIveIfd5vwJQSU8uk1RECYfgYFzepxp+6kRSCzHJdqcalK32SuPUmo
	cQoQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
	:subject:date:message-id:reply-to;
	bh=eJdWsIdQgJHO6HdUyEE19gIWuWTne8BQ3dqwrIDRKE0=;
	b=FWlKG7aW2VFqoqr2yaDwBqyVzwmBWDUXENk2RP5DVdvBuHX/1hoLNT4vjh9qbO/jUc
	VkZt4GGOUva31S1crbAHDwZxZoMSkDNUWacEenjCZbj7FZm5UgVq8FT+BZpbGgH54q3a
	OeAFKk58MwhoSdEL+a0fFzpyHcfSAzmqS/PVLh5i02quwkIPTRweLYayHxV3TwqEjWoM
	kAqVzopLo4IOxFyGS3EA4dFiYrUaxIZOELhFJr8zGKXOHzk55IrYjZyu4Sjg6B4CQV4d
	sjDYb6GAcGe6ODBI+3xPfvXJGJPH136gUsRNescRnWtqjdiBndyYxe/ZVzTaBNzwR7jN
	2tkw==
X-Gm-Message-State: AO0yUKXM2Ay0T9uyh/yyMxiBl+RphTahKUaH0/MCj7xB5hOxtJ6MKguO
	iIwM/CuWK7+6DR6QwVeEKzgQzK/g
X-Google-Smtp-Source: AK7set8mGmfDuKlWZkF6amwaYf6u4qhZ9xfRiU7g1bc+XOenOzfq38s545+lfbRANp1R11aa+iiPSw==
X-Received: by 2002:a5d:58e3:0:b0:2c5:4de4:bcd8 with SMTP id
	f3-20020a5d58e3000000b002c54de4bcd8mr2340687wrd.36.1676478729138;
	Wed, 15 Feb 2023 08:32:09 -0800 (PST)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	n4-20020a5d67c4000000b002c56287bd2csm4865055wrw.114.2023.02.15.08.32.08
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Wed, 15 Feb 2023 08:32:08 -0800 (PST)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Wed, 15 Feb 2023 17:31:59 +0100
Message-Id: <20230215163204.2856631-3-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.39.1
In-Reply-To: <20230215163204.2856631-1-christoph.boehmwalder@linbit.com>
References: <20230215163204.2856631-1-christoph.boehmwalder@linbit.com>
MIME-Version: 1.0
Cc: Andreas Gruenbacher <agruen@kernel.org>,
	Philipp Reisner <philipp.reisner@linbit.com>,
	linux-kernel@vger.kernel.org, linux-block@vger.kernel.org,
	Lars Ellenberg <lars.ellenberg@linbit.com>, drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH 2/7] drbd: Add peer device parameter to
	whole-bitmap I/O handlers
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

RnJvbTogQW5kcmVhcyBHcnVlbmJhY2hlciA8YWdydWVuQGtlcm5lbC5vcmc+CgpQYXNzIGEgcGVl
ciBkZXZpY2UgcGFyYW1ldGVyIHRocm91Z2ggdGhlIGJpdG1hcCBJL08gZnVuY3Rpb25zIHRvIHRo
ZSBJL08KaGFuZGxlcnMuICBJbiBhZnRlcl9zdGF0ZV9jaCgpLCBzZXQgdGhhdCBwYXJhbWV0ZXIg
d2hlbiBxdWV1aW5nIHRoZQpkcmJkX3NlbmRfYml0bWFwIG9wZXJhdGlvbiBzbyB0aGF0IHRoaXMg
b3BlcmF0aW9uIGtub3dzIHdoZXJlIHRvIHNlbmQgdGhlCmJpdG1hcC4KClNpZ25lZC1vZmYtYnk6
IEFuZHJlYXMgR3J1ZW5iYWNoZXIgPGFncnVlbkBrZXJuZWwub3JnPgpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RvcGggQsO2aG13YWxkZXIgPGNocmlzdG9waC5ib2VobXdhbGRlckBsaW5iaXQuY29tPgot
LS0KIGRyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2JpdG1hcC5jICAgfCAgNyArKy0tCiBkcml2ZXJz
L2Jsb2NrL2RyYmQvZHJiZF9pbnQuaCAgICAgIHwgMjMgKysrKysrKystLS0tLQogZHJpdmVycy9i
bG9jay9kcmJkL2RyYmRfbWFpbi5jICAgICB8IDU1ICsrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYyAgICAgICB8IDE0ICsrKystLS0tCiBk
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jIHwgIDYgKystLQogZHJpdmVycy9ibG9j
ay9kcmJkL2RyYmRfc3RhdGUuYyAgICB8ICA3ICsrLS0KIDYgZmlsZXMgY2hhbmdlZCwgNjcgaW5z
ZXJ0aW9ucygrKSwgNDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9k
cmJkL2RyYmRfYml0bWFwLmMgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9iaXRtYXAuYwppbmRl
eCAyODk4NzZmZmJjMzEuLjdkOGUzYjAyYTFkYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9k
cmJkL2RyYmRfYml0bWFwLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYml0bWFwLmMK
QEAgLTEyMTYsNyArMTIxNiw5IEBAIHN0YXRpYyBpbnQgYm1fcncoc3RydWN0IGRyYmRfZGV2aWNl
ICpkZXZpY2UsIGNvbnN0IHVuc2lnbmVkIGludCBmbGFncywgdW5zaWduZWQKICAqIGRyYmRfYm1f
cmVhZCgpIC0gUmVhZCB0aGUgd2hvbGUgYml0bWFwIGZyb20gaXRzIG9uIGRpc2sgbG9jYXRpb24u
CiAgKiBAZGV2aWNlOglEUkJEIGRldmljZS4KICAqLwotaW50IGRyYmRfYm1fcmVhZChzdHJ1Y3Qg
ZHJiZF9kZXZpY2UgKmRldmljZSkgX19tdXN0X2hvbGQobG9jYWwpCitpbnQgZHJiZF9ibV9yZWFk
KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAorCQkgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2Ug
KnBlZXJfZGV2aWNlKSBfX211c3RfaG9sZChsb2NhbCkKKwogewogCXJldHVybiBibV9ydyhkZXZp
Y2UsIEJNX0FJT19SRUFELCAwKTsKIH0KQEAgLTEyMjcsNyArMTIyOSw4IEBAIGludCBkcmJkX2Jt
X3JlYWQoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpIF9fbXVzdF9ob2xkKGxvY2FsKQogICoK
ICAqIFdpbGwgb25seSB3cml0ZSBwYWdlcyB0aGF0IGhhdmUgY2hhbmdlZCBzaW5jZSBsYXN0IElP
LgogICovCi1pbnQgZHJiZF9ibV93cml0ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkgX19t
dXN0X2hvbGQobG9jYWwpCitpbnQgZHJiZF9ibV93cml0ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRl
dmljZSwKKwkJIHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSkgX19tdXN0X2hv
bGQobG9jYWwpCiB7CiAJcmV0dXJuIGJtX3J3KGRldmljZSwgMCwgMCk7CiB9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9pbnQuaCBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJk
X2ludC5oCmluZGV4IDc3MjAyM2FjZTc0OS4uNjM5MTk3ODFmZTMwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2Jsb2NrL2RyYmQvZHJiZF9pbnQuaAorKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9p
bnQuaApAQCAtNTQxLDkgKzU0MSwxMCBAQCBzdHJ1Y3QgZHJiZF9tZF9pbyB7CiAKIHN0cnVjdCBi
bV9pb193b3JrIHsKIAlzdHJ1Y3QgZHJiZF93b3JrIHc7CisJc3RydWN0IGRyYmRfcGVlcl9kZXZp
Y2UgKnBlZXJfZGV2aWNlOwogCWNoYXIgKndoeTsKIAllbnVtIGJtX2ZsYWcgZmxhZ3M7Ci0JaW50
ICgqaW9fZm4pKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKTsKKwlpbnQgKCppb19mbikoc3Ry
dWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2Rl
dmljZSk7CiAJdm9pZCAoKmRvbmUpKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQgcnYp
OwogfTsKIApAQCAtMTA0MSw3ICsxMDQyLDcgQEAgZXh0ZXJuIGludCBkcmJkX3NlbmRfZHJlcXVl
c3RfY3N1bShzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqLCBzZWN0b3JfdCBzZWN0b3IsCiAJCQkJ
ICAgZW51bSBkcmJkX3BhY2tldCBjbWQpOwogZXh0ZXJuIGludCBkcmJkX3NlbmRfb3ZfcmVxdWVz
dChzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqLCBzZWN0b3JfdCBzZWN0b3IsIGludCBzaXplKTsK
IAotZXh0ZXJuIGludCBkcmJkX3NlbmRfYml0bWFwKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
KTsKK2V4dGVybiBpbnQgZHJiZF9zZW5kX2JpdG1hcChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlKTsKIGV4dGVybiB2b2lkIGRy
YmRfc2VuZF9zcl9yZXBseShzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqLCBlbnVtIGRyYmRfc3Rh
dGVfcnYgcmV0Y29kZSk7CiBleHRlcm4gdm9pZCBjb25uX3NlbmRfc3JfcmVwbHkoc3RydWN0IGRy
YmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgZW51bSBkcmJkX3N0YXRlX3J2IHJldGNvZGUpOwog
ZXh0ZXJuIGludCBkcmJkX3NlbmRfcnNfZGVhbGxvY2F0ZWQoc3RydWN0IGRyYmRfcGVlcl9kZXZp
Y2UgKiwgc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICopOwpAQCAtMTA2NSwxNyArMTA2NiwxOSBA
QCBleHRlcm4gdm9pZCBkcmJkX21kX2NsZWFyX2ZsYWcoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZp
Y2UsIGludCBmbGFncylfX211c3RfaG9sZAogZXh0ZXJuIGludCBkcmJkX21kX3Rlc3RfZmxhZyhz
dHJ1Y3QgZHJiZF9iYWNraW5nX2RldiAqLCBpbnQpOwogZXh0ZXJuIHZvaWQgZHJiZF9tZF9tYXJr
X2RpcnR5KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKTsKIGV4dGVybiB2b2lkIGRyYmRfcXVl
dWVfYml0bWFwX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAotCQkJCSBpbnQgKCppb19m
bikoc3RydWN0IGRyYmRfZGV2aWNlICopLAorCQkJCSBpbnQgKCppb19mbikoc3RydWN0IGRyYmRf
ZGV2aWNlICosIHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICopLAogCQkJCSB2b2lkICgqZG9uZSko
c3RydWN0IGRyYmRfZGV2aWNlICosIGludCksCiAJCQkJIGNoYXIgKndoeSwgZW51bSBibV9mbGFn
IGZsYWdzKTsKIGV4dGVybiBpbnQgZHJiZF9iaXRtYXBfaW8oc3RydWN0IGRyYmRfZGV2aWNlICpk
ZXZpY2UsCi0JCWludCAoKmlvX2ZuKShzdHJ1Y3QgZHJiZF9kZXZpY2UgKiksCisJCWludCAoKmlv
X2ZuKShzdHJ1Y3QgZHJiZF9kZXZpY2UgKiwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiksCiAJ
CWNoYXIgKndoeSwgZW51bSBibV9mbGFnIGZsYWdzKTsKIGV4dGVybiBpbnQgZHJiZF9iaXRtYXBf
aW9fZnJvbV93b3JrZXIoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCi0JCWludCAoKmlvX2Zu
KShzdHJ1Y3QgZHJiZF9kZXZpY2UgKiksCisJCWludCAoKmlvX2ZuKShzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKiwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiksCiAJCWNoYXIgKndoeSwgZW51bSBibV9m
bGFnIGZsYWdzKTsKLWV4dGVybiBpbnQgZHJiZF9ibWlvX3NldF9uX3dyaXRlKHN0cnVjdCBkcmJk
X2RldmljZSAqZGV2aWNlKSBfX211c3RfaG9sZChsb2NhbCk7Ci1leHRlcm4gaW50IGRyYmRfYm1p
b19jbGVhcl9uX3dyaXRlKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKSBfX211c3RfaG9sZChs
b2NhbCk7CitleHRlcm4gaW50IGRyYmRfYm1pb19zZXRfbl93cml0ZShzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKmRldmljZSwKKwkJc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlKSBfX211
c3RfaG9sZChsb2NhbCk7CitleHRlcm4gaW50IGRyYmRfYm1pb19jbGVhcl9uX3dyaXRlKHN0cnVj
dCBkcmJkX2RldmljZSAqZGV2aWNlLAorCQlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9k
ZXZpY2UpIF9fbXVzdF9ob2xkKGxvY2FsKTsKIAogLyogTWV0YSBkYXRhIGxheW91dAogICoKQEAg
LTEyODQsOSArMTI4NywxMSBAQCBleHRlcm4gdm9pZCBfZHJiZF9ibV9zZXRfYml0cyhzdHJ1Y3Qg
ZHJiZF9kZXZpY2UgKmRldmljZSwKIAkJY29uc3QgdW5zaWduZWQgbG9uZyBzLCBjb25zdCB1bnNp
Z25lZCBsb25nIGUpOwogZXh0ZXJuIGludCAgZHJiZF9ibV90ZXN0X2JpdChzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKmRldmljZSwgdW5zaWduZWQgbG9uZyBiaXRucik7CiBleHRlcm4gaW50ICBkcmJkX2Jt
X2Vfd2VpZ2h0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCB1bnNpZ25lZCBsb25nIGVucik7
Ci1leHRlcm4gaW50ICBkcmJkX2JtX3JlYWQoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpIF9f
bXVzdF9ob2xkKGxvY2FsKTsKK2V4dGVybiBpbnQgIGRyYmRfYm1fcmVhZChzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKmRldmljZSwKKwkJc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlKSBf
X211c3RfaG9sZChsb2NhbCk7CiBleHRlcm4gdm9pZCBkcmJkX2JtX21hcmtfZm9yX3dyaXRlb3V0
KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQgcGFnZV9ucik7Ci1leHRlcm4gaW50ICBk
cmJkX2JtX3dyaXRlKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKSBfX211c3RfaG9sZChsb2Nh
bCk7CitleHRlcm4gaW50ICBkcmJkX2JtX3dyaXRlKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
LAorCQlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpIF9fbXVzdF9ob2xkKGxv
Y2FsKTsKIGV4dGVybiB2b2lkIGRyYmRfYm1fcmVzZXRfYWxfaGludHMoc3RydWN0IGRyYmRfZGV2
aWNlICpkZXZpY2UpIF9fbXVzdF9ob2xkKGxvY2FsKTsKIGV4dGVybiBpbnQgIGRyYmRfYm1fd3Jp
dGVfaGludGVkKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKSBfX211c3RfaG9sZChsb2NhbCk7
CiBleHRlcm4gaW50ICBkcmJkX2JtX3dyaXRlX2xhenkoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZp
Y2UsIHVuc2lnbmVkIHVwcGVyX2lkeCkgX19tdXN0X2hvbGQobG9jYWwpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbWFpbi5jIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRf
bWFpbi5jCmluZGV4IDJjNzY0ZjdlZTRhNy4uNWQ5ODAxNzQ5N2U0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2Jsb2NrL2RyYmQvZHJiZF9tYWluLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRf
bWFpbi5jCkBAIC0xMTk4LDEwICsxMTk4LDExIEBAIHN0YXRpYyBpbnQgZmlsbF9iaXRtYXBfcmxl
X2JpdHMoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCiAgKiBjb2RlIHVwb24gZmFpbHVyZS4K
ICAqLwogc3RhdGljIGludAotc2VuZF9iaXRtYXBfcmxlX29yX3BsYWluKHN0cnVjdCBkcmJkX2Rl
dmljZSAqZGV2aWNlLCBzdHJ1Y3QgYm1feGZlcl9jdHggKmMpCitzZW5kX2JpdG1hcF9ybGVfb3Jf
cGxhaW4oc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKmRldmljZSwgc3RydWN0IGJtX3hmZXJfY3R4
ICpjKQogewotCXN0cnVjdCBkcmJkX3NvY2tldCAqc29jayA9ICZmaXJzdF9wZWVyX2RldmljZShk
ZXZpY2UpLT5jb25uZWN0aW9uLT5kYXRhOwotCXVuc2lnbmVkIGludCBoZWFkZXJfc2l6ZSA9IGRy
YmRfaGVhZGVyX3NpemUoZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+Y29ubmVjdGlvbik7CisJ
c3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBwZWVyX2RldmljZS0+ZGV2aWNlOworCXN0cnVj
dCBkcmJkX3NvY2tldCAqc29jayA9ICZwZWVyX2RldmljZS0+Y29ubmVjdGlvbi0+ZGF0YTsKKwl1
bnNpZ25lZCBpbnQgaGVhZGVyX3NpemUgPSBkcmJkX2hlYWRlcl9zaXplKHBlZXJfZGV2aWNlLT5j
b25uZWN0aW9uKTsKIAlzdHJ1Y3QgcF9jb21wcmVzc2VkX2JtICpwID0gc29jay0+c2J1ZiArIGhl
YWRlcl9zaXplOwogCWludCBsZW4sIGVycjsKIApAQCAtMTIxMiw3ICsxMjEzLDcgQEAgc2VuZF9i
aXRtYXBfcmxlX29yX3BsYWluKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzdHJ1Y3QgYm1f
eGZlcl9jdHggKmMpCiAKIAlpZiAobGVuKSB7CiAJCWRjYnBfc2V0X2NvZGUocCwgUkxFX1ZMSV9C
aXRzKTsKLQkJZXJyID0gX19zZW5kX2NvbW1hbmQoZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+
Y29ubmVjdGlvbiwgZGV2aWNlLT52bnIsIHNvY2ssCisJCWVyciA9IF9fc2VuZF9jb21tYW5kKHBl
ZXJfZGV2aWNlLT5jb25uZWN0aW9uLCBkZXZpY2UtPnZuciwgc29jaywKIAkJCQkgICAgIFBfQ09N
UFJFU1NFRF9CSVRNQVAsIHNpemVvZigqcCkgKyBsZW4sCiAJCQkJICAgICBOVUxMLCAwKTsKIAkJ
Yy0+cGFja2V0c1swXSsrOwpAQCAtMTIzMyw3ICsxMjM0LDggQEAgc2VuZF9iaXRtYXBfcmxlX29y
X3BsYWluKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzdHJ1Y3QgYm1feGZlcl9jdHggKmMp
CiAJCWxlbiA9IG51bV93b3JkcyAqIHNpemVvZigqcCk7CiAJCWlmIChsZW4pCiAJCQlkcmJkX2Jt
X2dldF9sZWwoZGV2aWNlLCBjLT53b3JkX29mZnNldCwgbnVtX3dvcmRzLCBwKTsKLQkJZXJyID0g
X19zZW5kX2NvbW1hbmQoZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+Y29ubmVjdGlvbiwgZGV2
aWNlLT52bnIsIHNvY2ssIFBfQklUTUFQLCBsZW4sIE5VTEwsIDApOworCQllcnIgPSBfX3NlbmRf
Y29tbWFuZChwZWVyX2RldmljZS0+Y29ubmVjdGlvbiwgZGV2aWNlLT52bnIsIHNvY2ssIFBfQklU
TUFQLAorCQkJCSAgICAgbGVuLCBOVUxMLCAwKTsKIAkJYy0+d29yZF9vZmZzZXQgKz0gbnVtX3dv
cmRzOwogCQljLT5iaXRfb2Zmc2V0ID0gYy0+d29yZF9vZmZzZXQgKiBCSVRTX1BFUl9MT05HOwog
CkBAIC0xMjU0LDcgKzEyNTYsOCBAQCBzZW5kX2JpdG1hcF9ybGVfb3JfcGxhaW4oc3RydWN0IGRy
YmRfZGV2aWNlICpkZXZpY2UsIHN0cnVjdCBibV94ZmVyX2N0eCAqYykKIH0KIAogLyogU2VlIHRo
ZSBjb21tZW50IGF0IHJlY2VpdmVfYml0bWFwKCkgKi8KLXN0YXRpYyBpbnQgX2RyYmRfc2VuZF9i
aXRtYXAoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCitzdGF0aWMgaW50IF9kcmJkX3NlbmRf
Yml0bWFwKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAorCQkJICAgIHN0cnVjdCBkcmJkX3Bl
ZXJfZGV2aWNlICpwZWVyX2RldmljZSkKIHsKIAlzdHJ1Y3QgYm1feGZlcl9jdHggYzsKIAlpbnQg
ZXJyOwpAQCAtMTI4NSwyMCArMTI4OCwyMCBAQCBzdGF0aWMgaW50IF9kcmJkX3NlbmRfYml0bWFw
KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQogCX07CiAKIAlkbyB7Ci0JCWVyciA9IHNlbmRf
Yml0bWFwX3JsZV9vcl9wbGFpbihkZXZpY2UsICZjKTsKKwkJZXJyID0gc2VuZF9iaXRtYXBfcmxl
X29yX3BsYWluKHBlZXJfZGV2aWNlLCAmYyk7CiAJfSB3aGlsZSAoZXJyID4gMCk7CiAKIAlyZXR1
cm4gZXJyID09IDA7CiB9CiAKLWludCBkcmJkX3NlbmRfYml0bWFwKHN0cnVjdCBkcmJkX2Rldmlj
ZSAqZGV2aWNlKQoraW50IGRyYmRfc2VuZF9iaXRtYXAoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZp
Y2UsIHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSkKIHsKLQlzdHJ1Y3QgZHJi
ZF9zb2NrZXQgKnNvY2sgPSAmZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+Y29ubmVjdGlvbi0+
ZGF0YTsKKwlzdHJ1Y3QgZHJiZF9zb2NrZXQgKnNvY2sgPSAmcGVlcl9kZXZpY2UtPmNvbm5lY3Rp
b24tPmRhdGE7CiAJaW50IGVyciA9IC0xOwogCiAJbXV0ZXhfbG9jaygmc29jay0+bXV0ZXgpOwog
CWlmIChzb2NrLT5zb2NrZXQpCi0JCWVyciA9ICFfZHJiZF9zZW5kX2JpdG1hcChkZXZpY2UpOwor
CQllcnIgPSAhX2RyYmRfc2VuZF9iaXRtYXAoZGV2aWNlLCBwZWVyX2RldmljZSk7CiAJbXV0ZXhf
dW5sb2NrKCZzb2NrLT5tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTM0MDYsNyArMzQwOSw5
IEBAIHZvaWQgZHJiZF91dWlkX3NldF9ibShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgdTY0
IHZhbCkgX19tdXN0X2hvbGQobG9jYWwpCiAgKgogICogU2V0cyBhbGwgYml0cyBpbiB0aGUgYml0
bWFwIGFuZCB3cml0ZXMgdGhlIHdob2xlIGJpdG1hcCB0byBzdGFibGUgc3RvcmFnZS4KICAqLwot
aW50IGRyYmRfYm1pb19zZXRfbl93cml0ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkgX19t
dXN0X2hvbGQobG9jYWwpCitpbnQgZHJiZF9ibWlvX3NldF9uX3dyaXRlKHN0cnVjdCBkcmJkX2Rl
dmljZSAqZGV2aWNlLAorCQkJICBzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2Up
IF9fbXVzdF9ob2xkKGxvY2FsKQorCiB7CiAJaW50IHJ2ID0gLUVJTzsKIApAQCAtMzQxNCw3ICsz
NDE5LDcgQEAgaW50IGRyYmRfYm1pb19zZXRfbl93cml0ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRl
dmljZSkgX19tdXN0X2hvbGQobG9jYWwpCiAJZHJiZF9tZF9zeW5jKGRldmljZSk7CiAJZHJiZF9i
bV9zZXRfYWxsKGRldmljZSk7CiAKLQlydiA9IGRyYmRfYm1fd3JpdGUoZGV2aWNlKTsKKwlydiA9
IGRyYmRfYm1fd3JpdGUoZGV2aWNlLCBwZWVyX2RldmljZSk7CiAKIAlpZiAoIXJ2KSB7CiAJCWRy
YmRfbWRfY2xlYXJfZmxhZyhkZXZpY2UsIE1ERl9GVUxMX1NZTkMpOwpAQCAtMzQzMCwxMSArMzQz
NSwxMyBAQCBpbnQgZHJiZF9ibWlvX3NldF9uX3dyaXRlKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2
aWNlKSBfX211c3RfaG9sZChsb2NhbCkKICAqCiAgKiBDbGVhcnMgYWxsIGJpdHMgaW4gdGhlIGJp
dG1hcCBhbmQgd3JpdGVzIHRoZSB3aG9sZSBiaXRtYXAgdG8gc3RhYmxlIHN0b3JhZ2UuCiAgKi8K
LWludCBkcmJkX2JtaW9fY2xlYXJfbl93cml0ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkg
X19tdXN0X2hvbGQobG9jYWwpCitpbnQgZHJiZF9ibWlvX2NsZWFyX25fd3JpdGUoc3RydWN0IGRy
YmRfZGV2aWNlICpkZXZpY2UsCisJCQkgIHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2Rl
dmljZSkgX19tdXN0X2hvbGQobG9jYWwpCisKIHsKIAlkcmJkX3Jlc3VtZV9hbChkZXZpY2UpOwog
CWRyYmRfYm1fY2xlYXJfYWxsKGRldmljZSk7Ci0JcmV0dXJuIGRyYmRfYm1fd3JpdGUoZGV2aWNl
KTsKKwlyZXR1cm4gZHJiZF9ibV93cml0ZShkZXZpY2UsIHBlZXJfZGV2aWNlKTsKIH0KIAogc3Rh
dGljIGludCB3X2JpdG1hcF9pbyhzdHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQgdW51c2VkKQpAQCAt
MzQ1Myw3ICszNDYwLDcgQEAgc3RhdGljIGludCB3X2JpdG1hcF9pbyhzdHJ1Y3QgZHJiZF93b3Jr
ICp3LCBpbnQgdW51c2VkKQogCiAJaWYgKGdldF9sZGV2KGRldmljZSkpIHsKIAkJZHJiZF9ibV9s
b2NrKGRldmljZSwgd29yay0+d2h5LCB3b3JrLT5mbGFncyk7Ci0JCXJ2ID0gd29yay0+aW9fZm4o
ZGV2aWNlKTsKKwkJcnYgPSB3b3JrLT5pb19mbihkZXZpY2UsIHdvcmstPnBlZXJfZGV2aWNlKTsK
IAkJZHJiZF9ibV91bmxvY2soZGV2aWNlKTsKIAkJcHV0X2xkZXYoZGV2aWNlKTsKIAl9CkBAIC0z
NDg4LDExICszNDk1LDEyIEBAIHN0YXRpYyBpbnQgd19iaXRtYXBfaW8oc3RydWN0IGRyYmRfd29y
ayAqdywgaW50IHVudXNlZCkKICAqIHB1dF9sZGV2KCkuCiAgKi8KIHZvaWQgZHJiZF9xdWV1ZV9i
aXRtYXBfaW8oc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCi0JCQkgIGludCAoKmlvX2ZuKShz
dHJ1Y3QgZHJiZF9kZXZpY2UgKiksCisJCQkgIGludCAoKmlvX2ZuKShzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKiwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiksCiAJCQkgIHZvaWQgKCpkb25lKShzdHJ1
Y3QgZHJiZF9kZXZpY2UgKiwgaW50KSwKLQkJCSAgY2hhciAqd2h5LCBlbnVtIGJtX2ZsYWcgZmxh
Z3MpCisJCQkgIGNoYXIgKndoeSwgZW51bSBibV9mbGFnIGZsYWdzLAorCQkJICBzdHJ1Y3QgZHJi
ZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7Ci0JRF9BU1NFUlQoZGV2aWNlLCBjdXJyZW50
ID09IGZpcnN0X3BlZXJfZGV2aWNlKGRldmljZSktPmNvbm5lY3Rpb24tPndvcmtlci50YXNrKTsK
KwlEX0FTU0VSVChkZXZpY2UsIGN1cnJlbnQgPT0gcGVlcl9kZXZpY2UtPmNvbm5lY3Rpb24tPndv
cmtlci50YXNrKTsKIAogCURfQVNTRVJUKGRldmljZSwgIXRlc3RfYml0KEJJVE1BUF9JT19RVUVV
RUQsICZkZXZpY2UtPmZsYWdzKSk7CiAJRF9BU1NFUlQoZGV2aWNlLCAhdGVzdF9iaXQoQklUTUFQ
X0lPLCAmZGV2aWNlLT5mbGFncykpOwpAQCAtMzUwMSw2ICszNTA5LDcgQEAgdm9pZCBkcmJkX3F1
ZXVlX2JpdG1hcF9pbyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwKIAkJZHJiZF9lcnIoZGV2
aWNlLCAiRklYTUUgZ29pbmcgdG8gcXVldWUgJyVzJyBidXQgJyVzJyBzdGlsbCBwZW5kaW5nP1xu
IiwKIAkJCXdoeSwgZGV2aWNlLT5ibV9pb193b3JrLndoeSk7CiAKKwlkZXZpY2UtPmJtX2lvX3dv
cmsucGVlcl9kZXZpY2UgPSBwZWVyX2RldmljZTsKIAlkZXZpY2UtPmJtX2lvX3dvcmsuaW9fZm4g
PSBpb19mbjsKIAlkZXZpY2UtPmJtX2lvX3dvcmsuZG9uZSA9IGRvbmU7CiAJZGV2aWNlLT5ibV9p
b193b3JrLndoeSA9IHdoeTsKQEAgLTM1MTIsNyArMzUyMSw3IEBAIHZvaWQgZHJiZF9xdWV1ZV9i
aXRtYXBfaW8oc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCiAJICogYXBwbGljYXRpb24gSU8g
ZG9lcyBub3QgY29uZmxpY3QgYW55d2F5cy4gKi8KIAlpZiAoZmxhZ3MgPT0gQk1fTE9DS0VEX0NI
QU5HRV9BTExPV0VEIHx8IGF0b21pY19yZWFkKCZkZXZpY2UtPmFwX2Jpb19jbnQpID09IDApIHsK
IAkJaWYgKCF0ZXN0X2FuZF9zZXRfYml0KEJJVE1BUF9JT19RVUVVRUQsICZkZXZpY2UtPmZsYWdz
KSkKLQkJCWRyYmRfcXVldWVfd29yaygmZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKS0+Y29ubmVj
dGlvbi0+c2VuZGVyX3dvcmssCisJCQlkcmJkX3F1ZXVlX3dvcmsoJnBlZXJfZGV2aWNlLT5jb25u
ZWN0aW9uLT5zZW5kZXJfd29yaywKIAkJCQkJJmRldmljZS0+Ym1faW9fd29yay53KTsKIAl9CiAJ
c3Bpbl91bmxvY2tfaXJxKCZkZXZpY2UtPnJlc291cmNlLT5yZXFfbG9jayk7CkBAIC0zNTI4LDgg
KzM1MzcsMTAgQEAgdm9pZCBkcmJkX3F1ZXVlX2JpdG1hcF9pbyhzdHJ1Y3QgZHJiZF9kZXZpY2Ug
KmRldmljZSwKICAqIGZyZWV6ZXMgYXBwbGljYXRpb24gSU8gd2hpbGUgdGhhdCB0aGUgYWN0dWFs
IElPIG9wZXJhdGlvbnMgcnVucy4gVGhpcwogICogZnVuY3Rpb25zIE1BWSBOT1QgYmUgY2FsbGVk
IGZyb20gd29ya2VyIGNvbnRleHQuCiAgKi8KLWludCBkcmJkX2JpdG1hcF9pbyhzdHJ1Y3QgZHJi
ZF9kZXZpY2UgKmRldmljZSwgaW50ICgqaW9fZm4pKHN0cnVjdCBkcmJkX2RldmljZSAqKSwKLQkJ
Y2hhciAqd2h5LCBlbnVtIGJtX2ZsYWcgZmxhZ3MpCitpbnQgZHJiZF9iaXRtYXBfaW8oc3RydWN0
IGRyYmRfZGV2aWNlICpkZXZpY2UsCisJCWludCAoKmlvX2ZuKShzdHJ1Y3QgZHJiZF9kZXZpY2Ug
Kiwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiksCisJCWNoYXIgKndoeSwgZW51bSBibV9mbGFn
IGZsYWdzLAorCQlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7CiAJLyog
T25seSBzdXNwZW5kIGlvLCBpZiBzb21lIG9wZXJhdGlvbiBpcyBzdXBwb3NlZCB0byBiZSBsb2Nr
ZWQgb3V0ICovCiAJY29uc3QgYm9vbCBkb19zdXNwZW5kX2lvID0gZmxhZ3MgJiAoQk1fRE9OVF9D
TEVBUnxCTV9ET05UX1NFVHxCTV9ET05UX1RFU1QpOwpAQCAtMzU0MSw3ICszNTUyLDcgQEAgaW50
IGRyYmRfYml0bWFwX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQgKCppb19mbiko
c3RydWN0IGRyYmRfZGV2aWNlICoKIAkJZHJiZF9zdXNwZW5kX2lvKGRldmljZSk7CiAKIAlkcmJk
X2JtX2xvY2soZGV2aWNlLCB3aHksIGZsYWdzKTsKLQlydiA9IGlvX2ZuKGRldmljZSk7CisJcnYg
PSBpb19mbihkZXZpY2UsIHBlZXJfZGV2aWNlKTsKIAlkcmJkX2JtX3VubG9jayhkZXZpY2UpOwog
CiAJaWYgKGRvX3N1c3BlbmRfaW8pCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJi
ZF9ubC5jIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYwppbmRleCA2MDc1N2FjMzE3MDEu
LjA3YTUyYzVhMjk4OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYwor
KysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9ubC5jCkBAIC0xMDUzLDcgKzEwNTMsNyBAQCBk
cmJkX2RldGVybWluZV9kZXZfc2l6ZShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgZW51bSBk
ZHNfZmxhZ3MgZmxhZ3MsIHN0cnVjdAogCQkJIGxhX3NpemVfY2hhbmdlZCA/ICJzaXplIGNoYW5n
ZWQiIDogIm1kIG1vdmVkIik7CiAJCS8qIG5leHQgbGluZSBpbXBsaWNpdGx5IGRvZXMgZHJiZF9z
dXNwZW5kX2lvKCkrZHJiZF9yZXN1bWVfaW8oKSAqLwogCQlkcmJkX2JpdG1hcF9pbyhkZXZpY2Us
IG1kX21vdmVkID8gJmRyYmRfYm1fd3JpdGVfYWxsIDogJmRyYmRfYm1fd3JpdGUsCi0JCQkgICAg
ICAgInNpemUgY2hhbmdlZCIsIEJNX0xPQ0tFRF9NQVNLKTsKKwkJCSAgICAgICAic2l6ZSBjaGFu
Z2VkIiwgQk1fTE9DS0VEX01BU0ssIE5VTEwpOwogCiAJCS8qIG9uLWRpc2sgYml0bWFwIGFuZCBh
Y3Rpdml0eSBsb2cgaXMgYXV0aG9yaXRhdGl2ZSBhZ2FpbgogCQkgKiAodW5sZXNzIHRoZXJlIHdh
cyBhbiBJTyBlcnJvciBtZWFud2hpbGUuLi4pICovCkBAIC0yMDI3LDEzICsyMDI3LDE1IEBAIGlu
dCBkcmJkX2FkbV9hdHRhY2goc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0IGdlbmxfaW5mbyAq
aW5mbykKIAkJZHJiZF9pbmZvKGRldmljZSwgIkFzc3VtaW5nIHRoYXQgYWxsIGJsb2NrcyBhcmUg
b3V0IG9mIHN5bmMgIgogCQkgICAgICIoYWthIEZ1bGxTeW5jKVxuIik7CiAJCWlmIChkcmJkX2Jp
dG1hcF9pbyhkZXZpY2UsICZkcmJkX2JtaW9fc2V0X25fd3JpdGUsCi0JCQkic2V0X25fd3JpdGUg
ZnJvbSBhdHRhY2hpbmciLCBCTV9MT0NLRURfTUFTSykpIHsKKwkJCSJzZXRfbl93cml0ZSBmcm9t
IGF0dGFjaGluZyIsIEJNX0xPQ0tFRF9NQVNLLAorCQkJTlVMTCkpIHsKIAkJCXJldGNvZGUgPSBF
UlJfSU9fTURfRElTSzsKIAkJCWdvdG8gZm9yY2VfZGlza2xlc3NfZGVjOwogCQl9CiAJfSBlbHNl
IHsKIAkJaWYgKGRyYmRfYml0bWFwX2lvKGRldmljZSwgJmRyYmRfYm1fcmVhZCwKLQkJCSJyZWFk
IGZyb20gYXR0YWNoaW5nIiwgQk1fTE9DS0VEX01BU0spKSB7CisJCQkicmVhZCBmcm9tIGF0dGFj
aGluZyIsIEJNX0xPQ0tFRF9NQVNLLAorCQkJTlVMTCkpIHsKIAkJCXJldGNvZGUgPSBFUlJfSU9f
TURfRElTSzsKIAkJCWdvdG8gZm9yY2VfZGlza2xlc3NfZGVjOwogCQl9CkBAIC0yOTcyLDcgKzI5
NzQsNyBAQCBpbnQgZHJiZF9hZG1faW52YWxpZGF0ZShzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1
Y3QgZ2VubF9pbmZvICppbmZvKQogCQlyZXRjb2RlID0gZHJiZF9yZXF1ZXN0X3N0YXRlKGRldmlj
ZSwgTlMoZGlzaywgRF9JTkNPTlNJU1RFTlQpKTsKIAkJaWYgKHJldGNvZGUgPj0gU1NfU1VDQ0VT
UykgewogCQkJaWYgKGRyYmRfYml0bWFwX2lvKGRldmljZSwgJmRyYmRfYm1pb19zZXRfbl93cml0
ZSwKLQkJCQkic2V0X25fd3JpdGUgZnJvbSBpbnZhbGlkYXRlIiwgQk1fTE9DS0VEX01BU0spKQor
CQkJCSJzZXRfbl93cml0ZSBmcm9tIGludmFsaWRhdGUiLCBCTV9MT0NLRURfTUFTSywgTlVMTCkp
CiAJCQkJcmV0Y29kZSA9IEVSUl9JT19NRF9ESVNLOwogCQl9CiAJfSBlbHNlCkBAIC0zMDUyLDcg
KzMwNTQsNyBAQCBpbnQgZHJiZF9hZG1faW52YWxpZGF0ZV9wZWVyKHN0cnVjdCBza19idWZmICpz
a2IsIHN0cnVjdCBnZW5sX2luZm8gKmluZm8pCiAJCWlmIChyZXRjb2RlID49IFNTX1NVQ0NFU1Mp
IHsKIAkJCWlmIChkcmJkX2JpdG1hcF9pbyhkZXZpY2UsICZkcmJkX2JtaW9fc2V0X3N1c3BfYWws
CiAJCQkJInNldF9uX3dyaXRlIGZyb20gaW52YWxpZGF0ZV9wZWVyIiwKLQkJCQlCTV9MT0NLRURf
U0VUX0FMTE9XRUQpKQorCQkJCUJNX0xPQ0tFRF9TRVRfQUxMT1dFRCwgTlVMTCkpCiAJCQkJcmV0
Y29kZSA9IEVSUl9JT19NRF9ESVNLOwogCQl9CiAJfSBlbHNlCkBAIC00MTQ4LDcgKzQxNTAsNyBA
QCBpbnQgZHJiZF9hZG1fbmV3X2NfdXVpZChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgZ2Vu
bF9pbmZvICppbmZvKQogCiAJaWYgKGFyZ3MuY2xlYXJfYm0pIHsKIAkJZXJyID0gZHJiZF9iaXRt
YXBfaW8oZGV2aWNlLCAmZHJiZF9ibWlvX2NsZWFyX25fd3JpdGUsCi0JCQkiY2xlYXJfbl93cml0
ZSBmcm9tIG5ld19jX3V1aWQiLCBCTV9MT0NLRURfTUFTSyk7CisJCQkiY2xlYXJfbl93cml0ZSBm
cm9tIG5ld19jX3V1aWQiLCBCTV9MT0NLRURfTUFTSywgTlVMTCk7CiAJCWlmIChlcnIpIHsKIAkJ
CWRyYmRfZXJyKGRldmljZSwgIldyaXRpbmcgYml0bWFwIGZhaWxlZCB3aXRoICVkXG4iLCBlcnIp
OwogCQkJcmV0Y29kZSA9IEVSUl9JT19NRF9ESVNLOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9j
ay9kcmJkL2RyYmRfcmVjZWl2ZXIuYyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVy
LmMKaW5kZXggNzU3ZjQ2OTJiNWJkLi40MjQ3NDhmNmU0ZmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
YmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMKKysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRf
cmVjZWl2ZXIuYwpAQCAtMzU5MSw3ICszNTkxLDcgQEAgc3RhdGljIGVudW0gZHJiZF9jb25ucyBk
cmJkX3N5bmNfaGFuZHNoYWtlKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwK
IAlpZiAoYWJzKGhnKSA+PSAyKSB7CiAJCWRyYmRfaW5mbyhkZXZpY2UsICJXcml0aW5nIHRoZSB3
aG9sZSBiaXRtYXAsIGZ1bGwgc3luYyByZXF1aXJlZCBhZnRlciBkcmJkX3N5bmNfaGFuZHNoYWtl
LlxuIik7CiAJCWlmIChkcmJkX2JpdG1hcF9pbyhkZXZpY2UsICZkcmJkX2JtaW9fc2V0X25fd3Jp
dGUsICJzZXRfbl93cml0ZSBmcm9tIHN5bmNfaGFuZHNoYWtlIiwKLQkJCQkJQk1fTE9DS0VEX1NF
VF9BTExPV0VEKSkKKwkJCQkJQk1fTE9DS0VEX1NFVF9BTExPV0VELCBOVUxMKSkKIAkJCXJldHVy
biBDX01BU0s7CiAJfQogCkBAIC00MjcwLDcgKzQyNzAsNyBAQCBzdGF0aWMgaW50IHJlY2VpdmVf
dXVpZHMoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9p
bmZvCiAJCQlkcmJkX2luZm8oZGV2aWNlLCAiQWNjZXB0ZWQgbmV3IGN1cnJlbnQgVVVJRCwgcHJl
cGFyaW5nIHRvIHNraXAgaW5pdGlhbCBzeW5jXG4iKTsKIAkJCWRyYmRfYml0bWFwX2lvKGRldmlj
ZSwgJmRyYmRfYm1pb19jbGVhcl9uX3dyaXRlLAogCQkJCQkiY2xlYXJfbl93cml0ZSBmcm9tIHJl
Y2VpdmVfdXVpZHMiLAotCQkJCQlCTV9MT0NLRURfVEVTVF9BTExPV0VEKTsKKwkJCQkJQk1fTE9D
S0VEX1RFU1RfQUxMT1dFRCwgTlVMTCk7CiAJCQlfZHJiZF91dWlkX3NldChkZXZpY2UsIFVJX0NV
UlJFTlQsIHBfdXVpZFtVSV9DVVJSRU5UXSk7CiAJCQlfZHJiZF91dWlkX3NldChkZXZpY2UsIFVJ
X0JJVE1BUCwgMCk7CiAJCQlfZHJiZF9zZXRfc3RhdGUoX05TMihkZXZpY2UsIGRpc2ssIERfVVBf
VE9fREFURSwgcGRzaywgRF9VUF9UT19EQVRFKSwKQEAgLTUyMTQsNyArNTIxNCw3IEBAIHN0YXRp
YyBpbnQgZHJiZF9kaXNjb25uZWN0ZWQoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2
aWNlKQogCiAJaWYgKGdldF9sZGV2KGRldmljZSkpIHsKIAkJZHJiZF9iaXRtYXBfaW8oZGV2aWNl
LCAmZHJiZF9ibV93cml0ZV9jb3B5X3BhZ2VzLAotCQkJCSJ3cml0ZSBmcm9tIGRpc2Nvbm5lY3Rl
ZCIsIEJNX0xPQ0tFRF9DSEFOR0VfQUxMT1dFRCk7CisJCQkJIndyaXRlIGZyb20gZGlzY29ubmVj
dGVkIiwgQk1fTE9DS0VEX0NIQU5HRV9BTExPV0VELCBOVUxMKTsKIAkJcHV0X2xkZXYoZGV2aWNl
KTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3N0YXRlLmMgYi9k
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9zdGF0ZS5jCmluZGV4IDc1ZDEzZWEwMDI0Zi4uMGIzMzVk
ZGQ2ZDEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9zdGF0ZS5jCisrKyBi
L2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3N0YXRlLmMKQEAgLTE1MTgsOCArMTUxOCw5IEBAIHN0
YXRpYyB2b2lkIGFid19zdGFydF9zeW5jKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQg
cnYpCiB9CiAKIGludCBkcmJkX2JpdG1hcF9pb19mcm9tX3dvcmtlcihzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKmRldmljZSwKLQkJaW50ICgqaW9fZm4pKHN0cnVjdCBkcmJkX2RldmljZSAqKSwKLQkJY2hh
ciAqd2h5LCBlbnVtIGJtX2ZsYWcgZmxhZ3MpCisJCWludCAoKmlvX2ZuKShzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKiwgc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiksCisJCWNoYXIgKndoeSwgZW51bSBi
bV9mbGFnIGZsYWdzLAorCQlzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7
CiAJaW50IHJ2OwogCkBAIC0xNTI5LDcgKzE1MzAsNyBAQCBpbnQgZHJiZF9iaXRtYXBfaW9fZnJv
bV93b3JrZXIoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsCiAJYXRvbWljX2luYygmZGV2aWNl
LT5zdXNwZW5kX2NudCk7CiAKIAlkcmJkX2JtX2xvY2soZGV2aWNlLCB3aHksIGZsYWdzKTsKLQly
diA9IGlvX2ZuKGRldmljZSk7CisJcnYgPSBpb19mbihkZXZpY2UsIHBlZXJfZGV2aWNlKTsKIAlk
cmJkX2JtX3VubG9jayhkZXZpY2UpOwogCiAJZHJiZF9yZXN1bWVfaW8oZGV2aWNlKTsKLS0gCjIu
MzkuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJi
ZC1kZXYgbWFpbGluZyBsaXN0CmRyYmQtZGV2QGxpc3RzLmxpbmJpdC5jb20KaHR0cHM6Ly9saXN0
cy5saW5iaXQuY29tL21haWxtYW4vbGlzdGluZm8vZHJiZC1kZXYK
