Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 4C5496A8301
	for <lists+drbd-dev@lfdr.de>; Thu,  2 Mar 2023 13:58:57 +0100 (CET)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 2EA1D422149;
	Thu,  2 Mar 2023 13:58:57 +0100 (CET)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ed1-f45.google.com (mail-ed1-f45.google.com
	[209.85.208.45])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 0F2C6421746
	for <drbd-dev@lists.linbit.com>; Thu,  2 Mar 2023 13:55:34 +0100 (CET)
Received: by mail-ed1-f45.google.com with SMTP id i34so67141626eda.7
	for <drbd-dev@lists.linbit.com>; Thu, 02 Mar 2023 04:55:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112; t=1677761734;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:from:to:cc:subject:date
	:message-id:reply-to;
	bh=bl+f61gPv3YcHhSpJ6d/UUGcw0+eXxBFZehJkRpUHGw=;
	b=K2RP+/lGH+k+L4Cbo4avoDUNprO2ipBUFUy46uePWDXzkTieb+qcAcdSxPZ84JPV2p
	onpGZdAXuUZnHF9xrVcyifuNa+VNjTJmiBKPbwNgXo1QrdIVGDkiE5e6oZNkJf/ZQgcl
	iIzj4ES+yk/c7OcEA0j1ygeY0nRxM5OQgcTPIsk4adoTHkoeRCDuOTdJxYeecsof684e
	KaboK3nBVsPkbr44V9hsdIpGjPBHv4ldTTP7lk3P8wu68oTRu6lQhuiSbn7cFfsH2JuS
	IgKCV2IPIQbRCTXQxPIFPivC7n4ML5zucpe9k13EQmA077vyKknLIfvIEphtOiKbCVz3
	CrOw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112; t=1677761734;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
	:subject:date:message-id:reply-to;
	bh=bl+f61gPv3YcHhSpJ6d/UUGcw0+eXxBFZehJkRpUHGw=;
	b=1pPfg/osO4af3Nro7CItVd8O9fWoXBqpFMCsMoUrvImNuzBIY+2vv/qfgLqVh49gDh
	/Ofjdwtkc1YsrUoPrSMh7dhBM2RPaCvddbC9EdwvMEEbBXFw8GM6twzlZv/f8igUbSjZ
	WcqT2MXiy2R+wbqjUxuFKIKdAugtmx/Afk/cqlmpvnrrsjRCr0VDAKlDngI/br3rY638
	Qfs0k4UCubPgC75lKeYHttsygv08eksLoIbWJvgapuo2W8QY4XD1UI8PerQ1QhusR6+c
	NMGaKofPcZyY2MdCVSZ4tiLMKanxz18NGFzogj8zSXkb+++aiqPoAnf9mWZruSIZ2XzH
	PVpA==
X-Gm-Message-State: AO0yUKW6ylBxTPd5Go+U6Q17recza5anvQ5moXaFGmjDsNyvPynD4fbk
	86m4E1iZKtCLyycb2A0n9H+Ic18l
X-Google-Smtp-Source: AK7set+yogQJRR/F1w7YjP4cHex15idSc3lBTb7v2iHiyvGCNjT2veL2jX6JHz8AwF85sjxC0WTnRw==
X-Received: by 2002:a17:906:f751:b0:887:8f6:c1d7 with SMTP id
	jp17-20020a170906f75100b0088708f6c1d7mr11551109ejb.38.1677761734332;
	Thu, 02 Mar 2023 04:55:34 -0800 (PST)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	a98-20020a509eeb000000b004ad601533a3sm6955034edf.55.2023.03.02.04.55.33
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Thu, 02 Mar 2023 04:55:33 -0800 (PST)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Thu,  2 Mar 2023 13:54:45 +0100
Message-Id: <20230302125445.2653493-8-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.39.1
In-Reply-To: <20230302125445.2653493-1-christoph.boehmwalder@linbit.com>
References: <20230302125445.2653493-1-christoph.boehmwalder@linbit.com>
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH v2 7/7] drbd: Pass a peer device to the resync
	and online verify functions
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

T3JpZ2luYWxseS1mcm9tOiBBbmRyZWFzIEdyw7xuYmFjaGVyIDxhZ3J1ZW5AbGluYml0LmNvbT4K
U2lnbmVkLW9mZi1ieTogQ2hyaXN0b3BoIELDtmhtd2FsZGVyIDxjaHJpc3RvcGguYm9laG13YWxk
ZXJAbGluYml0LmNvbT4KLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYyAgIHwg
MTMgKystLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmggICAgICB8IDQ2ICsrKysrKyst
LS0tLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jIHwgNTkgKysrKysrKysr
LS0tLS0tLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZXEuYyAgICAgIHwgIDkgKy0tCiBk
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9zdGF0ZS5jICAgIHwgMTAgKy0tCiBkcml2ZXJzL2Jsb2Nr
L2RyYmQvZHJiZF93b3JrZXIuYyAgIHwgOTcgKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
CiA2IGZpbGVzIGNoYW5nZWQsIDEyNiBpbnNlcnRpb25zKCspLCAxMDggZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYWN0bG9nLmMgYi9kcml2ZXJzL2Js
b2NrL2RyYmQvZHJiZF9hY3Rsb2cuYwppbmRleCA0MjkyNTU4NzY4MDAuLjY0YjNhMWM3NmYwMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYWN0bG9nLmMKKysrIGIvZHJpdmVy
cy9ibG9jay9kcmJkL2RyYmRfYWN0bG9nLmMKQEAgLTczNSw4ICs3MzUsOSBAQCBzdGF0aWMgYm9v
bCB1cGRhdGVfcnNfZXh0ZW50KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAogCXJldHVybiBm
YWxzZTsKIH0KIAotdm9pZCBkcmJkX2FkdmFuY2VfcnNfbWFya3Moc3RydWN0IGRyYmRfZGV2aWNl
ICpkZXZpY2UsIHVuc2lnbmVkIGxvbmcgc3RpbGxfdG9fZ28pCit2b2lkIGRyYmRfYWR2YW5jZV9y
c19tYXJrcyhzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UsIHVuc2lnbmVkIGxv
bmcgc3RpbGxfdG9fZ28pCiB7CisJc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBwZWVyX2Rl
dmljZS0+ZGV2aWNlOwogCXVuc2lnbmVkIGxvbmcgbm93ID0gamlmZmllczsKIAl1bnNpZ25lZCBs
b25nIGxhc3QgPSBkZXZpY2UtPnJzX21hcmtfdGltZVtkZXZpY2UtPnJzX2xhc3RfbWFya107CiAJ
aW50IG5leHQgPSAoZGV2aWNlLT5yc19sYXN0X21hcmsgKyAxKSAlIERSQkRfU1lOQ19NQVJLUzsK
QEAgLTgxOSw3ICs4MjAsNyBAQCBzdGF0aWMgaW50IHVwZGF0ZV9zeW5jX2JpdHMoc3RydWN0IGRy
YmRfZGV2aWNlICpkZXZpY2UsCiAJCWlmIChtb2RlID09IFNFVF9JTl9TWU5DKSB7CiAJCQl1bnNp
Z25lZCBsb25nIHN0aWxsX3RvX2dvID0gZHJiZF9ibV90b3RhbF93ZWlnaHQoZGV2aWNlKTsKIAkJ
CWJvb2wgcnNfaXNfZG9uZSA9IChzdGlsbF90b19nbyA8PSBkZXZpY2UtPnJzX2ZhaWxlZCk7Ci0J
CQlkcmJkX2FkdmFuY2VfcnNfbWFya3MoZGV2aWNlLCBzdGlsbF90b19nbyk7CisJCQlkcmJkX2Fk
dmFuY2VfcnNfbWFya3MoZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKSwgc3RpbGxfdG9fZ28pOwog
CQkJaWYgKGNsZWFyZWQgfHwgcnNfaXNfZG9uZSkKIAkJCQltYXliZV9zY2hlZHVsZV9vbl9kaXNr
X2JpdG1hcF91cGRhdGUoZGV2aWNlLCByc19pc19kb25lKTsKIAkJfSBlbHNlIGlmIChtb2RlID09
IFJFQ09SRF9SU19GQUlMRUQpCkBAIC04NDMsMTAgKzg0NCwxMSBAQCBzdGF0aWMgYm9vbCBwbGF1
c2libGVfcmVxdWVzdF9zaXplKGludCBzaXplKQogICogY2FsbGVkIGJ5IHdvcmtlciBvbiBDX1NZ
TkNfVEFSR0VUIGFuZCByZWNlaXZlciBvbiBTeW5jU291cmNlLgogICoKICAqLwotaW50IF9fZHJi
ZF9jaGFuZ2Vfc3luYyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgc2VjdG9yX3Qgc2VjdG9y
LCBpbnQgc2l6ZSwKK2ludCBfX2RyYmRfY2hhbmdlX3N5bmMoc3RydWN0IGRyYmRfcGVlcl9kZXZp
Y2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IsIGludCBzaXplLAogCQllbnVtIHVwZGF0
ZV9zeW5jX2JpdHNfbW9kZSBtb2RlKQogewogCS8qIElzIGNhbGxlZCBmcm9tIHdvcmtlciBhbmQg
cmVjZWl2ZXIgY29udGV4dCBfb25seV8gKi8KKwlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9
IHBlZXJfZGV2aWNlLT5kZXZpY2U7CiAJdW5zaWduZWQgbG9uZyBzYm5yLCBlYm5yLCBsYm5yOwog
CXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOwogCXNlY3Rvcl90IGVzZWN0b3IsIG5yX3NlY3RvcnM7
CkBAIC0xMDA5LDE0ICsxMDExLDE1IEBAIGludCBkcmJkX3JzX2JlZ2luX2lvKHN0cnVjdCBkcmJk
X2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IpCiAgKiB0cmllcyB0byBzZXQgaXQgdG8g
Qk1FX0xPQ0tFRC4gUmV0dXJucyAwIHVwb24gc3VjY2VzcywgYW5kIC1FQUdBSU4KICAqIGlmIHRo
ZXJlIGlzIHN0aWxsIGFwcGxpY2F0aW9uIElPIGdvaW5nIG9uIGluIHRoaXMgYXJlYS4KICAqLwot
aW50IGRyYmRfdHJ5X3JzX2JlZ2luX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0
b3JfdCBzZWN0b3IpCitpbnQgZHJiZF90cnlfcnNfYmVnaW5faW8oc3RydWN0IGRyYmRfcGVlcl9k
ZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IpCiB7CisJc3RydWN0IGRyYmRfZGV2
aWNlICpkZXZpY2UgPSBwZWVyX2RldmljZS0+ZGV2aWNlOwogCXVuc2lnbmVkIGludCBlbnIgPSBC
TV9TRUNUX1RPX0VYVChzZWN0b3IpOwogCWNvbnN0IHVuc2lnbmVkIGludCBhbF9lbnIgPSBlbnIq
QUxfRVhUX1BFUl9CTV9TRUNUOwogCXN0cnVjdCBsY19lbGVtZW50ICplOwogCXN0cnVjdCBibV9l
eHRlbnQgKmJtX2V4dDsKIAlpbnQgaTsKLQlib29sIHRocm90dGxlID0gZHJiZF9yc19zaG91bGRf
c2xvd19kb3duKGRldmljZSwgc2VjdG9yLCB0cnVlKTsKKwlib29sIHRocm90dGxlID0gZHJiZF9y
c19zaG91bGRfc2xvd19kb3duKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHRydWUpOwogCiAJLyogSWYg
d2UgbmVlZCB0byB0aHJvdHRsZSwgYSBoYWxmLWxvY2tlZCAob25seSBtYXJrZWQgQk1FX05PX1dS
SVRFUywKIAkgKiBub3QgeWV0IEJNRV9MT0NLRUQpIGV4dGVudCBuZWVkcyB0byBiZSBraWNrZWQg
b3V0IGV4cGxpY2l0bHkgaWYgd2UKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJk
X2ludC5oIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfaW50LmgKaW5kZXggOTdjMDkxOTkwYmY2
Li5hMzBhNWVkODExYmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5o
CisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2ludC5oCkBAIC0xNDMzLDIxICsxNDMzLDI0
IEBAIHZvaWQgZHJiZF9yZXN5bmNfYWZ0ZXJfY2hhbmdlZChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRl
dmljZSk7CiBleHRlcm4gdm9pZCBkcmJkX3N0YXJ0X3Jlc3luYyhzdHJ1Y3QgZHJiZF9kZXZpY2Ug
KmRldmljZSwgZW51bSBkcmJkX2Nvbm5zIHNpZGUpOwogZXh0ZXJuIHZvaWQgcmVzdW1lX25leHRf
c2coc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpOwogZXh0ZXJuIHZvaWQgc3VzcGVuZF9vdGhl
cl9zZyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSk7Ci1leHRlcm4gaW50IGRyYmRfcmVzeW5j
X2ZpbmlzaGVkKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKTsKK2V4dGVybiBpbnQgZHJiZF9y
ZXN5bmNfZmluaXNoZWQoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlKTsKIC8q
IG1heWJlIHJhdGhlciBkcmJkX21haW4uYyA/ICovCiBleHRlcm4gdm9pZCAqZHJiZF9tZF9nZXRf
YnVmZmVyKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBjb25zdCBjaGFyICppbnRlbnQpOwog
ZXh0ZXJuIHZvaWQgZHJiZF9tZF9wdXRfYnVmZmVyKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
KTsKIGV4dGVybiBpbnQgZHJiZF9tZF9zeW5jX3BhZ2VfaW8oc3RydWN0IGRyYmRfZGV2aWNlICpk
ZXZpY2UsCiAJCXN0cnVjdCBkcmJkX2JhY2tpbmdfZGV2ICpiZGV2LCBzZWN0b3JfdCBzZWN0b3Is
IGVudW0gcmVxX29wIG9wKTsKLWV4dGVybiB2b2lkIGRyYmRfb3Zfb3V0X29mX3N5bmNfZm91bmQo
c3RydWN0IGRyYmRfZGV2aWNlICosIHNlY3Rvcl90LCBpbnQpOworZXh0ZXJuIHZvaWQgZHJiZF9v
dl9vdXRfb2Zfc3luY19mb3VuZChzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2Us
CisJCXNlY3Rvcl90IHNlY3RvciwgaW50IHNpemUpOwogZXh0ZXJuIHZvaWQgd2FpdF91bnRpbF9k
b25lX29yX2ZvcmNlX2RldGFjaGVkKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAogCQlzdHJ1
Y3QgZHJiZF9iYWNraW5nX2RldiAqYmRldiwgdW5zaWduZWQgaW50ICpkb25lKTsKLWV4dGVybiB2
b2lkIGRyYmRfcnNfY29udHJvbGxlcl9yZXNldChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSk7
CitleHRlcm4gdm9pZCBkcmJkX3JzX2NvbnRyb2xsZXJfcmVzZXQoc3RydWN0IGRyYmRfcGVlcl9k
ZXZpY2UgKnBlZXJfZGV2aWNlKTsKIAotc3RhdGljIGlubGluZSB2b2lkIG92X291dF9vZl9zeW5j
X3ByaW50KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQorc3RhdGljIGlubGluZSB2b2lkIG92
X291dF9vZl9zeW5jX3ByaW50KHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSkK
IHsKKwlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9IHBlZXJfZGV2aWNlLT5kZXZpY2U7CisK
IAlpZiAoZGV2aWNlLT5vdl9sYXN0X29vc19zaXplKSB7Ci0JCWRyYmRfZXJyKGRldmljZSwgIk91
dCBvZiBzeW5jOiBzdGFydD0lbGx1LCBzaXplPSVsdSAoc2VjdG9ycylcbiIsCisJCWRyYmRfZXJy
KHBlZXJfZGV2aWNlLCAiT3V0IG9mIHN5bmM6IHN0YXJ0PSVsbHUsIHNpemU9JWx1IChzZWN0b3Jz
KVxuIiwKIAkJICAgICAodW5zaWduZWQgbG9uZyBsb25nKWRldmljZS0+b3ZfbGFzdF9vb3Nfc3Rh
cnQsCiAJCSAgICAgKHVuc2lnbmVkIGxvbmcpZGV2aWNlLT5vdl9sYXN0X29vc19zaXplKTsKIAl9
CkBAIC0xNDg2LDcgKzE0ODksNyBAQCBleHRlcm4gaW50IGRyYmRfYWNrX3JlY2VpdmVyKHN0cnVj
dCBkcmJkX3RocmVhZCAqdGhpKTsKIGV4dGVybiB2b2lkIGRyYmRfc2VuZF9waW5nX3dmKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd3MpOwogZXh0ZXJuIHZvaWQgZHJiZF9zZW5kX2Fja3Nfd2Yoc3RydWN0
IHdvcmtfc3RydWN0ICp3cyk7CiBleHRlcm4gYm9vbCBkcmJkX3JzX2NfbWluX3JhdGVfdGhyb3R0
bGUoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpOwotZXh0ZXJuIGJvb2wgZHJiZF9yc19zaG91
bGRfc2xvd19kb3duKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3Is
CitleHRlcm4gYm9vbCBkcmJkX3JzX3Nob3VsZF9zbG93X2Rvd24oc3RydWN0IGRyYmRfcGVlcl9k
ZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IsCiAJCWJvb2wgdGhyb3R0bGVfaWZf
YXBwX2lzX3dhaXRpbmcpOwogZXh0ZXJuIGludCBkcmJkX3N1Ym1pdF9wZWVyX3JlcXVlc3Qoc3Ry
dWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcSk7CiBleHRlcm4gaW50IGRyYmRfZnJlZV9w
ZWVyX3JlcXMoc3RydWN0IGRyYmRfZGV2aWNlICosIHN0cnVjdCBsaXN0X2hlYWQgKik7CkBAIC0x
NTQyLDIyICsxNTQ1LDIyIEBAIGV4dGVybiB2b2lkIGRyYmRfYWxfYmVnaW5faW8oc3RydWN0IGRy
YmRfZGV2aWNlICpkZXZpY2UsIHN0cnVjdCBkcmJkX2ludGVydmFsICppCiBleHRlcm4gdm9pZCBk
cmJkX2FsX2NvbXBsZXRlX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzdHJ1Y3QgZHJi
ZF9pbnRlcnZhbCAqaSk7CiBleHRlcm4gdm9pZCBkcmJkX3JzX2NvbXBsZXRlX2lvKHN0cnVjdCBk
cmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IpOwogZXh0ZXJuIGludCBkcmJkX3Jz
X2JlZ2luX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IpOwot
ZXh0ZXJuIGludCBkcmJkX3RyeV9yc19iZWdpbl9pbyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSwgc2VjdG9yX3Qgc2VjdG9yKTsKK2V4dGVybiBpbnQgZHJiZF90cnlfcnNfYmVnaW5faW8oc3Ry
dWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IpOwogZXh0
ZXJuIHZvaWQgZHJiZF9yc19jYW5jZWxfYWxsKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKTsK
IGV4dGVybiBpbnQgZHJiZF9yc19kZWxfYWxsKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKTsK
LWV4dGVybiB2b2lkIGRyYmRfcnNfZmFpbGVkX2lvKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
LAorZXh0ZXJuIHZvaWQgZHJiZF9yc19mYWlsZWRfaW8oc3RydWN0IGRyYmRfcGVlcl9kZXZpY2Ug
KnBlZXJfZGV2aWNlLAogCQlzZWN0b3JfdCBzZWN0b3IsIGludCBzaXplKTsKLWV4dGVybiB2b2lk
IGRyYmRfYWR2YW5jZV9yc19tYXJrcyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgdW5zaWdu
ZWQgbG9uZyBzdGlsbF90b19nbyk7CitleHRlcm4gdm9pZCBkcmJkX2FkdmFuY2VfcnNfbWFya3Mo
c3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCB1bnNpZ25lZCBsb25nIHN0aWxs
X3RvX2dvKTsKIAogZW51bSB1cGRhdGVfc3luY19iaXRzX21vZGUgeyBSRUNPUkRfUlNfRkFJTEVE
LCBTRVRfT1VUX09GX1NZTkMsIFNFVF9JTl9TWU5DIH07Ci1leHRlcm4gaW50IF9fZHJiZF9jaGFu
Z2Vfc3luYyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgc2VjdG9yX3Qgc2VjdG9yLCBpbnQg
c2l6ZSwKK2V4dGVybiBpbnQgX19kcmJkX2NoYW5nZV9zeW5jKHN0cnVjdCBkcmJkX3BlZXJfZGV2
aWNlICpwZWVyX2RldmljZSwgc2VjdG9yX3Qgc2VjdG9yLCBpbnQgc2l6ZSwKIAkJZW51bSB1cGRh
dGVfc3luY19iaXRzX21vZGUgbW9kZSk7Ci0jZGVmaW5lIGRyYmRfc2V0X2luX3N5bmMoZGV2aWNl
LCBzZWN0b3IsIHNpemUpIFwKLQlfX2RyYmRfY2hhbmdlX3N5bmMoZGV2aWNlLCBzZWN0b3IsIHNp
emUsIFNFVF9JTl9TWU5DKQotI2RlZmluZSBkcmJkX3NldF9vdXRfb2Zfc3luYyhkZXZpY2UsIHNl
Y3Rvciwgc2l6ZSkgXAotCV9fZHJiZF9jaGFuZ2Vfc3luYyhkZXZpY2UsIHNlY3Rvciwgc2l6ZSwg
U0VUX09VVF9PRl9TWU5DKQotI2RlZmluZSBkcmJkX3JzX2ZhaWxlZF9pbyhkZXZpY2UsIHNlY3Rv
ciwgc2l6ZSkgXAotCV9fZHJiZF9jaGFuZ2Vfc3luYyhkZXZpY2UsIHNlY3Rvciwgc2l6ZSwgUkVD
T1JEX1JTX0ZBSUxFRCkKKyNkZWZpbmUgZHJiZF9zZXRfaW5fc3luYyhwZWVyX2RldmljZSwgc2Vj
dG9yLCBzaXplKSBcCisJX19kcmJkX2NoYW5nZV9zeW5jKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHNp
emUsIFNFVF9JTl9TWU5DKQorI2RlZmluZSBkcmJkX3NldF9vdXRfb2Zfc3luYyhwZWVyX2Rldmlj
ZSwgc2VjdG9yLCBzaXplKSBcCisJX19kcmJkX2NoYW5nZV9zeW5jKHBlZXJfZGV2aWNlLCBzZWN0
b3IsIHNpemUsIFNFVF9PVVRfT0ZfU1lOQykKKyNkZWZpbmUgZHJiZF9yc19mYWlsZWRfaW8ocGVl
cl9kZXZpY2UsIHNlY3Rvciwgc2l6ZSkgXAorCV9fZHJiZF9jaGFuZ2Vfc3luYyhwZWVyX2Rldmlj
ZSwgc2VjdG9yLCBzaXplLCBSRUNPUkRfUlNfRkFJTEVEKQogZXh0ZXJuIHZvaWQgZHJiZF9hbF9z
aHJpbmsoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpOwogZXh0ZXJuIGludCBkcmJkX2FsX2lu
aXRpYWxpemUoc3RydWN0IGRyYmRfZGV2aWNlICosIHZvaWQgKik7CiAKQEAgLTE5NDUsMTUgKzE5
NDgsMTYgQEAgc3RhdGljIGlubGluZSBpbnQgX19kZWNfYXBfcGVuZGluZyhzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKmRldmljZSkKICAqIENfU1lOQ19TT1VSQ0Ugc2VuZHMgUF9SU19EQVRBX1JFUExZICAg
KGFuZCBleHBlY3RzIFBfV1JJVEVfQUNLIHdpdGggSURfU1lOQ0VSKQogICoJCQkJCSAgIChvciBQ
X05FR19BQ0sgd2l0aCBJRF9TWU5DRVIpCiAgKi8KLXN0YXRpYyBpbmxpbmUgdm9pZCBpbmNfcnNf
cGVuZGluZyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKK3N0YXRpYyBpbmxpbmUgdm9pZCBp
bmNfcnNfcGVuZGluZyhzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7Ci0J
YXRvbWljX2luYygmZGV2aWNlLT5yc19wZW5kaW5nX2NudCk7CisJYXRvbWljX2luYygmcGVlcl9k
ZXZpY2UtPmRldmljZS0+cnNfcGVuZGluZ19jbnQpOwogfQogCi0jZGVmaW5lIGRlY19yc19wZW5k
aW5nKGRldmljZSkgKCh2b2lkKWV4cGVjdCgoZGV2aWNlKSwgX19kZWNfcnNfcGVuZGluZyhkZXZp
Y2UpID49IDApKQotc3RhdGljIGlubGluZSBpbnQgX19kZWNfcnNfcGVuZGluZyhzdHJ1Y3QgZHJi
ZF9kZXZpY2UgKmRldmljZSkKKyNkZWZpbmUgZGVjX3JzX3BlbmRpbmcocGVlcl9kZXZpY2UpIFwK
KwkoKHZvaWQpZXhwZWN0KChwZWVyX2RldmljZSksIF9fZGVjX3JzX3BlbmRpbmcocGVlcl9kZXZp
Y2UpID49IDApKQorc3RhdGljIGlubGluZSBpbnQgX19kZWNfcnNfcGVuZGluZyhzdHJ1Y3QgZHJi
ZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7Ci0JcmV0dXJuIGF0b21pY19kZWNfcmV0dXJu
KCZkZXZpY2UtPnJzX3BlbmRpbmdfY250KTsKKwlyZXR1cm4gYXRvbWljX2RlY19yZXR1cm4oJnBl
ZXJfZGV2aWNlLT5kZXZpY2UtPnJzX3BlbmRpbmdfY250KTsKIH0KIAogLyogY291bnRzIGhvdyBt
YW55IGFuc3dlcnMgd2Ugc3RpbGwgbmVlZCB0byBzZW5kIHRvIHRoZSBwZWVyLgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIuYyBiL2RyaXZlcnMvYmxvY2svZHJi
ZC9kcmJkX3JlY2VpdmVyLmMKaW5kZXggODU2YzBlM2E2NjMwLi5lNTQ0MDRjNjMyZTcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMKKysrIGIvZHJpdmVycy9i
bG9jay9kcmJkL2RyYmRfcmVjZWl2ZXIuYwpAQCAtMjA0NCwxMSArMjA0NCwxMSBAQCBzdGF0aWMg
aW50IGVfZW5kX3Jlc3luY19ibG9jayhzdHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQgdW51c2VkKQog
CURfQVNTRVJUKGRldmljZSwgZHJiZF9pbnRlcnZhbF9lbXB0eSgmcGVlcl9yZXEtPmkpKTsKIAog
CWlmIChsaWtlbHkoKHBlZXJfcmVxLT5mbGFncyAmIEVFX1dBU19FUlJPUikgPT0gMCkpIHsKLQkJ
ZHJiZF9zZXRfaW5fc3luYyhkZXZpY2UsIHNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CisJCWRy
YmRfc2V0X2luX3N5bmMocGVlcl9kZXZpY2UsIHNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CiAJ
CWVyciA9IGRyYmRfc2VuZF9hY2socGVlcl9kZXZpY2UsIFBfUlNfV1JJVEVfQUNLLCBwZWVyX3Jl
cSk7CiAJfSBlbHNlIHsKIAkJLyogUmVjb3JkIGZhaWx1cmUgdG8gc3luYyAqLwotCQlkcmJkX3Jz
X2ZhaWxlZF9pbyhkZXZpY2UsIHNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CisJCWRyYmRfcnNf
ZmFpbGVkX2lvKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHBlZXJfcmVxLT5pLnNpemUpOwogCiAJCWVy
ciAgPSBkcmJkX3NlbmRfYWNrKHBlZXJfZGV2aWNlLCBQX05FR19BQ0ssIHBlZXJfcmVxKTsKIAl9
CkBAIC0yMDY3LDcgKzIwNjcsNyBAQCBzdGF0aWMgaW50IHJlY3ZfcmVzeW5jX3JlYWQoc3RydWN0
IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBzZWN0b3JfdCBzZWN0bwogCWlmICghcGVl
cl9yZXEpCiAJCWdvdG8gZmFpbDsKIAotCWRlY19yc19wZW5kaW5nKGRldmljZSk7CisJZGVjX3Jz
X3BlbmRpbmcocGVlcl9kZXZpY2UpOwogCiAJaW5jX3VuYWNrZWQoZGV2aWNlKTsKIAkvKiBjb3Jy
ZXNwb25kaW5nIGRlY191bmFja2VkKCkgaW4gZV9lbmRfcmVzeW5jX2Jsb2NrKCkKQEAgLTIyMjAs
NyArMjIyMCw3IEBAIHN0YXRpYyBpbnQgZV9lbmRfYmxvY2soc3RydWN0IGRyYmRfd29yayAqdywg
aW50IGNhbmNlbCkKIAkJCQlQX1JTX1dSSVRFX0FDSyA6IFBfV1JJVEVfQUNLOwogCQkJZXJyID0g
ZHJiZF9zZW5kX2FjayhwZWVyX2RldmljZSwgcGNtZCwgcGVlcl9yZXEpOwogCQkJaWYgKHBjbWQg
PT0gUF9SU19XUklURV9BQ0spCi0JCQkJZHJiZF9zZXRfaW5fc3luYyhkZXZpY2UsIHNlY3Rvciwg
cGVlcl9yZXEtPmkuc2l6ZSk7CisJCQkJZHJiZF9zZXRfaW5fc3luYyhwZWVyX2RldmljZSwgc2Vj
dG9yLCBwZWVyX3JlcS0+aS5zaXplKTsKIAkJfSBlbHNlIHsKIAkJCWVyciA9IGRyYmRfc2VuZF9h
Y2socGVlcl9kZXZpY2UsIFBfTkVHX0FDSywgcGVlcl9yZXEpOwogCQkJLyogd2UgZXhwZWN0IGl0
IHRvIGJlIG1hcmtlZCBvdXQgb2Ygc3luYyBhbnl3YXlzLi4uCkBAIC0yNjkxLDcgKzI2OTEsNyBA
QCBzdGF0aWMgaW50IHJlY2VpdmVfRGF0YShzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0
aW9uLCBzdHJ1Y3QgcGFja2V0X2luZm8gKgogCiAJaWYgKGRldmljZS0+c3RhdGUucGRzayA8IERf
SU5DT05TSVNURU5UKSB7CiAJCS8qIEluIGNhc2Ugd2UgaGF2ZSB0aGUgb25seSBkaXNrIG9mIHRo
ZSBjbHVzdGVyLCAqLwotCQlkcmJkX3NldF9vdXRfb2Zfc3luYyhkZXZpY2UsIHBlZXJfcmVxLT5p
LnNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CisJCWRyYmRfc2V0X291dF9vZl9zeW5jKHBlZXJf
ZGV2aWNlLCBwZWVyX3JlcS0+aS5zZWN0b3IsIHBlZXJfcmVxLT5pLnNpemUpOwogCQlwZWVyX3Jl
cS0+ZmxhZ3MgJj0gfkVFX01BWV9TRVRfSU5fU1lOQzsKIAkJZHJiZF9hbF9iZWdpbl9pbyhkZXZp
Y2UsICZwZWVyX3JlcS0+aSk7CiAJCXBlZXJfcmVxLT5mbGFncyB8PSBFRV9DQUxMX0FMX0NPTVBM
RVRFX0lPOwpAQCAtMjczMCw5ICsyNzMwLDEwIEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9EYXRhKHN0
cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBwYWNrZXRfaW5mbyAqCiAg
KiBUaGUgY3VycmVudCBzeW5jIHJhdGUgdXNlZCBoZXJlIHVzZXMgb25seSB0aGUgbW9zdCByZWNl
bnQgdHdvIHN0ZXAgbWFya3MsCiAgKiB0byBoYXZlIGEgc2hvcnQgdGltZSBhdmVyYWdlIHNvIHdl
IGNhbiByZWFjdCBmYXN0ZXIuCiAgKi8KLWJvb2wgZHJiZF9yc19zaG91bGRfc2xvd19kb3duKHN0
cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBzZWN0b3JfdCBzZWN0b3IsCitib29sIGRyYmRfcnNf
c2hvdWxkX3Nsb3dfZG93bihzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UsIHNl
Y3Rvcl90IHNlY3RvciwKIAkJYm9vbCB0aHJvdHRsZV9pZl9hcHBfaXNfd2FpdGluZykKIHsKKwlz
dHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9IHBlZXJfZGV2aWNlLT5kZXZpY2U7CiAJc3RydWN0
IGxjX2VsZW1lbnQgKnRtcDsKIAlib29sIHRocm90dGxlID0gZHJiZF9yc19jX21pbl9yYXRlX3Ro
cm90dGxlKGRldmljZSk7CiAKQEAgLTI4NDQsNyArMjg0NSw3IEBAIHN0YXRpYyBpbnQgcmVjZWl2
ZV9EYXRhUmVxdWVzdChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3Qg
cGFja2V0CiAJCQlicmVhazsKIAkJY2FzZSBQX09WX1JFUExZOgogCQkJdmVyYiA9IDA7Ci0JCQlk
ZWNfcnNfcGVuZGluZyhkZXZpY2UpOworCQkJZGVjX3JzX3BlbmRpbmcocGVlcl9kZXZpY2UpOwog
CQkJZHJiZF9zZW5kX2Fja19leChwZWVyX2RldmljZSwgUF9PVl9SRVNVTFQsIHNlY3Rvciwgc2l6
ZSwgSURfSU5fU1lOQyk7CiAJCQlicmVhazsKIAkJZGVmYXVsdDoKQEAgLTI5MTUsNyArMjkxNiw3
IEBAIHN0YXRpYyBpbnQgcmVjZWl2ZV9EYXRhUmVxdWVzdChzdHJ1Y3QgZHJiZF9jb25uZWN0aW9u
ICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFja2V0CiAJCQkvKiB0cmFjayBwcm9ncmVzcywgd2UgbWF5
IG5lZWQgdG8gdGhyb3R0bGUgKi8KIAkJCWF0b21pY19hZGQoc2l6ZSA+PiA5LCAmZGV2aWNlLT5y
c19zZWN0X2luKTsKIAkJCXBlZXJfcmVxLT53LmNiID0gd19lX2VuZF9vdl9yZXBseTsKLQkJCWRl
Y19yc19wZW5kaW5nKGRldmljZSk7CisJCQlkZWNfcnNfcGVuZGluZyhwZWVyX2RldmljZSk7CiAJ
CQkvKiBkcmJkX3JzX2JlZ2luX2lvIGRvbmUgd2hlbiB3ZSBzZW50IHRoaXMgcmVxdWVzdCwKIAkJ
CSAqIGJ1dCBhY2NvdW50aW5nIHN0aWxsIG5lZWRzIHRvIGJlIGRvbmUuICovCiAJCQlnb3RvIHN1
Ym1pdF9mb3JfcmVzeW5jOwpAQCAtMjk3OCw3ICsyOTc5LDcgQEAgc3RhdGljIGludCByZWNlaXZl
X0RhdGFSZXF1ZXN0KHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0cnVjdCBw
YWNrZXQKIAogCXVwZGF0ZV9yZWNlaXZlcl90aW1pbmdfZGV0YWlscyhjb25uZWN0aW9uLCBkcmJk
X3JzX3Nob3VsZF9zbG93X2Rvd24pOwogCWlmIChkZXZpY2UtPnN0YXRlLnBlZXIgIT0gUl9QUklN
QVJZCi0JJiYgZHJiZF9yc19zaG91bGRfc2xvd19kb3duKGRldmljZSwgc2VjdG9yLCBmYWxzZSkp
CisJJiYgZHJiZF9yc19zaG91bGRfc2xvd19kb3duKHBlZXJfZGV2aWNlLCBzZWN0b3IsIGZhbHNl
KSkKIAkJc2NoZWR1bGVfdGltZW91dF91bmludGVycnVwdGlibGUoSFovMTApOwogCXVwZGF0ZV9y
ZWNlaXZlcl90aW1pbmdfZGV0YWlscyhjb25uZWN0aW9uLCBkcmJkX3JzX2JlZ2luX2lvKTsKIAlp
ZiAoZHJiZF9yc19iZWdpbl9pbyhkZXZpY2UsIHNlY3RvcikpCkBAIC00NDUwLDcgKzQ0NTEsNyBA
QCBzdGF0aWMgaW50IHJlY2VpdmVfc3RhdGUoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVj
dGlvbiwgc3RydWN0IHBhY2tldF9pbmZvCiAJCWVsc2UgaWYgKG9zLmNvbm4gPj0gQ19TWU5DX1NP
VVJDRSAmJgogCQkJIHBlZXJfc3RhdGUuY29ubiA9PSBDX0NPTk5FQ1RFRCkgewogCQkJaWYgKGRy
YmRfYm1fdG90YWxfd2VpZ2h0KGRldmljZSkgPD0gZGV2aWNlLT5yc19mYWlsZWQpCi0JCQkJZHJi
ZF9yZXN5bmNfZmluaXNoZWQoZGV2aWNlKTsKKwkJCQlkcmJkX3Jlc3luY19maW5pc2hlZChwZWVy
X2RldmljZSk7CiAJCQlyZXR1cm4gMDsKIAkJfQogCX0KQEAgLTQ0NTgsOCArNDQ1OSw4IEBAIHN0
YXRpYyBpbnQgcmVjZWl2ZV9zdGF0ZShzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9u
LCBzdHJ1Y3QgcGFja2V0X2luZm8KIAkvKiBleHBsaWNpdCB2ZXJpZnkgZmluaXNoZWQgbm90aWZp
Y2F0aW9uLCBzdG9wIHNlY3RvciByZWFjaGVkLiAqLwogCWlmIChvcy5jb25uID09IENfVkVSSUZZ
X1QgJiYgb3MuZGlzayA9PSBEX1VQX1RPX0RBVEUgJiYKIAkgICAgcGVlcl9zdGF0ZS5jb25uID09
IENfQ09OTkVDVEVEICYmIHJlYWxfcGVlcl9kaXNrID09IERfVVBfVE9fREFURSkgewotCQlvdl9v
dXRfb2Zfc3luY19wcmludChkZXZpY2UpOwotCQlkcmJkX3Jlc3luY19maW5pc2hlZChkZXZpY2Up
OworCQlvdl9vdXRfb2Zfc3luY19wcmludChwZWVyX2RldmljZSk7CisJCWRyYmRfcmVzeW5jX2Zp
bmlzaGVkKHBlZXJfZGV2aWNlKTsKIAkJcmV0dXJuIDA7CiAJfQogCkBAIC00OTM3LDcgKzQ5Mzgs
NyBAQCBzdGF0aWMgaW50IHJlY2VpdmVfb3V0X29mX3N5bmMoc3RydWN0IGRyYmRfY29ubmVjdGlv
biAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldAogCQkJCWRyYmRfY29ubl9zdHIoZGV2aWNlLT5z
dGF0ZS5jb25uKSk7CiAJfQogCi0JZHJiZF9zZXRfb3V0X29mX3N5bmMoZGV2aWNlLCBiZTY0X3Rv
X2NwdShwLT5zZWN0b3IpLCBiZTMyX3RvX2NwdShwLT5ibGtzaXplKSk7CisJZHJiZF9zZXRfb3V0
X29mX3N5bmMocGVlcl9kZXZpY2UsIGJlNjRfdG9fY3B1KHAtPnNlY3RvciksIGJlMzJfdG9fY3B1
KHAtPmJsa3NpemUpKTsKIAogCXJldHVybiAwOwogfQpAQCAtNDk1OCw3ICs0OTU5LDcgQEAgc3Rh
dGljIGludCByZWNlaXZlX3JzX2RlYWxsb2NhdGVkKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNv
bm5lY3Rpb24sIHN0cnVjdCBwYWMKIAlzZWN0b3IgPSBiZTY0X3RvX2NwdShwLT5zZWN0b3IpOwog
CXNpemUgPSBiZTMyX3RvX2NwdShwLT5ibGtzaXplKTsKIAotCWRlY19yc19wZW5kaW5nKGRldmlj
ZSk7CisJZGVjX3JzX3BlbmRpbmcocGVlcl9kZXZpY2UpOwogCiAJaWYgKGdldF9sZGV2KGRldmlj
ZSkpIHsKIAkJc3RydWN0IGRyYmRfcGVlcl9yZXF1ZXN0ICpwZWVyX3JlcTsKQEAgLTU2NTAsMTIg
KzU2NTEsMTIgQEAgc3RhdGljIGludCBnb3RfSXNJblN5bmMoc3RydWN0IGRyYmRfY29ubmVjdGlv
biAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAogCWlmIChnZXRfbGRldihkZXZp
Y2UpKSB7CiAJCWRyYmRfcnNfY29tcGxldGVfaW8oZGV2aWNlLCBzZWN0b3IpOwotCQlkcmJkX3Nl
dF9pbl9zeW5jKGRldmljZSwgc2VjdG9yLCBibGtzaXplKTsKKwkJZHJiZF9zZXRfaW5fc3luYyhw
ZWVyX2RldmljZSwgc2VjdG9yLCBibGtzaXplKTsKIAkJLyogcnNfc2FtZV9jc3VtcyBpcyBzdXBw
b3NlZCB0byBjb3VudCBpbiB1bml0cyBvZiBCTV9CTE9DS19TSVpFICovCiAJCWRldmljZS0+cnNf
c2FtZV9jc3VtICs9IChibGtzaXplID4+IEJNX0JMT0NLX1NISUZUKTsKIAkJcHV0X2xkZXYoZGV2
aWNlKTsKIAl9Ci0JZGVjX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwlkZWNfcnNfcGVuZGluZyhwZWVy
X2RldmljZSk7CiAJYXRvbWljX2FkZChibGtzaXplID4+IDksICZkZXZpY2UtPnJzX3NlY3RfaW4p
OwogCiAJcmV0dXJuIDA7CkBAIC01NzAxLDggKzU3MDIsOCBAQCBzdGF0aWMgaW50IGdvdF9CbG9j
a0FjayhzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25uZWN0aW9uLCBzdHJ1Y3QgcGFja2V0X2lu
Zm8gKgogCXVwZGF0ZV9wZWVyX3NlcShwZWVyX2RldmljZSwgYmUzMl90b19jcHUocC0+c2VxX251
bSkpOwogCiAJaWYgKHAtPmJsb2NrX2lkID09IElEX1NZTkNFUikgewotCQlkcmJkX3NldF9pbl9z
eW5jKGRldmljZSwgc2VjdG9yLCBibGtzaXplKTsKLQkJZGVjX3JzX3BlbmRpbmcoZGV2aWNlKTsK
KwkJZHJiZF9zZXRfaW5fc3luYyhwZWVyX2RldmljZSwgc2VjdG9yLCBibGtzaXplKTsKKwkJZGVj
X3JzX3BlbmRpbmcocGVlcl9kZXZpY2UpOwogCQlyZXR1cm4gMDsKIAl9CiAJc3dpdGNoIChwaS0+
Y21kKSB7CkBAIC01NzQ3LDggKzU3NDgsOCBAQCBzdGF0aWMgaW50IGdvdF9OZWdBY2soc3RydWN0
IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICpwaQogCXVw
ZGF0ZV9wZWVyX3NlcShwZWVyX2RldmljZSwgYmUzMl90b19jcHUocC0+c2VxX251bSkpOwogCiAJ
aWYgKHAtPmJsb2NrX2lkID09IElEX1NZTkNFUikgewotCQlkZWNfcnNfcGVuZGluZyhkZXZpY2Up
OwotCQlkcmJkX3JzX2ZhaWxlZF9pbyhkZXZpY2UsIHNlY3Rvciwgc2l6ZSk7CisJCWRlY19yc19w
ZW5kaW5nKHBlZXJfZGV2aWNlKTsKKwkJZHJiZF9yc19mYWlsZWRfaW8ocGVlcl9kZXZpY2UsIHNl
Y3Rvciwgc2l6ZSk7CiAJCXJldHVybiAwOwogCX0KIApAQCAtNTc2MSw3ICs1NzYyLDcgQEAgc3Rh
dGljIGludCBnb3RfTmVnQWNrKHN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24sIHN0
cnVjdCBwYWNrZXRfaW5mbyAqcGkKIAkJICAgcmVxdWVzdCBpcyBubyBsb25nZXIgaW4gdGhlIGNv
bGxpc2lvbiBoYXNoLiAqLwogCQkvKiBJbiBQcm90b2NvbCBCIHdlIG1pZ2h0IGFscmVhZHkgaGF2
ZSBnb3QgYSBQX1JFQ1ZfQUNLCiAJCSAgIGJ1dCB0aGVuIGdldCBhIFBfTkVHX0FDSyBhZnRlcndh
cmRzLiAqLwotCQlkcmJkX3NldF9vdXRfb2Zfc3luYyhkZXZpY2UsIHNlY3Rvciwgc2l6ZSk7CisJ
CWRyYmRfc2V0X291dF9vZl9zeW5jKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHNpemUpOwogCX0KIAly
ZXR1cm4gMDsKIH0KQEAgLTU4MDYsMTMgKzU4MDcsMTMgQEAgc3RhdGljIGludCBnb3RfTmVnUlNE
UmVwbHkoc3RydWN0IGRyYmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9p
bmYKIAogCXVwZGF0ZV9wZWVyX3NlcShwZWVyX2RldmljZSwgYmUzMl90b19jcHUocC0+c2VxX251
bSkpOwogCi0JZGVjX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwlkZWNfcnNfcGVuZGluZyhwZWVyX2Rl
dmljZSk7CiAKIAlpZiAoZ2V0X2xkZXZfaWZfc3RhdGUoZGV2aWNlLCBEX0ZBSUxFRCkpIHsKIAkJ
ZHJiZF9yc19jb21wbGV0ZV9pbyhkZXZpY2UsIHNlY3Rvcik7CiAJCXN3aXRjaCAocGktPmNtZCkg
ewogCQljYXNlIFBfTkVHX1JTX0RSRVBMWToKLQkJCWRyYmRfcnNfZmFpbGVkX2lvKGRldmljZSwg
c2VjdG9yLCBzaXplKTsKKwkJCWRyYmRfcnNfZmFpbGVkX2lvKHBlZXJfZGV2aWNlLCBzZWN0b3Is
IHNpemUpOwogCQkJYnJlYWs7CiAJCWNhc2UgUF9SU19DQU5DRUw6CiAJCQlicmVhazsKQEAgLTU4
NjksMjEgKzU4NzAsMjEgQEAgc3RhdGljIGludCBnb3RfT1ZSZXN1bHQoc3RydWN0IGRyYmRfY29u
bmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAl1cGRhdGVfcGVlcl9z
ZXEocGVlcl9kZXZpY2UsIGJlMzJfdG9fY3B1KHAtPnNlcV9udW0pKTsKIAogCWlmIChiZTY0X3Rv
X2NwdShwLT5ibG9ja19pZCkgPT0gSURfT1VUX09GX1NZTkMpCi0JCWRyYmRfb3Zfb3V0X29mX3N5
bmNfZm91bmQoZGV2aWNlLCBzZWN0b3IsIHNpemUpOworCQlkcmJkX292X291dF9vZl9zeW5jX2Zv
dW5kKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHNpemUpOwogCWVsc2UKLQkJb3Zfb3V0X29mX3N5bmNf
cHJpbnQoZGV2aWNlKTsKKwkJb3Zfb3V0X29mX3N5bmNfcHJpbnQocGVlcl9kZXZpY2UpOwogCiAJ
aWYgKCFnZXRfbGRldihkZXZpY2UpKQogCQlyZXR1cm4gMDsKIAogCWRyYmRfcnNfY29tcGxldGVf
aW8oZGV2aWNlLCBzZWN0b3IpOwotCWRlY19yc19wZW5kaW5nKGRldmljZSk7CisJZGVjX3JzX3Bl
bmRpbmcocGVlcl9kZXZpY2UpOwogCiAJLS1kZXZpY2UtPm92X2xlZnQ7CiAKIAkvKiBsZXQncyBh
ZHZhbmNlIHByb2dyZXNzIHN0ZXAgbWFya3Mgb25seSBmb3IgZXZlcnkgb3RoZXIgbWVnYWJ5dGUg
Ki8KIAlpZiAoKGRldmljZS0+b3ZfbGVmdCAmIDB4MjAwKSA9PSAweDIwMCkKLQkJZHJiZF9hZHZh
bmNlX3JzX21hcmtzKGRldmljZSwgZGV2aWNlLT5vdl9sZWZ0KTsKKwkJZHJiZF9hZHZhbmNlX3Jz
X21hcmtzKHBlZXJfZGV2aWNlLCBkZXZpY2UtPm92X2xlZnQpOwogCiAJaWYgKGRldmljZS0+b3Zf
bGVmdCA9PSAwKSB7CiAJCWR3ID0ga21hbGxvYyhzaXplb2YoKmR3KSwgR0ZQX05PSU8pOwpAQCAt
NTg5Myw4ICs1ODk0LDggQEAgc3RhdGljIGludCBnb3RfT1ZSZXN1bHQoc3RydWN0IGRyYmRfY29u
bmVjdGlvbiAqY29ubmVjdGlvbiwgc3RydWN0IHBhY2tldF9pbmZvICoKIAkJCWRyYmRfcXVldWVf
d29yaygmcGVlcl9kZXZpY2UtPmNvbm5lY3Rpb24tPnNlbmRlcl93b3JrLCAmZHctPncpOwogCQl9
IGVsc2UgewogCQkJZHJiZF9lcnIoZGV2aWNlLCAia21hbGxvYyhkdykgZmFpbGVkLiIpOwotCQkJ
b3Zfb3V0X29mX3N5bmNfcHJpbnQoZGV2aWNlKTsKLQkJCWRyYmRfcmVzeW5jX2ZpbmlzaGVkKGRl
dmljZSk7CisJCQlvdl9vdXRfb2Zfc3luY19wcmludChwZWVyX2RldmljZSk7CisJCQlkcmJkX3Jl
c3luY19maW5pc2hlZChwZWVyX2RldmljZSk7CiAJCX0KIAl9CiAJcHV0X2xkZXYoZGV2aWNlKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlcS5jIGIvZHJpdmVycy9ibG9j
ay9kcmJkL2RyYmRfcmVxLmMKaW5kZXggNTI4ZjI5ZWJmMzY5Li4zODBlNjU4NGE0ZWUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlcS5jCisrKyBiL2RyaXZlcnMvYmxvY2sv
ZHJiZC9kcmJkX3JlcS5jCkBAIC0xMjIsMTIgKzEyMiwxMyBAQCB2b2lkIGRyYmRfcmVxX2Rlc3Ry
b3koc3RydWN0IGtyZWYgKmtyZWYpCiAJCSAqIGJlZm9yZSBpdCBldmVuIHdhcyBzdWJtaXR0ZWQg
b3Igc2VudC4KIAkJICogSW4gdGhhdCBjYXNlIHdlIGRvIG5vdCB3YW50IHRvIHRvdWNoIHRoZSBi
aXRtYXAgYXQgYWxsLgogCQkgKi8KKwkJc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2
aWNlID0gZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKTsKIAkJaWYgKChzICYgKFJRX1BPU1RQT05F
RHxSUV9MT0NBTF9NQVNLfFJRX05FVF9NQVNLKSkgIT0gUlFfUE9TVFBPTkVEKSB7CiAJCQlpZiAo
IShzICYgUlFfTkVUX09LKSB8fCAhKHMgJiBSUV9MT0NBTF9PSykpCi0JCQkJZHJiZF9zZXRfb3V0
X29mX3N5bmMoZGV2aWNlLCByZXEtPmkuc2VjdG9yLCByZXEtPmkuc2l6ZSk7CisJCQkJZHJiZF9z
ZXRfb3V0X29mX3N5bmMocGVlcl9kZXZpY2UsIHJlcS0+aS5zZWN0b3IsIHJlcS0+aS5zaXplKTsK
IAogCQkJaWYgKChzICYgUlFfTkVUX09LKSAmJiAocyAmIFJRX0xPQ0FMX09LKSAmJiAocyAmIFJR
X05FVF9TSVMpKQotCQkJCWRyYmRfc2V0X2luX3N5bmMoZGV2aWNlLCByZXEtPmkuc2VjdG9yLCBy
ZXEtPmkuc2l6ZSk7CisJCQkJZHJiZF9zZXRfaW5fc3luYyhwZWVyX2RldmljZSwgcmVxLT5pLnNl
Y3RvciwgcmVxLT5pLnNpemUpOwogCQl9CiAKIAkJLyogb25lIG1pZ2h0IGJlIHRlbXB0ZWQgdG8g
bW92ZSB0aGUgZHJiZF9hbF9jb21wbGV0ZV9pbwpAQCAtNjIwLDcgKzYyMSw3IEBAIGludCBfX3Jl
cV9tb2Qoc3RydWN0IGRyYmRfcmVxdWVzdCAqcmVxLCBlbnVtIGRyYmRfcmVxX2V2ZW50IHdoYXQs
CiAJCWJyZWFrOwogCiAJY2FzZSBSRUFEX0NPTVBMRVRFRF9XSVRIX0VSUk9SOgotCQlkcmJkX3Nl
dF9vdXRfb2Zfc3luYyhkZXZpY2UsIHJlcS0+aS5zZWN0b3IsIHJlcS0+aS5zaXplKTsKKwkJZHJi
ZF9zZXRfb3V0X29mX3N5bmMocGVlcl9kZXZpY2UsIHJlcS0+aS5zZWN0b3IsIHJlcS0+aS5zaXpl
KTsKIAkJZHJiZF9yZXBvcnRfaW9fZXJyb3IoZGV2aWNlLCByZXEpOwogCQlfX2RyYmRfY2hrX2lv
X2Vycm9yKGRldmljZSwgRFJCRF9SRUFEX0VSUk9SKTsKIAkJZmFsbHRocm91Z2g7CkBAIC0xMTMx
LDcgKzExMzIsNyBAQCBzdGF0aWMgaW50IGRyYmRfcHJvY2Vzc193cml0ZV9yZXF1ZXN0KHN0cnVj
dCBkcmJkX3JlcXVlc3QgKnJlcSkKIAlpZiAocmVtb3RlKSB7CiAJCV9yZXFfbW9kKHJlcSwgVE9f
QkVfU0VOVCwgcGVlcl9kZXZpY2UpOwogCQlfcmVxX21vZChyZXEsIFFVRVVFX0ZPUl9ORVRfV1JJ
VEUsIHBlZXJfZGV2aWNlKTsKLQl9IGVsc2UgaWYgKGRyYmRfc2V0X291dF9vZl9zeW5jKGRldmlj
ZSwgcmVxLT5pLnNlY3RvciwgcmVxLT5pLnNpemUpKQorCX0gZWxzZSBpZiAoZHJiZF9zZXRfb3V0
X29mX3N5bmMocGVlcl9kZXZpY2UsIHJlcS0+aS5zZWN0b3IsIHJlcS0+aS5zaXplKSkKIAkJX3Jl
cV9tb2QocmVxLCBRVUVVRV9GT1JfU0VORF9PT1MsIHBlZXJfZGV2aWNlKTsKIAogCXJldHVybiBy
ZW1vdGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9zdGF0ZS5jIGIvZHJp
dmVycy9ibG9jay9kcmJkL2RyYmRfc3RhdGUuYwppbmRleCBjOTJkYzYwOTNiMGEuLjU2M2U2N2Yx
ZWFkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfc3RhdGUuYworKysgYi9k
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9zdGF0ZS5jCkBAIC0xMjIyLDkgKzEyMjIsMTEgQEAgdm9p
ZCBkcmJkX3Jlc3VtZV9hbChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKIH0KIAogLyogaGVs
cGVyIGZvciBfZHJiZF9zZXRfc3RhdGUgKi8KLXN0YXRpYyB2b2lkIHNldF9vdl9wb3NpdGlvbihz
dHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgZW51bSBkcmJkX2Nvbm5zIGNzKQorc3RhdGljIHZv
aWQgc2V0X292X3Bvc2l0aW9uKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwg
ZW51bSBkcmJkX2Nvbm5zIGNzKQogewotCWlmIChmaXJzdF9wZWVyX2RldmljZShkZXZpY2UpLT5j
b25uZWN0aW9uLT5hZ3JlZWRfcHJvX3ZlcnNpb24gPCA5MCkKKwlzdHJ1Y3QgZHJiZF9kZXZpY2Ug
KmRldmljZSA9IHBlZXJfZGV2aWNlLT5kZXZpY2U7CisKKwlpZiAocGVlcl9kZXZpY2UtPmNvbm5l
Y3Rpb24tPmFncmVlZF9wcm9fdmVyc2lvbiA8IDkwKQogCQlkZXZpY2UtPm92X3N0YXJ0X3NlY3Rv
ciA9IDA7CiAJZGV2aWNlLT5yc190b3RhbCA9IGRyYmRfYm1fYml0cyhkZXZpY2UpOwogCWRldmlj
ZS0+b3ZfcG9zaXRpb24gPSAwOwpAQCAtMTM4Nyw3ICsxMzg5LDcgQEAgX2RyYmRfc2V0X3N0YXRl
KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCB1bmlvbiBkcmJkX3N0YXRlIG5zLAogCQl1bnNp
Z25lZCBsb25nIG5vdyA9IGppZmZpZXM7CiAJCWludCBpOwogCi0JCXNldF9vdl9wb3NpdGlvbihk
ZXZpY2UsIG5zLmNvbm4pOworCQlzZXRfb3ZfcG9zaXRpb24ocGVlcl9kZXZpY2UsIG5zLmNvbm4p
OwogCQlkZXZpY2UtPnJzX3N0YXJ0ID0gbm93OwogCQlkZXZpY2UtPnJzX2xhc3Rfc2VjdF9ldiA9
IDA7CiAJCWRldmljZS0+b3ZfbGFzdF9vb3Nfc2l6ZSA9IDA7CkBAIC0xMzk4LDcgKzE0MDAsNyBA
QCBfZHJiZF9zZXRfc3RhdGUoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHVuaW9uIGRyYmRf
c3RhdGUgbnMsCiAJCQlkZXZpY2UtPnJzX21hcmtfdGltZVtpXSA9IG5vdzsKIAkJfQogCi0JCWRy
YmRfcnNfY29udHJvbGxlcl9yZXNldChkZXZpY2UpOworCQlkcmJkX3JzX2NvbnRyb2xsZXJfcmVz
ZXQocGVlcl9kZXZpY2UpOwogCiAJCWlmIChucy5jb25uID09IENfVkVSSUZZX1MpIHsKIAkJCWRy
YmRfaW5mbyhkZXZpY2UsICJTdGFydGluZyBPbmxpbmUgVmVyaWZ5IGZyb20gc2VjdG9yICVsbHVc
biIsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYyBiL2RyaXZl
cnMvYmxvY2svZHJiZC9kcmJkX3dvcmtlci5jCmluZGV4IDY0NTVlZGNhN2FhOS4uNDM1MmE1MGZi
YjNmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYworKysgYi9k
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF93b3JrZXIuYwpAQCAtMjgsOCArMjgsOCBAQAogI2luY2x1
ZGUgImRyYmRfcHJvdG9jb2wuaCIKICNpbmNsdWRlICJkcmJkX3JlcS5oIgogCi1zdGF0aWMgaW50
IG1ha2Vfb3ZfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKiwgaW50KTsKLXN0YXRpYyBpbnQg
bWFrZV9yZXN5bmNfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKiwgaW50KTsKK3N0YXRpYyBp
bnQgbWFrZV9vdl9yZXF1ZXN0KHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICosIGludCk7CitzdGF0
aWMgaW50IG1ha2VfcmVzeW5jX3JlcXVlc3Qoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKiwgaW50
KTsKIAogLyogZW5kaW8gaGFuZGxlcnM6CiAgKiAgIGRyYmRfbWRfZW5kaW8gKGRlZmluZWQgaGVy
ZSkKQEAgLTEyNCw3ICsxMjQsNyBAQCB2b2lkIGRyYmRfZW5kaW9fd3JpdGVfc2VjX2ZpbmFsKHN0
cnVjdCBkcmJkX3BlZXJfcmVxdWVzdCAqcGVlcl9yZXEpIF9fcmVsZWFzZXMobAogCQkgKiBJbiBj
YXNlIG9mIGEgd3JpdGUgZXJyb3IsIHNlbmQgdGhlIG5lZyBhY2sgYW55d2F5cy4gKi8KIAkJaWYg
KCFfX3Rlc3RfYW5kX3NldF9iaXQoX19FRV9TRU5EX1dSSVRFX0FDSywgJnBlZXJfcmVxLT5mbGFn
cykpCiAJCQlpbmNfdW5hY2tlZChkZXZpY2UpOwotCQlkcmJkX3NldF9vdXRfb2Zfc3luYyhkZXZp
Y2UsIHBlZXJfcmVxLT5pLnNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CisJCWRyYmRfc2V0X291
dF9vZl9zeW5jKHBlZXJfZGV2aWNlLCBwZWVyX3JlcS0+aS5zZWN0b3IsIHBlZXJfcmVxLT5pLnNp
emUpOwogCX0KIAogCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZpY2UtPnJlc291cmNlLT5yZXFfbG9j
aywgZmxhZ3MpOwpAQCAtMzYzLDcgKzM2Myw3IEBAIHN0YXRpYyBpbnQgd19lX3NlbmRfY3N1bShz
dHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQgY2FuY2VsKQogCQkgKiBkcmJkX2FsbG9jX3BhZ2VzIGR1
ZSB0byBwcF9pbl91c2UgPiBtYXhfYnVmZmVycy4gKi8KIAkJZHJiZF9mcmVlX3BlZXJfcmVxKGRl
dmljZSwgcGVlcl9yZXEpOwogCQlwZWVyX3JlcSA9IE5VTEw7Ci0JCWluY19yc19wZW5kaW5nKGRl
dmljZSk7CisJCWluY19yc19wZW5kaW5nKHBlZXJfZGV2aWNlKTsKIAkJZXJyID0gZHJiZF9zZW5k
X2RyZXF1ZXN0X2NzdW0ocGVlcl9kZXZpY2UsIHNlY3Rvciwgc2l6ZSwKIAkJCQkJICAgICAgZGln
ZXN0LCBkaWdlc3Rfc2l6ZSwKIAkJCQkJICAgICAgUF9DU1VNX1JTX1JFUVVFU1QpOwpAQCAtNDMw
LDEwICs0MzAsMTAgQEAgaW50IHdfcmVzeW5jX3RpbWVyKHN0cnVjdCBkcmJkX3dvcmsgKncsIGlu
dCBjYW5jZWwpCiAKIAlzd2l0Y2ggKGRldmljZS0+c3RhdGUuY29ubikgewogCWNhc2UgQ19WRVJJ
RllfUzoKLQkJbWFrZV9vdl9yZXF1ZXN0KGRldmljZSwgY2FuY2VsKTsKKwkJbWFrZV9vdl9yZXF1
ZXN0KGZpcnN0X3BlZXJfZGV2aWNlKGRldmljZSksIGNhbmNlbCk7CiAJCWJyZWFrOwogCWNhc2Ug
Q19TWU5DX1RBUkdFVDoKLQkJbWFrZV9yZXN5bmNfcmVxdWVzdChkZXZpY2UsIGNhbmNlbCk7CisJ
CW1ha2VfcmVzeW5jX3JlcXVlc3QoZmlyc3RfcGVlcl9kZXZpY2UoZGV2aWNlKSwgY2FuY2VsKTsK
IAkJYnJlYWs7CiAJfQogCkBAIC00OTMsOCArNDkzLDkgQEAgc3RydWN0IGZpZm9fYnVmZmVyICpm
aWZvX2FsbG9jKHVuc2lnbmVkIGludCBmaWZvX3NpemUpCiAJcmV0dXJuIGZiOwogfQogCi1zdGF0
aWMgaW50IGRyYmRfcnNfY29udHJvbGxlcihzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgdW5z
aWduZWQgaW50IHNlY3RfaW4pCitzdGF0aWMgaW50IGRyYmRfcnNfY29udHJvbGxlcihzdHJ1Y3Qg
ZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UsIHVuc2lnbmVkIGludCBzZWN0X2luKQogewor
CXN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlID0gcGVlcl9kZXZpY2UtPmRldmljZTsKIAlzdHJ1
Y3QgZGlza19jb25mICpkYzsKIAl1bnNpZ25lZCBpbnQgd2FudDsgICAgIC8qIFRoZSBudW1iZXIg
b2Ygc2VjdG9ycyB3ZSB3YW50IGluLWZsaWdodCAqLwogCWludCByZXFfc2VjdDsgLyogTnVtYmVy
IG9mIHNlY3RvcnMgdG8gcmVxdWVzdCBpbiB0aGlzIHR1cm4gKi8KQEAgLTU0NSw4ICs1NDYsOSBA
QCBzdGF0aWMgaW50IGRyYmRfcnNfY29udHJvbGxlcihzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSwgdW5zaWduZWQgaW50IHNlY3RfaW4pCiAJcmV0dXJuIHJlcV9zZWN0OwogfQogCi1zdGF0aWMg
aW50IGRyYmRfcnNfbnVtYmVyX3JlcXVlc3RzKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQor
c3RhdGljIGludCBkcmJkX3JzX251bWJlcl9yZXF1ZXN0cyhzdHJ1Y3QgZHJiZF9wZWVyX2Rldmlj
ZSAqcGVlcl9kZXZpY2UpCiB7CisJc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBwZWVyX2Rl
dmljZS0+ZGV2aWNlOwogCXVuc2lnbmVkIGludCBzZWN0X2luOyAgLyogTnVtYmVyIG9mIHNlY3Rv
cnMgdGhhdCBjYW1lIGluIHNpbmNlIHRoZSBsYXN0IHR1cm4gKi8KIAlpbnQgbnVtYmVyLCBteGI7
CiAKQEAgLTU1Niw3ICs1NTgsNyBAQCBzdGF0aWMgaW50IGRyYmRfcnNfbnVtYmVyX3JlcXVlc3Rz
KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQogCXJjdV9yZWFkX2xvY2soKTsKIAlteGIgPSBk
cmJkX2dldF9tYXhfYnVmZmVycyhkZXZpY2UpIC8gMjsKIAlpZiAocmN1X2RlcmVmZXJlbmNlKGRl
dmljZS0+cnNfcGxhbl9zKS0+c2l6ZSkgewotCQludW1iZXIgPSBkcmJkX3JzX2NvbnRyb2xsZXIo
ZGV2aWNlLCBzZWN0X2luKSA+PiAoQk1fQkxPQ0tfU0hJRlQgLSA5KTsKKwkJbnVtYmVyID0gZHJi
ZF9yc19jb250cm9sbGVyKHBlZXJfZGV2aWNlLCBzZWN0X2luKSA+PiAoQk1fQkxPQ0tfU0hJRlQg
LSA5KTsKIAkJZGV2aWNlLT5jX3N5bmNfcmF0ZSA9IG51bWJlciAqIEhaICogKEJNX0JMT0NLX1NJ
WkUgLyAxMDI0KSAvIFNMRUVQX1RJTUU7CiAJfSBlbHNlIHsKIAkJZGV2aWNlLT5jX3N5bmNfcmF0
ZSA9IHJjdV9kZXJlZmVyZW5jZShkZXZpY2UtPmxkZXYtPmRpc2tfY29uZiktPnJlc3luY19yYXRl
OwpAQCAtNTgwLDkgKzU4Miw5IEBAIHN0YXRpYyBpbnQgZHJiZF9yc19udW1iZXJfcmVxdWVzdHMo
c3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCiAJcmV0dXJuIG51bWJlcjsKIH0KIAotc3RhdGlj
IGludCBtYWtlX3Jlc3luY19yZXF1ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqY29uc3QgZGV2aWNl
LCBpbnQgY2FuY2VsKQorc3RhdGljIGludCBtYWtlX3Jlc3luY19yZXF1ZXN0KHN0cnVjdCBkcmJk
X3BlZXJfZGV2aWNlICpjb25zdCBwZWVyX2RldmljZSwgaW50IGNhbmNlbCkKIHsKLQlzdHJ1Y3Qg
ZHJiZF9wZWVyX2RldmljZSAqY29uc3QgcGVlcl9kZXZpY2UgPSBmaXJzdF9wZWVyX2RldmljZShk
ZXZpY2UpOworCXN0cnVjdCBkcmJkX2RldmljZSAqY29uc3QgZGV2aWNlID0gcGVlcl9kZXZpY2Ut
PmRldmljZTsKIAlzdHJ1Y3QgZHJiZF9jb25uZWN0aW9uICpjb25zdCBjb25uZWN0aW9uID0gcGVl
cl9kZXZpY2UgPyBwZWVyX2RldmljZS0+Y29ubmVjdGlvbiA6IE5VTEw7CiAJdW5zaWduZWQgbG9u
ZyBiaXQ7CiAJc2VjdG9yX3Qgc2VjdG9yOwpAQCAtNTk4LDcgKzYwMCw3IEBAIHN0YXRpYyBpbnQg
bWFrZV9yZXN5bmNfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmNvbnN0IGRldmljZSwgaW50
IGNhbmNlbCkKIAogCWlmIChkZXZpY2UtPnJzX3RvdGFsID09IDApIHsKIAkJLyogZW1wdHkgcmVz
eW5jPyAqLwotCQlkcmJkX3Jlc3luY19maW5pc2hlZChkZXZpY2UpOworCQlkcmJkX3Jlc3luY19m
aW5pc2hlZChwZWVyX2RldmljZSk7CiAJCXJldHVybiAwOwogCX0KIApAQCAtNjE4LDcgKzYyMCw3
IEBAIHN0YXRpYyBpbnQgbWFrZV9yZXN5bmNfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmNv
bnN0IGRldmljZSwgaW50IGNhbmNlbCkKIAl9CiAKIAltYXhfYmlvX3NpemUgPSBxdWV1ZV9tYXhf
aHdfc2VjdG9ycyhkZXZpY2UtPnJxX3F1ZXVlKSA8PCA5OwotCW51bWJlciA9IGRyYmRfcnNfbnVt
YmVyX3JlcXVlc3RzKGRldmljZSk7CisJbnVtYmVyID0gZHJiZF9yc19udW1iZXJfcmVxdWVzdHMo
cGVlcl9kZXZpY2UpOwogCWlmIChudW1iZXIgPD0gMCkKIAkJZ290byByZXF1ZXVlOwogCkBAIC02
NTMsNyArNjU1LDcgQEAgc3RhdGljIGludCBtYWtlX3Jlc3luY19yZXF1ZXN0KHN0cnVjdCBkcmJk
X2RldmljZSAqY29uc3QgZGV2aWNlLCBpbnQgY2FuY2VsKQogCiAJCXNlY3RvciA9IEJNX0JJVF9U
T19TRUNUKGJpdCk7CiAKLQkJaWYgKGRyYmRfdHJ5X3JzX2JlZ2luX2lvKGRldmljZSwgc2VjdG9y
KSkgeworCQlpZiAoZHJiZF90cnlfcnNfYmVnaW5faW8ocGVlcl9kZXZpY2UsIHNlY3RvcikpIHsK
IAkJCWRldmljZS0+Ym1fcmVzeW5jX2ZvID0gYml0OwogCQkJZ290byByZXF1ZXVlOwogCQl9CkBA
IC03MjksMTMgKzczMSwxMyBAQCBzdGF0aWMgaW50IG1ha2VfcmVzeW5jX3JlcXVlc3Qoc3RydWN0
IGRyYmRfZGV2aWNlICpjb25zdCBkZXZpY2UsIGludCBjYW5jZWwpCiAJCX0gZWxzZSB7CiAJCQlp
bnQgZXJyOwogCi0JCQlpbmNfcnNfcGVuZGluZyhkZXZpY2UpOworCQkJaW5jX3JzX3BlbmRpbmco
cGVlcl9kZXZpY2UpOwogCQkJZXJyID0gZHJiZF9zZW5kX2RyZXF1ZXN0KHBlZXJfZGV2aWNlLAog
CQkJCQkJIHNpemUgPT0gZGlzY2FyZF9ncmFudWxhcml0eSA/IFBfUlNfVEhJTl9SRVEgOiBQX1JT
X0RBVEFfUkVRVUVTVCwKIAkJCQkJCSBzZWN0b3IsIHNpemUsIElEX1NZTkNFUik7CiAJCQlpZiAo
ZXJyKSB7CiAJCQkJZHJiZF9lcnIoZGV2aWNlLCAiZHJiZF9zZW5kX2RyZXF1ZXN0KCkgZmFpbGVk
LCBhYm9ydGluZy4uLlxuIik7Ci0JCQkJZGVjX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwkJCQlkZWNf
cnNfcGVuZGluZyhwZWVyX2RldmljZSk7CiAJCQkJcHV0X2xkZXYoZGV2aWNlKTsKIAkJCQlyZXR1
cm4gZXJyOwogCQkJfQpAQCAtNzYwLDggKzc2Miw5IEBAIHN0YXRpYyBpbnQgbWFrZV9yZXN5bmNf
cmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmNvbnN0IGRldmljZSwgaW50IGNhbmNlbCkKIAly
ZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBtYWtlX292X3JlcXVlc3Qoc3RydWN0IGRyYmRfZGV2
aWNlICpkZXZpY2UsIGludCBjYW5jZWwpCitzdGF0aWMgaW50IG1ha2Vfb3ZfcmVxdWVzdChzdHJ1
Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UsIGludCBjYW5jZWwpCiB7CisJc3RydWN0
IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBwZWVyX2RldmljZS0+ZGV2aWNlOwogCWludCBudW1iZXIs
IGksIHNpemU7CiAJc2VjdG9yX3Qgc2VjdG9yOwogCWNvbnN0IHNlY3Rvcl90IGNhcGFjaXR5ID0g
Z2V0X2NhcGFjaXR5KGRldmljZS0+dmRpc2spOwpAQCAtNzcwLDcgKzc3Myw3IEBAIHN0YXRpYyBp
bnQgbWFrZV9vdl9yZXF1ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQgY2FuY2Vs
KQogCWlmICh1bmxpa2VseShjYW5jZWwpKQogCQlyZXR1cm4gMTsKIAotCW51bWJlciA9IGRyYmRf
cnNfbnVtYmVyX3JlcXVlc3RzKGRldmljZSk7CisJbnVtYmVyID0gZHJiZF9yc19udW1iZXJfcmVx
dWVzdHMocGVlcl9kZXZpY2UpOwogCiAJc2VjdG9yID0gZGV2aWNlLT5vdl9wb3NpdGlvbjsKIAlm
b3IgKGkgPSAwOyBpIDwgbnVtYmVyOyBpKyspIHsKQEAgLTc4OCw3ICs3OTEsNyBAQCBzdGF0aWMg
aW50IG1ha2Vfb3ZfcmVxdWVzdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgaW50IGNhbmNl
bCkKIAogCQlzaXplID0gQk1fQkxPQ0tfU0laRTsKIAotCQlpZiAoZHJiZF90cnlfcnNfYmVnaW5f
aW8oZGV2aWNlLCBzZWN0b3IpKSB7CisJCWlmIChkcmJkX3RyeV9yc19iZWdpbl9pbyhwZWVyX2Rl
dmljZSwgc2VjdG9yKSkgewogCQkJZGV2aWNlLT5vdl9wb3NpdGlvbiA9IHNlY3RvcjsKIAkJCWdv
dG8gcmVxdWV1ZTsKIAkJfQpAQCAtNzk2LDkgKzc5OSw5IEBAIHN0YXRpYyBpbnQgbWFrZV9vdl9y
ZXF1ZXN0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLCBpbnQgY2FuY2VsKQogCQlpZiAoc2Vj
dG9yICsgKHNpemU+PjkpID4gY2FwYWNpdHkpCiAJCQlzaXplID0gKGNhcGFjaXR5LXNlY3Rvcik8
PDk7CiAKLQkJaW5jX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwkJaW5jX3JzX3BlbmRpbmcocGVlcl9k
ZXZpY2UpOwogCQlpZiAoZHJiZF9zZW5kX292X3JlcXVlc3QoZmlyc3RfcGVlcl9kZXZpY2UoZGV2
aWNlKSwgc2VjdG9yLCBzaXplKSkgewotCQkJZGVjX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwkJCWRl
Y19yc19wZW5kaW5nKHBlZXJfZGV2aWNlKTsKIAkJCXJldHVybiAwOwogCQl9CiAJCXNlY3RvciAr
PSBCTV9TRUNUX1BFUl9CSVQ7CkBAIC04MTgsOCArODIxLDggQEAgaW50IHdfb3ZfZmluaXNoZWQo
c3RydWN0IGRyYmRfd29yayAqdywgaW50IGNhbmNlbCkKIAkJY29udGFpbmVyX29mKHcsIHN0cnVj
dCBkcmJkX2RldmljZV93b3JrLCB3KTsKIAlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9IGR3
LT5kZXZpY2U7CiAJa2ZyZWUoZHcpOwotCW92X291dF9vZl9zeW5jX3ByaW50KGRldmljZSk7Ci0J
ZHJiZF9yZXN5bmNfZmluaXNoZWQoZGV2aWNlKTsKKwlvdl9vdXRfb2Zfc3luY19wcmludChmaXJz
dF9wZWVyX2RldmljZShkZXZpY2UpKTsKKwlkcmJkX3Jlc3luY19maW5pc2hlZChmaXJzdF9wZWVy
X2RldmljZShkZXZpY2UpKTsKIAogCXJldHVybiAwOwogfQpAQCAtODMxLDcgKzgzNCw3IEBAIHN0
YXRpYyBpbnQgd19yZXN5bmNfZmluaXNoZWQoc3RydWN0IGRyYmRfd29yayAqdywgaW50IGNhbmNl
bCkKIAlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSA9IGR3LT5kZXZpY2U7CiAJa2ZyZWUoZHcp
OwogCi0JZHJiZF9yZXN5bmNfZmluaXNoZWQoZGV2aWNlKTsKKwlkcmJkX3Jlc3luY19maW5pc2hl
ZChmaXJzdF9wZWVyX2RldmljZShkZXZpY2UpKTsKIAogCXJldHVybiAwOwogfQpAQCAtODQ2LDkg
Kzg0OSwxMCBAQCBzdGF0aWMgdm9pZCBwaW5nX3BlZXIoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZp
Y2UpCiAJCSAgIHRlc3RfYml0KEdPVF9QSU5HX0FDSywgJmNvbm5lY3Rpb24tPmZsYWdzKSB8fCBk
ZXZpY2UtPnN0YXRlLmNvbm4gPCBDX0NPTk5FQ1RFRCk7CiB9CiAKLWludCBkcmJkX3Jlc3luY19m
aW5pc2hlZChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKK2ludCBkcmJkX3Jlc3luY19maW5p
c2hlZChzdHJ1Y3QgZHJiZF9wZWVyX2RldmljZSAqcGVlcl9kZXZpY2UpCiB7Ci0Jc3RydWN0IGRy
YmRfY29ubmVjdGlvbiAqY29ubmVjdGlvbiA9IGZpcnN0X3BlZXJfZGV2aWNlKGRldmljZSktPmNv
bm5lY3Rpb247CisJc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UgPSBwZWVyX2RldmljZS0+ZGV2
aWNlOworCXN0cnVjdCBkcmJkX2Nvbm5lY3Rpb24gKmNvbm5lY3Rpb24gPSBwZWVyX2RldmljZS0+
Y29ubmVjdGlvbjsKIAl1bnNpZ25lZCBsb25nIGRiLCBkdCwgZGJkdDsKIAl1bnNpZ25lZCBsb25n
IG5fb29zOwogCXVuaW9uIGRyYmRfc3RhdGUgb3MsIG5zOwpAQCAtMTEyOSw3ICsxMTMzLDcgQEAg
aW50IHdfZV9lbmRfcnNkYXRhX3JlcShzdHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQgY2FuY2VsKQog
CQllcnIgPSBkcmJkX3NlbmRfYWNrKHBlZXJfZGV2aWNlLCBQX1JTX0NBTkNFTCwgcGVlcl9yZXEp
OwogCX0gZWxzZSBpZiAobGlrZWx5KChwZWVyX3JlcS0+ZmxhZ3MgJiBFRV9XQVNfRVJST1IpID09
IDApKSB7CiAJCWlmIChsaWtlbHkoZGV2aWNlLT5zdGF0ZS5wZHNrID49IERfSU5DT05TSVNURU5U
KSkgewotCQkJaW5jX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwkJCWluY19yc19wZW5kaW5nKHBlZXJf
ZGV2aWNlKTsKIAkJCWlmIChwZWVyX3JlcS0+ZmxhZ3MgJiBFRV9SU19USElOX1JFUSAmJiBhbGxf
emVybyhwZWVyX3JlcSkpCiAJCQkJZXJyID0gZHJiZF9zZW5kX3JzX2RlYWxsb2NhdGVkKHBlZXJf
ZGV2aWNlLCBwZWVyX3JlcSk7CiAJCQllbHNlCkBAIC0xMTQ4LDcgKzExNTIsNyBAQCBpbnQgd19l
X2VuZF9yc2RhdGFfcmVxKHN0cnVjdCBkcmJkX3dvcmsgKncsIGludCBjYW5jZWwpCiAJCWVyciA9
IGRyYmRfc2VuZF9hY2socGVlcl9kZXZpY2UsIFBfTkVHX1JTX0RSRVBMWSwgcGVlcl9yZXEpOwog
CiAJCS8qIHVwZGF0ZSByZXN5bmMgZGF0YSB3aXRoIGZhaWx1cmUgKi8KLQkJZHJiZF9yc19mYWls
ZWRfaW8oZGV2aWNlLCBwZWVyX3JlcS0+aS5zZWN0b3IsIHBlZXJfcmVxLT5pLnNpemUpOworCQlk
cmJkX3JzX2ZhaWxlZF9pbyhwZWVyX2RldmljZSwgcGVlcl9yZXEtPmkuc2VjdG9yLCBwZWVyX3Jl
cS0+aS5zaXplKTsKIAl9CiAKIAlkZWNfdW5hY2tlZChkZXZpY2UpOwpAQCAtMTE5OSwxMiArMTIw
MywxMiBAQCBpbnQgd19lX2VuZF9jc3VtX3JzX3JlcShzdHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQg
Y2FuY2VsKQogCQl9CiAKIAkJaWYgKGVxKSB7Ci0JCQlkcmJkX3NldF9pbl9zeW5jKGRldmljZSwg
cGVlcl9yZXEtPmkuc2VjdG9yLCBwZWVyX3JlcS0+aS5zaXplKTsKKwkJCWRyYmRfc2V0X2luX3N5
bmMocGVlcl9kZXZpY2UsIHBlZXJfcmVxLT5pLnNlY3RvciwgcGVlcl9yZXEtPmkuc2l6ZSk7CiAJ
CQkvKiByc19zYW1lX2NzdW1zIHVuaXQgaXMgQk1fQkxPQ0tfU0laRSAqLwogCQkJZGV2aWNlLT5y
c19zYW1lX2NzdW0gKz0gcGVlcl9yZXEtPmkuc2l6ZSA+PiBCTV9CTE9DS19TSElGVDsKIAkJCWVy
ciA9IGRyYmRfc2VuZF9hY2socGVlcl9kZXZpY2UsIFBfUlNfSVNfSU5fU1lOQywgcGVlcl9yZXEp
OwogCQl9IGVsc2UgewotCQkJaW5jX3JzX3BlbmRpbmcoZGV2aWNlKTsKKwkJCWluY19yc19wZW5k
aW5nKHBlZXJfZGV2aWNlKTsKIAkJCXBlZXJfcmVxLT5ibG9ja19pZCA9IElEX1NZTkNFUjsgLyog
Qnkgc2V0dGluZyBibG9ja19pZCwgZGlnZXN0IHBvaW50ZXIgYmVjb21lcyBpbnZhbGlkISAqLwog
CQkJcGVlcl9yZXEtPmZsYWdzICY9IH5FRV9IQVNfRElHRVNUOyAvKiBUaGlzIHBlZXIgcmVxdWVz
dCBubyBsb25nZXIgaGFzIGEgZGlnZXN0IHBvaW50ZXIgKi8KIAkJCWtmcmVlKGRpKTsKQEAgLTEy
NTcsMTAgKzEyNjEsMTAgQEAgaW50IHdfZV9lbmRfb3ZfcmVxKHN0cnVjdCBkcmJkX3dvcmsgKncs
IGludCBjYW5jZWwpCiAJICogZHJiZF9hbGxvY19wYWdlcyBkdWUgdG8gcHBfaW5fdXNlID4gbWF4
X2J1ZmZlcnMuICovCiAJZHJiZF9mcmVlX3BlZXJfcmVxKGRldmljZSwgcGVlcl9yZXEpOwogCXBl
ZXJfcmVxID0gTlVMTDsKLQlpbmNfcnNfcGVuZGluZyhkZXZpY2UpOworCWluY19yc19wZW5kaW5n
KHBlZXJfZGV2aWNlKTsKIAllcnIgPSBkcmJkX3NlbmRfZHJlcXVlc3RfY3N1bShwZWVyX2Rldmlj
ZSwgc2VjdG9yLCBzaXplLCBkaWdlc3QsIGRpZ2VzdF9zaXplLCBQX09WX1JFUExZKTsKIAlpZiAo
ZXJyKQotCQlkZWNfcnNfcGVuZGluZyhkZXZpY2UpOworCQlkZWNfcnNfcGVuZGluZyhwZWVyX2Rl
dmljZSk7CiAJa2ZyZWUoZGlnZXN0KTsKIAogb3V0OgpAQCAtMTI3MCwxNSArMTI3NCwxNiBAQCBp
bnQgd19lX2VuZF9vdl9yZXEoc3RydWN0IGRyYmRfd29yayAqdywgaW50IGNhbmNlbCkKIAlyZXR1
cm4gZXJyOwogfQogCi12b2lkIGRyYmRfb3Zfb3V0X29mX3N5bmNfZm91bmQoc3RydWN0IGRyYmRf
ZGV2aWNlICpkZXZpY2UsIHNlY3Rvcl90IHNlY3RvciwgaW50IHNpemUpCit2b2lkIGRyYmRfb3Zf
b3V0X29mX3N5bmNfZm91bmQoc3RydWN0IGRyYmRfcGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBz
ZWN0b3JfdCBzZWN0b3IsIGludCBzaXplKQogeworCXN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
ID0gcGVlcl9kZXZpY2UtPmRldmljZTsKIAlpZiAoZGV2aWNlLT5vdl9sYXN0X29vc19zdGFydCAr
IGRldmljZS0+b3ZfbGFzdF9vb3Nfc2l6ZSA9PSBzZWN0b3IpIHsKIAkJZGV2aWNlLT5vdl9sYXN0
X29vc19zaXplICs9IHNpemU+Pjk7CiAJfSBlbHNlIHsKIAkJZGV2aWNlLT5vdl9sYXN0X29vc19z
dGFydCA9IHNlY3RvcjsKIAkJZGV2aWNlLT5vdl9sYXN0X29vc19zaXplID0gc2l6ZT4+OTsKIAl9
Ci0JZHJiZF9zZXRfb3V0X29mX3N5bmMoZGV2aWNlLCBzZWN0b3IsIHNpemUpOworCWRyYmRfc2V0
X291dF9vZl9zeW5jKHBlZXJfZGV2aWNlLCBzZWN0b3IsIHNpemUpOwogfQogCiBpbnQgd19lX2Vu
ZF9vdl9yZXBseShzdHJ1Y3QgZHJiZF93b3JrICp3LCBpbnQgY2FuY2VsKQpAQCAtMTMyOCw5ICsx
MzMzLDkgQEAgaW50IHdfZV9lbmRfb3ZfcmVwbHkoc3RydWN0IGRyYmRfd29yayAqdywgaW50IGNh
bmNlbCkKIAkgKiBkcmJkX2FsbG9jX3BhZ2VzIGR1ZSB0byBwcF9pbl91c2UgPiBtYXhfYnVmZmVy
cy4gKi8KIAlkcmJkX2ZyZWVfcGVlcl9yZXEoZGV2aWNlLCBwZWVyX3JlcSk7CiAJaWYgKCFlcSkK
LQkJZHJiZF9vdl9vdXRfb2Zfc3luY19mb3VuZChkZXZpY2UsIHNlY3Rvciwgc2l6ZSk7CisJCWRy
YmRfb3Zfb3V0X29mX3N5bmNfZm91bmQocGVlcl9kZXZpY2UsIHNlY3Rvciwgc2l6ZSk7CiAJZWxz
ZQotCQlvdl9vdXRfb2Zfc3luY19wcmludChkZXZpY2UpOworCQlvdl9vdXRfb2Zfc3luY19wcmlu
dChwZWVyX2RldmljZSk7CiAKIAllcnIgPSBkcmJkX3NlbmRfYWNrX2V4KHBlZXJfZGV2aWNlLCBQ
X09WX1JFU1VMVCwgc2VjdG9yLCBzaXplLAogCQkJICAgICAgIGVxID8gSURfSU5fU1lOQyA6IElE
X09VVF9PRl9TWU5DKTsKQEAgLTEzNDEsMTQgKzEzNDYsMTQgQEAgaW50IHdfZV9lbmRfb3ZfcmVw
bHkoc3RydWN0IGRyYmRfd29yayAqdywgaW50IGNhbmNlbCkKIAogCS8qIGxldCdzIGFkdmFuY2Ug
cHJvZ3Jlc3Mgc3RlcCBtYXJrcyBvbmx5IGZvciBldmVyeSBvdGhlciBtZWdhYnl0ZSAqLwogCWlm
ICgoZGV2aWNlLT5vdl9sZWZ0ICYgMHgyMDApID09IDB4MjAwKQotCQlkcmJkX2FkdmFuY2VfcnNf
bWFya3MoZGV2aWNlLCBkZXZpY2UtPm92X2xlZnQpOworCQlkcmJkX2FkdmFuY2VfcnNfbWFya3Mo
cGVlcl9kZXZpY2UsIGRldmljZS0+b3ZfbGVmdCk7CiAKIAlzdG9wX3NlY3Rvcl9yZWFjaGVkID0g
dmVyaWZ5X2Nhbl9kb19zdG9wX3NlY3RvcihkZXZpY2UpICYmCiAJCShzZWN0b3IgKyAoc2l6ZT4+
OSkpID49IGRldmljZS0+b3Zfc3RvcF9zZWN0b3I7CiAKIAlpZiAoZGV2aWNlLT5vdl9sZWZ0ID09
IDAgfHwgc3RvcF9zZWN0b3JfcmVhY2hlZCkgewotCQlvdl9vdXRfb2Zfc3luY19wcmludChkZXZp
Y2UpOwotCQlkcmJkX3Jlc3luY19maW5pc2hlZChkZXZpY2UpOworCQlvdl9vdXRfb2Zfc3luY19w
cmludChwZWVyX2RldmljZSk7CisJCWRyYmRfcmVzeW5jX2ZpbmlzaGVkKHBlZXJfZGV2aWNlKTsK
IAl9CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTY2OCw4ICsxNjczLDkgQEAgdm9pZCBkcmJkX3Jlc3lu
Y19hZnRlcl9jaGFuZ2VkKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQogCX0gd2hpbGUgKGNo
YW5nZWQpOwogfQogCi12b2lkIGRyYmRfcnNfY29udHJvbGxlcl9yZXNldChzdHJ1Y3QgZHJiZF9k
ZXZpY2UgKmRldmljZSkKK3ZvaWQgZHJiZF9yc19jb250cm9sbGVyX3Jlc2V0KHN0cnVjdCBkcmJk
X3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSkKIHsKKwlzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSA9IHBlZXJfZGV2aWNlLT5kZXZpY2U7CiAJc3RydWN0IGdlbmRpc2sgKmRpc2sgPSBkZXZpY2Ut
PmxkZXYtPmJhY2tpbmdfYmRldi0+YmRfZGlzazsKIAlzdHJ1Y3QgZmlmb19idWZmZXIgKnBsYW47
CiAKQEAgLTE4OTEsMTAgKzE4OTcsMTAgQEAgdm9pZCBkcmJkX3N0YXJ0X3Jlc3luYyhzdHJ1Y3Qg
ZHJiZF9kZXZpY2UgKmRldmljZSwgZW51bSBkcmJkX2Nvbm5zIHNpZGUpCiAJCQkJcmN1X3JlYWRf
dW5sb2NrKCk7CiAJCQkJc2NoZWR1bGVfdGltZW91dF9pbnRlcnJ1cHRpYmxlKHRpbWVvKTsKIAkJ
CX0KLQkJCWRyYmRfcmVzeW5jX2ZpbmlzaGVkKGRldmljZSk7CisJCQlkcmJkX3Jlc3luY19maW5p
c2hlZChwZWVyX2RldmljZSk7CiAJCX0KIAotCQlkcmJkX3JzX2NvbnRyb2xsZXJfcmVzZXQoZGV2
aWNlKTsKKwkJZHJiZF9yc19jb250cm9sbGVyX3Jlc2V0KHBlZXJfZGV2aWNlKTsKIAkJLyogbnMu
Y29ubiBtYXkgYWxyZWFkeSBiZSAhPSBkZXZpY2UtPnN0YXRlLmNvbm4sCiAJCSAqIHdlIG1heSBo
YXZlIGJlZW4gcGF1c2VkIGluIGJldHdlZW4sIG9yIGJlY29tZSBwYXVzZWQgdW50aWwKIAkJICog
dGhlIHRpbWVyIHRyaWdnZXJzLgpAQCAtMTkwOSw4ICsxOTE1LDkgQEAgdm9pZCBkcmJkX3N0YXJ0
X3Jlc3luYyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgZW51bSBkcmJkX2Nvbm5zIHNpZGUp
CiAJbXV0ZXhfdW5sb2NrKGRldmljZS0+c3RhdGVfbXV0ZXgpOwogfQogCi1zdGF0aWMgdm9pZCB1
cGRhdGVfb25fZGlza19iaXRtYXAoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIGJvb2wgcmVz
eW5jX2RvbmUpCitzdGF0aWMgdm9pZCB1cGRhdGVfb25fZGlza19iaXRtYXAoc3RydWN0IGRyYmRf
cGVlcl9kZXZpY2UgKnBlZXJfZGV2aWNlLCBib29sIHJlc3luY19kb25lKQogeworCXN0cnVjdCBk
cmJkX2RldmljZSAqZGV2aWNlID0gcGVlcl9kZXZpY2UtPmRldmljZTsKIAlzdHJ1Y3Qgc2liX2lu
Zm8gc2liID0geyAuc2liX3JlYXNvbiA9IFNJQl9TWU5DX1BST0dSRVNTLCB9OwogCWRldmljZS0+
cnNfbGFzdF9iY2FzdCA9IGppZmZpZXM7CiAKQEAgLTE5MTksNyArMTkyNiw3IEBAIHN0YXRpYyB2
b2lkIHVwZGF0ZV9vbl9kaXNrX2JpdG1hcChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgYm9v
bCByZXN5bmNfZG9uZSkKIAogCWRyYmRfYm1fd3JpdGVfbGF6eShkZXZpY2UsIDApOwogCWlmIChy
ZXN5bmNfZG9uZSAmJiBpc19zeW5jX3N0YXRlKGRldmljZS0+c3RhdGUuY29ubikpCi0JCWRyYmRf
cmVzeW5jX2ZpbmlzaGVkKGRldmljZSk7CisJCWRyYmRfcmVzeW5jX2ZpbmlzaGVkKHBlZXJfZGV2
aWNlKTsKIAogCWRyYmRfYmNhc3RfZXZlbnQoZGV2aWNlLCAmc2liKTsKIAkvKiB1cGRhdGUgdGlt
ZXN0YW1wLCBpbiBjYXNlIGl0IHRvb2sgYSB3aGlsZSB0byB3cml0ZSBvdXQgc3R1ZmYgKi8KQEAg
LTIwMTgsNyArMjAyNSw3IEBAIHN0YXRpYyB2b2lkIGRvX2RldmljZV93b3JrKHN0cnVjdCBkcmJk
X2RldmljZSAqZGV2aWNlLCBjb25zdCB1bnNpZ25lZCBsb25nIHRvZG8pCiAJCWRvX21kX3N5bmMo
ZGV2aWNlKTsKIAlpZiAodGVzdF9iaXQoUlNfRE9ORSwgJnRvZG8pIHx8CiAJICAgIHRlc3RfYml0
KFJTX1BST0dSRVNTLCAmdG9kbykpCi0JCXVwZGF0ZV9vbl9kaXNrX2JpdG1hcChkZXZpY2UsIHRl
c3RfYml0KFJTX0RPTkUsICZ0b2RvKSk7CisJCXVwZGF0ZV9vbl9kaXNrX2JpdG1hcChmaXJzdF9w
ZWVyX2RldmljZShkZXZpY2UpLCB0ZXN0X2JpdChSU19ET05FLCAmdG9kbykpOwogCWlmICh0ZXN0
X2JpdChHT19ESVNLTEVTUywgJnRvZG8pKQogCQlnb19kaXNrbGVzcyhkZXZpY2UpOwogCWlmICh0
ZXN0X2JpdChERVNUUk9ZX0RJU0ssICZ0b2RvKSkKLS0gCjIuMzkuMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJiZC1kZXYgbWFpbGluZyBsaXN0CmRy
YmQtZGV2QGxpc3RzLmxpbmJpdC5jb20KaHR0cHM6Ly9saXN0cy5saW5iaXQuY29tL21haWxtYW4v
bGlzdGluZm8vZHJiZC1kZXYK
