Return-Path: <drbd-dev-bounces@lists.linbit.com>
X-Original-To: lists+drbd-dev@lfdr.de
Delivered-To: lists+drbd-dev@lfdr.de
Received: from mail19.linbit.com (mail19.linbit.com [159.69.154.96])
	by mail.lfdr.de (Postfix) with ESMTPS id 25C5D63EEE7
	for <lists+drbd-dev@lfdr.de>; Thu,  1 Dec 2022 12:07:00 +0100 (CET)
Received: from mail19.linbit.com (localhost [127.0.0.1])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id 05CA2421788;
	Thu,  1 Dec 2022 12:07:00 +0100 (CET)
X-Original-To: drbd-dev@lists.linbit.com
Delivered-To: drbd-dev@lists.linbit.com
Received: from mail-ej1-f45.google.com (mail-ej1-f45.google.com
	[209.85.218.45])
	by mail19.linbit.com (LINBIT Mail Daemon) with ESMTP id A18BB421788
	for <drbd-dev@lists.linbit.com>; Thu,  1 Dec 2022 12:04:50 +0100 (CET)
Received: by mail-ej1-f45.google.com with SMTP id b2so3309751eja.7
	for <drbd-dev@lists.linbit.com>; Thu, 01 Dec 2022 03:04:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=linbit-com.20210112.gappssmtp.com; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:from:to:cc:subject:date
	:message-id:reply-to;
	bh=/EOxMb4n3Nlc6JLzIY5AGW7V4duQBm1d7NMmCc8Ck6Q=;
	b=MHMm5sy+h50MFhCatkC/kV8M2e9GBLmPDXSH68rgSAQMfBYnHIXpLgIcCisqpjaW+1
	1ndMj77GHmEkGhCmCvzyjJP83uIu4tn0aPzmrYExtQc3E9zJK4NRgJTiPFMm3Xw0hR8i
	odJr+bm4Wu5iId/S9+ctbOnVU2pQ+lxQEKw1fn1XASUfj7Gw9DJW5Ph2veIRiuLiH6Zx
	nnp82C8skX2XK4ktA8lWJA9niJiFfgm735B9RTuhQd0BBoffMtJDgdKBZFH3ThbVWOR7
	UkNv6oI9DaGmckzSMQ8pp1gSymS1WfxymJvo7PiED6vbXvDqrK8KiGHBkb5Du82xz6ds
	Gppg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20210112;
	h=content-transfer-encoding:mime-version:references:in-reply-to
	:message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
	:subject:date:message-id:reply-to;
	bh=/EOxMb4n3Nlc6JLzIY5AGW7V4duQBm1d7NMmCc8Ck6Q=;
	b=vTIChsUvbb5/sdzb4RkdQnvIOqG1GeVeVGEET9iX6N7fM5FlwWAcJjgSSJfikDKVY+
	dGCW1np4flkCj7sEQW6zlwoy5j5kabc8DYmUlpRdhTYMtKIUPzG2WcL36vr2Qo+gqGhD
	8d/hyltmHbzP2dkW011rWiVuDdhEW5vJiGglNu3jbToHWWCMbSyLj3eY+PR/t4RJMUyc
	ZSvISUamvDMkBZkYpjHxeZQe7zgsluYhivnnZfr8ZEJfT5Tp9DsUB84V1dFUhrBTLPNn
	HaPAVLHXUnKcu7qdgGUv4NHWLuccaNseeHCAffZWePKuB0KwVTHojs5Fez3dXwCmiE0e
	zw8Q==
X-Gm-Message-State: ANoB5pmEe8s6PiuppsKWXXQ74DgRciEzguC9dueYticqJjrJdNAKyqwX
	pApgQnRGUmZwBwAiLAe1Uj6Xrtg4
X-Google-Smtp-Source: AA0mqf677w+mpEmA29mz/vtbB1zpY4D0M29lW0jCdFFcxzJPskOMC9Cw+qJHY+rlo2l4d5ArZ2XAgw==
X-Received: by 2002:a17:907:8b13:b0:781:541:6599 with SMTP id
	sz19-20020a1709078b1300b0078105416599mr43234197ejc.45.1669892690004;
	Thu, 01 Dec 2022 03:04:50 -0800 (PST)
Received: from localhost.localdomain (h082218028181.host.wavenet.at.
	[82.218.28.181]) by smtp.gmail.com with ESMTPSA id
	f26-20020a056402161a00b00463a83ce063sm1576424edv.96.2022.12.01.03.04.48
	(version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
	Thu, 01 Dec 2022 03:04:49 -0800 (PST)
From: =?UTF-8?q?Christoph=20B=C3=B6hmwalder?=
	<christoph.boehmwalder@linbit.com>
To: Jens Axboe <axboe@kernel.dk>
Date: Thu,  1 Dec 2022 12:03:50 +0100
Message-Id: <20221201110349.1282687-6-christoph.boehmwalder@linbit.com>
X-Mailer: git-send-email 2.38.1
In-Reply-To: <20221201110349.1282687-1-christoph.boehmwalder@linbit.com>
References: <20221201110349.1282687-1-christoph.boehmwalder@linbit.com>
MIME-Version: 1.0
Cc: Philipp Reisner <philipp.reisner@linbit.com>, linux-kernel@vger.kernel.org,
	linux-block@vger.kernel.org, Lars Ellenberg <lars.ellenberg@linbit.com>,
	drbd-dev@lists.linbit.com
Subject: [Drbd-dev] [PATCH 5/5] drbd: add context parameter to expect() macro
X-BeenThere: drbd-dev@lists.linbit.com
X-Mailman-Version: 2.1.11
Precedence: list
List-Id: "*Coordination* of development, patches,
	contributions -- *Questions* \(even to developers\) go to drbd-user,
	please." <drbd-dev.lists.linbit.com>
List-Unsubscribe: <https://lists.linbit.com/mailman/options/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=unsubscribe>
List-Archive: <http://lists.linbit.com/pipermail/drbd-dev>
List-Post: <mailto:drbd-dev@lists.linbit.com>
List-Help: <mailto:drbd-dev-request@lists.linbit.com?subject=help>
List-Subscribe: <https://lists.linbit.com/mailman/listinfo/drbd-dev>,
	<mailto:drbd-dev-request@lists.linbit.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: drbd-dev-bounces@lists.linbit.com
Errors-To: drbd-dev-bounces@lists.linbit.com

T3JpZ2luYWxseS1mcm9tOiBBbmRyZWFzIEdydWVuYmFjaGVyIDxhZ3J1ZW5AbGluYml0LmNvbT4K
U2lnbmVkLW9mZi1ieTogQ2hyaXN0b3BoIELDtmhtd2FsZGVyIDxjaHJpc3RvcGguYm9laG13YWxk
ZXJAbGluYml0LmNvbT4KLS0tCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYyAgICAg
ICAgICAgfCAgNCArLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYml0bWFwLmMgICAgICAgICAg
IHwgNTQgKysrKysrKysrKystLS0tLS0tLS0tLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbWFp
bi5jICAgICAgICAgICAgIHwgIDggKystLQogZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYyAg
ICAgICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3BvbHltb3JwaF9w
cmludGsuaCB8ICA0ICstCiBkcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jICAgICAg
ICAgfCAxMiArKy0tLQogNiBmaWxlcyBjaGFuZ2VkLCA0MiBpbnNlcnRpb25zKCspLCA0MiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYyBi
L2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2FjdGxvZy5jCmluZGV4IDg3ZDkzMDEyMjg5Zi4uNDI5
MjU1ODc2ODAwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYwor
KysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9hY3Rsb2cuYwpAQCAtODY4LDkgKzg2OCw5IEBA
IGludCBfX2RyYmRfY2hhbmdlX3N5bmMoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UsIHNlY3Rv
cl90IHNlY3RvciwgaW50IHNpemUsCiAJbnJfc2VjdG9ycyA9IGdldF9jYXBhY2l0eShkZXZpY2Ut
PnZkaXNrKTsKIAllc2VjdG9yID0gc2VjdG9yICsgKHNpemUgPj4gOSkgLSAxOwogCi0JaWYgKCFl
eHBlY3Qoc2VjdG9yIDwgbnJfc2VjdG9ycykpCisJaWYgKCFleHBlY3QoZGV2aWNlLCBzZWN0b3Ig
PCBucl9zZWN0b3JzKSkKIAkJZ290byBvdXQ7Ci0JaWYgKCFleHBlY3QoZXNlY3RvciA8IG5yX3Nl
Y3RvcnMpKQorCWlmICghZXhwZWN0KGRldmljZSwgZXNlY3RvciA8IG5yX3NlY3RvcnMpKQogCQll
c2VjdG9yID0gbnJfc2VjdG9ycyAtIDE7CiAKIAlsYm5yID0gQk1fU0VDVF9UT19CSVQobnJfc2Vj
dG9ycy0xKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2JpdG1hcC5jIGIv
ZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfYml0bWFwLmMKaW5kZXggOGU2NTM0YTkwZTEyLi4yODk4
NzZmZmJjMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2JpdG1hcC5jCisr
KyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX2JpdG1hcC5jCkBAIC00NDgsNyArNDQ4LDcgQEAg
aW50IGRyYmRfYm1faW5pdChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKIAogc2VjdG9yX3Qg
ZHJiZF9ibV9jYXBhY2l0eShzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKIHsKLQlpZiAoIWV4
cGVjdChkZXZpY2UtPmJpdG1hcCkpCisJaWYgKCFleHBlY3QoZGV2aWNlLCBkZXZpY2UtPmJpdG1h
cCkpCiAJCXJldHVybiAwOwogCXJldHVybiBkZXZpY2UtPmJpdG1hcC0+Ym1fZGV2X2NhcGFjaXR5
OwogfQpAQCAtNDU3LDcgKzQ1Nyw3IEBAIHNlY3Rvcl90IGRyYmRfYm1fY2FwYWNpdHkoc3RydWN0
IGRyYmRfZGV2aWNlICpkZXZpY2UpCiAgKi8KIHZvaWQgZHJiZF9ibV9jbGVhbnVwKHN0cnVjdCBk
cmJkX2RldmljZSAqZGV2aWNlKQogewotCWlmICghZXhwZWN0KGRldmljZS0+Yml0bWFwKSkKKwlp
ZiAoIWV4cGVjdChkZXZpY2UsIGRldmljZS0+Yml0bWFwKSkKIAkJcmV0dXJuOwogCWJtX2ZyZWVf
cGFnZXMoZGV2aWNlLT5iaXRtYXAtPmJtX3BhZ2VzLCBkZXZpY2UtPmJpdG1hcC0+Ym1fbnVtYmVy
X29mX3BhZ2VzKTsKIAlibV92a19mcmVlKGRldmljZS0+Yml0bWFwLT5ibV9wYWdlcyk7CkBAIC02
MzYsNyArNjM2LDcgQEAgaW50IGRyYmRfYm1fcmVzaXplKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2
aWNlLCBzZWN0b3JfdCBjYXBhY2l0eSwgaW50IHNldF9uZXdfYmkKIAlpbnQgZXJyID0gMDsKIAli
b29sIGdyb3dpbmc7CiAKLQlpZiAoIWV4cGVjdChiKSkKKwlpZiAoIWV4cGVjdChkZXZpY2UsIGIp
KQogCQlyZXR1cm4gLUVOT01FTTsKIAogCWRyYmRfYm1fbG9jayhkZXZpY2UsICJyZXNpemUiLCBC
TV9MT0NLRURfTUFTSyk7CkBAIC03NTcsOSArNzU3LDkgQEAgdW5zaWduZWQgbG9uZyBfZHJiZF9i
bV90b3RhbF93ZWlnaHQoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCiAJdW5zaWduZWQgbG9u
ZyBzOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKLQlpZiAoIWV4cGVjdChiKSkKKwlpZiAoIWV4
cGVjdChkZXZpY2UsIGIpKQogCQlyZXR1cm4gMDsKLQlpZiAoIWV4cGVjdChiLT5ibV9wYWdlcykp
CisJaWYgKCFleHBlY3QoZGV2aWNlLCBiLT5ibV9wYWdlcykpCiAJCXJldHVybiAwOwogCiAJc3Bp
bl9sb2NrX2lycXNhdmUoJmItPmJtX2xvY2ssIGZsYWdzKTsKQEAgLTc4Myw5ICs3ODMsOSBAQCB1
bnNpZ25lZCBsb25nIGRyYmRfYm1fdG90YWxfd2VpZ2h0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2
aWNlKQogc2l6ZV90IGRyYmRfYm1fd29yZHMoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCiB7
CiAJc3RydWN0IGRyYmRfYml0bWFwICpiID0gZGV2aWNlLT5iaXRtYXA7Ci0JaWYgKCFleHBlY3Qo
YikpCisJaWYgKCFleHBlY3QoZGV2aWNlLCBiKSkKIAkJcmV0dXJuIDA7Ci0JaWYgKCFleHBlY3Qo
Yi0+Ym1fcGFnZXMpKQorCWlmICghZXhwZWN0KGRldmljZSwgYi0+Ym1fcGFnZXMpKQogCQlyZXR1
cm4gMDsKIAogCXJldHVybiBiLT5ibV93b3JkczsKQEAgLTc5NCw3ICs3OTQsNyBAQCBzaXplX3Qg
ZHJiZF9ibV93b3JkcyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSkKIHVuc2lnbmVkIGxvbmcg
ZHJiZF9ibV9iaXRzKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQogewogCXN0cnVjdCBkcmJk
X2JpdG1hcCAqYiA9IGRldmljZS0+Yml0bWFwOwotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhw
ZWN0KGRldmljZSwgYikpCiAJCXJldHVybiAwOwogCiAJcmV0dXJuIGItPmJtX2JpdHM7CkBAIC04
MTYsOSArODE2LDkgQEAgdm9pZCBkcmJkX2JtX21lcmdlX2xlbChzdHJ1Y3QgZHJiZF9kZXZpY2Ug
KmRldmljZSwgc2l6ZV90IG9mZnNldCwgc2l6ZV90IG51bWJlciwKIAogCWVuZCA9IG9mZnNldCAr
IG51bWJlcjsKIAotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikpCiAJ
CXJldHVybjsKLQlpZiAoIWV4cGVjdChiLT5ibV9wYWdlcykpCisJaWYgKCFleHBlY3QoZGV2aWNl
LCBiLT5ibV9wYWdlcykpCiAJCXJldHVybjsKIAlpZiAobnVtYmVyID09IDApCiAJCXJldHVybjsK
QEAgLTg2Myw5ICs4NjMsOSBAQCB2b2lkIGRyYmRfYm1fZ2V0X2xlbChzdHJ1Y3QgZHJiZF9kZXZp
Y2UgKmRldmljZSwgc2l6ZV90IG9mZnNldCwgc2l6ZV90IG51bWJlciwKIAogCWVuZCA9IG9mZnNl
dCArIG51bWJlcjsKIAotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikp
CiAJCXJldHVybjsKLQlpZiAoIWV4cGVjdChiLT5ibV9wYWdlcykpCisJaWYgKCFleHBlY3QoZGV2
aWNlLCBiLT5ibV9wYWdlcykpCiAJCXJldHVybjsKIAogCXNwaW5fbG9ja19pcnEoJmItPmJtX2xv
Y2spOwpAQCAtODk0LDkgKzg5NCw5IEBAIHZvaWQgZHJiZF9ibV9nZXRfbGVsKHN0cnVjdCBkcmJk
X2RldmljZSAqZGV2aWNlLCBzaXplX3Qgb2Zmc2V0LCBzaXplX3QgbnVtYmVyLAogdm9pZCBkcmJk
X2JtX3NldF9hbGwoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCiB7CiAJc3RydWN0IGRyYmRf
Yml0bWFwICpiID0gZGV2aWNlLT5iaXRtYXA7Ci0JaWYgKCFleHBlY3QoYikpCisJaWYgKCFleHBl
Y3QoZGV2aWNlLCBiKSkKIAkJcmV0dXJuOwotCWlmICghZXhwZWN0KGItPmJtX3BhZ2VzKSkKKwlp
ZiAoIWV4cGVjdChkZXZpY2UsIGItPmJtX3BhZ2VzKSkKIAkJcmV0dXJuOwogCiAJc3Bpbl9sb2Nr
X2lycSgmYi0+Ym1fbG9jayk7CkBAIC05MTAsOSArOTEwLDkgQEAgdm9pZCBkcmJkX2JtX3NldF9h
bGwoc3RydWN0IGRyYmRfZGV2aWNlICpkZXZpY2UpCiB2b2lkIGRyYmRfYm1fY2xlYXJfYWxsKHN0
cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlKQogewogCXN0cnVjdCBkcmJkX2JpdG1hcCAqYiA9IGRl
dmljZS0+Yml0bWFwOwotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikp
CiAJCXJldHVybjsKLQlpZiAoIWV4cGVjdChiLT5ibV9wYWdlcykpCisJaWYgKCFleHBlY3QoZGV2
aWNlLCBiLT5ibV9wYWdlcykpCiAJCXJldHVybjsKIAogCXNwaW5fbG9ja19pcnEoJmItPmJtX2xv
Y2spOwpAQCAtMTMzMiw5ICsxMzMyLDkgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgYm1fZmluZF9u
ZXh0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNlLAogCXN0cnVjdCBkcmJkX2JpdG1hcCAqYiA9
IGRldmljZS0+Yml0bWFwOwogCXVuc2lnbmVkIGxvbmcgaSA9IERSQkRfRU5EX09GX0JJVE1BUDsK
IAotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikpCiAJCXJldHVybiBp
OwotCWlmICghZXhwZWN0KGItPmJtX3BhZ2VzKSkKKwlpZiAoIWV4cGVjdChkZXZpY2UsIGItPmJt
X3BhZ2VzKSkKIAkJcmV0dXJuIGk7CiAKIAlzcGluX2xvY2tfaXJxKCZiLT5ibV9sb2NrKTsKQEAg
LTE0MzYsOSArMTQzNiw5IEBAIHN0YXRpYyBpbnQgYm1fY2hhbmdlX2JpdHNfdG8oc3RydWN0IGRy
YmRfZGV2aWNlICpkZXZpY2UsIGNvbnN0IHVuc2lnbmVkIGxvbmcgcywKIAlzdHJ1Y3QgZHJiZF9i
aXRtYXAgKmIgPSBkZXZpY2UtPmJpdG1hcDsKIAlpbnQgYyA9IDA7CiAKLQlpZiAoIWV4cGVjdChi
KSkKKwlpZiAoIWV4cGVjdChkZXZpY2UsIGIpKQogCQlyZXR1cm4gMTsKLQlpZiAoIWV4cGVjdChi
LT5ibV9wYWdlcykpCisJaWYgKCFleHBlY3QoZGV2aWNlLCBiLT5ibV9wYWdlcykpCiAJCXJldHVy
biAwOwogCiAJc3Bpbl9sb2NrX2lycXNhdmUoJmItPmJtX2xvY2ssIGZsYWdzKTsKQEAgLTE1ODIs
OSArMTU4Miw5IEBAIGludCBkcmJkX2JtX3Rlc3RfYml0KHN0cnVjdCBkcmJkX2RldmljZSAqZGV2
aWNlLCBjb25zdCB1bnNpZ25lZCBsb25nIGJpdG5yKQogCXVuc2lnbmVkIGxvbmcgKnBfYWRkcjsK
IAlpbnQgaTsKIAotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikpCiAJ
CXJldHVybiAwOwotCWlmICghZXhwZWN0KGItPmJtX3BhZ2VzKSkKKwlpZiAoIWV4cGVjdChkZXZp
Y2UsIGItPmJtX3BhZ2VzKSkKIAkJcmV0dXJuIDA7CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmYi0+
Ym1fbG9jaywgZmxhZ3MpOwpAQCAtMTYxOSw5ICsxNjE5LDkgQEAgaW50IGRyYmRfYm1fY291bnRf
Yml0cyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgY29uc3QgdW5zaWduZWQgbG9uZyBzLCBj
b25zdAogCSAqIHJvYnVzdCBpbiBjYXNlIHdlIHNjcmV3ZWQgdXAgZWxzZXdoZXJlLCBpbiB0aGF0
IGNhc2UgcHJldGVuZCB0aGVyZQogCSAqIHdhcyBvbmUgZGlydHkgYml0IGluIHRoZSByZXF1ZXN0
ZWQgYXJlYSwgc28gd2Ugd29uJ3QgdHJ5IHRvIGRvIGEKIAkgKiBsb2NhbCByZWFkIHRoZXJlIChu
byBiaXRtYXAgcHJvYmFibHkgaW1wbGllcyBubyBkaXNrKSAqLwotCWlmICghZXhwZWN0KGIpKQor
CWlmICghZXhwZWN0KGRldmljZSwgYikpCiAJCXJldHVybiAxOwotCWlmICghZXhwZWN0KGItPmJt
X3BhZ2VzKSkKKwlpZiAoIWV4cGVjdChkZXZpY2UsIGItPmJtX3BhZ2VzKSkKIAkJcmV0dXJuIDE7
CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmYi0+Ym1fbG9jaywgZmxhZ3MpOwpAQCAtMTYzNSw3ICsx
NjM1LDcgQEAgaW50IGRyYmRfYm1fY291bnRfYml0cyhzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmlj
ZSwgY29uc3QgdW5zaWduZWQgbG9uZyBzLCBjb25zdAogCQkJCWJtX3VubWFwKHBfYWRkcik7CiAJ
CQlwX2FkZHIgPSBibV9tYXBfcGlkeChiLCBpZHgpOwogCQl9Ci0JCWlmIChleHBlY3QoYml0bnIg
PCBiLT5ibV9iaXRzKSkKKwkJaWYgKGV4cGVjdChkZXZpY2UsIGJpdG5yIDwgYi0+Ym1fYml0cykp
CiAJCQljICs9ICgwICE9IHRlc3RfYml0X2xlKGJpdG5yIC0gKHBhZ2VfbnIgPDwgKFBBR0VfU0hJ
RlQrMykpLCBwX2FkZHIpKTsKIAkJZWxzZQogCQkJZHJiZF9lcnIoZGV2aWNlLCAiYml0bnI9JWx1
IGJtX2JpdHM9JWx1XG4iLCBiaXRuciwgYi0+Ym1fYml0cyk7CkBAIC0xNjY4LDkgKzE2NjgsOSBA
QCBpbnQgZHJiZF9ibV9lX3dlaWdodChzdHJ1Y3QgZHJiZF9kZXZpY2UgKmRldmljZSwgdW5zaWdu
ZWQgbG9uZyBlbnIpCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAl1bnNpZ25lZCBsb25nICpwX2Fk
ZHIsICpibTsKIAotCWlmICghZXhwZWN0KGIpKQorCWlmICghZXhwZWN0KGRldmljZSwgYikpCiAJ
CXJldHVybiAwOwotCWlmICghZXhwZWN0KGItPmJtX3BhZ2VzKSkKKwlpZiAoIWV4cGVjdChkZXZp
Y2UsIGItPmJtX3BhZ2VzKSkKIAkJcmV0dXJuIDA7CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmYi0+
Ym1fbG9jaywgZmxhZ3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbWFp
bi5jIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbWFpbi5jCmluZGV4IGFjZmJiYTNjMGYyMS4u
NzIxM2ZmZDY5YTE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9tYWluLmMK
KysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbWFpbi5jCkBAIC0xMjU5LDcgKzEyNTksNyBA
QCBzdGF0aWMgaW50IF9kcmJkX3NlbmRfYml0bWFwKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
KQogCXN0cnVjdCBibV94ZmVyX2N0eCBjOwogCWludCBlcnI7CiAKLQlpZiAoIWV4cGVjdChkZXZp
Y2UtPmJpdG1hcCkpCisJaWYgKCFleHBlY3QoZGV2aWNlLCBkZXZpY2UtPmJpdG1hcCkpCiAJCXJl
dHVybiBmYWxzZTsKIAogCWlmIChnZXRfbGRldihkZXZpY2UpKSB7CkBAIC0yMjUwLDkgKzIyNTAs
OSBAQCBzdGF0aWMgdm9pZCBkb19yZXRyeShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndzKQogCQlib29s
IGV4cGVjdGVkOwogCiAJCWV4cGVjdGVkID0KLQkJCWV4cGVjdChhdG9taWNfcmVhZCgmcmVxLT5j
b21wbGV0aW9uX3JlZikgPT0gMCkgJiYKLQkJCWV4cGVjdChyZXEtPnJxX3N0YXRlICYgUlFfUE9T
VFBPTkVEKSAmJgotCQkJZXhwZWN0KChyZXEtPnJxX3N0YXRlICYgUlFfTE9DQUxfUEVORElORykg
PT0gMCB8fAorCQkJZXhwZWN0KGRldmljZSwgYXRvbWljX3JlYWQoJnJlcS0+Y29tcGxldGlvbl9y
ZWYpID09IDApICYmCisJCQlleHBlY3QoZGV2aWNlLCByZXEtPnJxX3N0YXRlICYgUlFfUE9TVFBP
TkVEKSAmJgorCQkJZXhwZWN0KGRldmljZSwgKHJlcS0+cnFfc3RhdGUgJiBSUV9MT0NBTF9QRU5E
SU5HKSA9PSAwIHx8CiAJCQkJKHJlcS0+cnFfc3RhdGUgJiBSUV9MT0NBTF9BQk9SVEVEKSAhPSAw
KTsKIAogCQlpZiAoIWV4cGVjdGVkKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ibG9jay9kcmJkL2Ry
YmRfbmwuYyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX25sLmMKaW5kZXggY2I1NWIyOGZiYTc4
Li42MDc1N2FjMzE3MDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX25sLmMK
KysrIGIvZHJpdmVycy9ibG9jay9kcmJkL2RyYmRfbmwuYwpAQCAtMTU0Myw3ICsxNTQzLDcgQEAg
aW50IGRyYmRfYWRtX2Rpc2tfb3B0cyhzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgZ2VubF9p
bmZvICppbmZvKQogCQlnb3RvIGZhaWxfdW5sb2NrOwogCX0KIAotCWlmICghZXhwZWN0KG5ld19k
aXNrX2NvbmYtPnJlc3luY19yYXRlID49IDEpKQorCWlmICghZXhwZWN0KGRldmljZSwgbmV3X2Rp
c2tfY29uZi0+cmVzeW5jX3JhdGUgPj0gMSkpCiAJCW5ld19kaXNrX2NvbmYtPnJlc3luY19yYXRl
ID0gMTsKIAogCXNhbml0aXplX2Rpc2tfY29uZihkZXZpY2UsIG5ld19kaXNrX2NvbmYsIGRldmlj
ZS0+bGRldik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9wb2x5bW9ycGhf
cHJpbnRrLmggYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9wb2x5bW9ycGhfcHJpbnRrLmgKaW5k
ZXggOTE0ZjJhM2MwZTJlLi44ZTAwODJkMTM5YmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvYmxvY2sv
ZHJiZC9kcmJkX3BvbHltb3JwaF9wcmludGsuaAorKysgYi9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJi
ZF9wb2x5bW9ycGhfcHJpbnRrLmgKQEAgLTEzMCwxMCArMTMwLDEwIEBAIHZvaWQgZHJiZF9keW5f
ZGJnX3dpdGhfd3Jvbmdfb2JqZWN0X3R5cGUodm9pZCk7CiAgKgogICogVW5saWtlIHRoZSBhc3Nl
cnQgbWFjcm8sIHRoaXMgbWFjcm8gcmV0dXJucyBhIGJvb2xlYW4gcmVzdWx0LgogICovCi0jZGVm
aW5lIGV4cGVjdChleHApICh7CQkJCQkJCQlcCisjZGVmaW5lIGV4cGVjdCh4LCBleHApICh7CQkJ
CQkJCVwKIAkJYm9vbCBfYm9vbCA9IChleHApOwkJCQkJCVwKIAkJaWYgKCFfYm9vbCAmJiBkcmJk
X3JhdGVsaW1pdCgpKQkJCQkJXAotCQkJZHJiZF9lcnIoZGV2aWNlLCAiQVNTRVJUSU9OICVzIEZB
SUxFRCBpbiAlc1xuIiwJCVwKKwkJCWRyYmRfZXJyKHgsICJBU1NFUlRJT04gJXMgRkFJTEVEIGlu
ICVzXG4iLAkJXAogCQkJCSNleHAsIF9fZnVuY19fKTsJCQkJXAogCQlfYm9vbDsJCQkJCQkJCVwK
IAkJfSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMgYi9k
cml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5jCmluZGV4IGFmYmUwZGYzZmY3NS4uMjRk
MGEyMjYyOTgyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jsb2NrL2RyYmQvZHJiZF9yZWNlaXZlci5j
CisrKyBiL2RyaXZlcnMvYmxvY2svZHJiZC9kcmJkX3JlY2VpdmVyLmMKQEAgLTQxMyw3ICs0MTMs
NyBAQCB2b2lkIF9fZHJiZF9mcmVlX3BlZXJfcmVxKHN0cnVjdCBkcmJkX2RldmljZSAqZGV2aWNl
LCBzdHJ1Y3QgZHJiZF9wZWVyX3JlcXVlc3QgKgogCWRyYmRfZnJlZV9wYWdlcyhkZXZpY2UsIHBl
ZXJfcmVxLT5wYWdlcywgaXNfbmV0KTsKIAlEX0FTU0VSVChkZXZpY2UsIGF0b21pY19yZWFkKCZw
ZWVyX3JlcS0+cGVuZGluZ19iaW9zKSA9PSAwKTsKIAlEX0FTU0VSVChkZXZpY2UsIGRyYmRfaW50
ZXJ2YWxfZW1wdHkoJnBlZXJfcmVxLT5pKSk7Ci0JaWYgKCFleHBlY3QoIShwZWVyX3JlcS0+Zmxh
Z3MgJiBFRV9DQUxMX0FMX0NPTVBMRVRFX0lPKSkpIHsKKwlpZiAoIWV4cGVjdChkZXZpY2UsICEo
cGVlcl9yZXEtPmZsYWdzICYgRUVfQ0FMTF9BTF9DT01QTEVURV9JTykpKSB7CiAJCXBlZXJfcmVx
LT5mbGFncyAmPSB+RUVfQ0FMTF9BTF9DT01QTEVURV9JTzsKIAkJZHJiZF9hbF9jb21wbGV0ZV9p
byhkZXZpY2UsICZwZWVyX3JlcS0+aSk7CiAJfQpAQCAtMTg3MywyMSArMTg3MywyMSBAQCByZWFk
X2luX2Jsb2NrKHN0cnVjdCBkcmJkX3BlZXJfZGV2aWNlICpwZWVyX2RldmljZSwgdTY0IGlkLCBz
ZWN0b3JfdCBzZWN0b3IsCiAJLyogYXNzdW1lIHJlcXVlc3Rfc2l6ZSA9PSBkYXRhX3NpemUsIGJ1
dCBzcGVjaWFsIGNhc2UgdHJpbS4gKi8KIAlkcyA9IGRhdGFfc2l6ZTsKIAlpZiAodHJpbSkgewot
CQlpZiAoIWV4cGVjdChkYXRhX3NpemUgPT0gMCkpCisJCWlmICghZXhwZWN0KHBlZXJfZGV2aWNl
LCBkYXRhX3NpemUgPT0gMCkpCiAJCQlyZXR1cm4gTlVMTDsKIAkJZHMgPSBiZTMyX3RvX2NwdSh0
cmltLT5zaXplKTsKIAl9IGVsc2UgaWYgKHplcm9lcykgewotCQlpZiAoIWV4cGVjdChkYXRhX3Np
emUgPT0gMCkpCisJCWlmICghZXhwZWN0KHBlZXJfZGV2aWNlLCBkYXRhX3NpemUgPT0gMCkpCiAJ
CQlyZXR1cm4gTlVMTDsKIAkJZHMgPSBiZTMyX3RvX2NwdSh6ZXJvZXMtPnNpemUpOwogCX0KIAot
CWlmICghZXhwZWN0KElTX0FMSUdORUQoZHMsIDUxMikpKQorCWlmICghZXhwZWN0KHBlZXJfZGV2
aWNlLCBJU19BTElHTkVEKGRzLCA1MTIpKSkKIAkJcmV0dXJuIE5VTEw7CiAJaWYgKHRyaW0gfHwg
emVyb2VzKSB7Ci0JCWlmICghZXhwZWN0KGRzIDw9IChEUkJEX01BWF9CQklPX1NFQ1RPUlMgPDwg
OSkpKQorCQlpZiAoIWV4cGVjdChwZWVyX2RldmljZSwgZHMgPD0gKERSQkRfTUFYX0JCSU9fU0VD
VE9SUyA8PCA5KSkpCiAJCQlyZXR1cm4gTlVMTDsKLQl9IGVsc2UgaWYgKCFleHBlY3QoZHMgPD0g
RFJCRF9NQVhfQklPX1NJWkUpKQorCX0gZWxzZSBpZiAoIWV4cGVjdChwZWVyX2RldmljZSwgZHMg
PD0gRFJCRF9NQVhfQklPX1NJWkUpKQogCQlyZXR1cm4gTlVMTDsKIAogCS8qIGV2ZW4gdGhvdWdo
IHdlIHRydXN0IG91dCBwZWVyLAotLSAKMi4zOC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmJkLWRldiBtYWlsaW5nIGxpc3QKZHJiZC1kZXZAbGlz
dHMubGluYml0LmNvbQpodHRwczovL2xpc3RzLmxpbmJpdC5jb20vbWFpbG1hbi9saXN0aW5mby9k
cmJkLWRldgo=
